apiVersion: helm.toolkit.fluxcd.io/v2beta2
kind: HelmRelease
metadata:
    name: vaultwarden
    namespace: vaultwarden
spec:
    releaseName: vaultwarden
    chart:
        spec:
            version: 0.34.4
            chart: vaultwarden
            sourceRef:
                kind: HelmRepository
                name: vaultwarden
    interval: 50m
    install:
        remediation:
            retries: 3
    values:
        pushNotifications:
            installationId:
                value: ENC[AES256_GCM,data:q8s821ASyN8jJODQnKESXKKw99EHfcoqmPp+QSyDe+xFojZ+,iv:uAfX/geD0fOTjhZWIJWbX6ki5CwNrPGOq6OpikJEQVY=,tag:qukZVy2/ueUqUGNEINivIg==,type:str]
            installationKey:
                value: ENC[AES256_GCM,data:Z5Ype8Q1EwEYusSSeHT6AoRTKTs=,iv:urgZXvHXfts0QOOP8M5jGkjehRH1/HPCkb2nDtuD3CE=,tag:nm/DiGPsaQGkYvf8IMdPAg==,type:str]
            relayUri: https://push.bitwarden.eu
            identityUri: https://identity.bitwarden.eu
        signupsAllowed: false
        domain: https://vault.midnightthoughts.space
        signupDomains: nordgedanken.dev,gmail.com
        timeZone: Europe/Berlin
        database:
            type: postgresql
            uriOverride: ENC[AES256_GCM,data:JTIKCwwVw3deopLcbumlXDqAFgrtM0q+np+5wbnTMuLgJYgiB/enyAiJsULGLiQHkRTtcg9aEPvWW4+2HrUPWPVakSa7WLL8Jg1RMEPmgZDIiGQAcQBOR0lvoPj3SWgbh0vcfuPO4W2WLAjz8ij0vgDCjaxlt7JeAP002idn2KvwnMmK6Zil+Xb7fPJ5Nl1tl3cc0qrtcP1GyjBe1M8=,iv:cms2roPD/jJlR1wt0t7HPiG9c7yq91gKn6zNte139nM=,tag:NZSFSDelzDOeC6MxHN7XBw==,type:str]
        ingress:
            enabled: false
            additionalAnnotations:
                external-dns.alpha.kubernetes.io/hostname: vault.midnightthoughts.space
                cert-manager.io/cluster-issuer: letsencrypt-dns
            tlsSecret: vault.midnightthoughts.space-crt
            hostname: vault.midnightthoughts.space
            nginxIngressAnnotations: false
            class: traefik
        adminToken:
            value: $argon2id$v=19$m=19456,t=2,p=1$R0VoUlJ2T3I5UDRiL0h0cGgvTzYwbHhIL0poeFNpWmkzZThPUDh3TnNtND0$dm7crNLYaQFcGS7KZ38aKTyrV+E2RdyYKx1wDSjpu4s
        smtp:
            host: mail.midnightthoughts.space
            from: support@midnightthoughts.space
            fromName: Vault Administrator
            username:
                value: support@midnightthoughts.space
            password:
                value: ENC[AES256_GCM,data:q6+egVU0bl+CluqFVuw4qIIrc1LGw5RCwr4bAPTsh8RRt1c0vf4hJZAwLfc+tcaCNO99Jkl4KuRXesZAm+jN1Q==,iv:dSf92M0k6XknOrM2P/I+tuM6CS0TyxlDspVnXm1jPF8=,tag:/67d+hVcNjWK6N0ssq6CMw==,type:str]
            security: force_tls
            port: 465
        storage:
            data:
                name: ENC[AES256_GCM,data:Tz8aYV3YboKbeNvlW17t5g==,iv:MFeAk7gz6WNPuAGNKc8SsimwultHulPIbl48EEf4h14=,tag:9shjnIAo2QCcZZhX/1Thew==,type:str]
                class: ENC[AES256_GCM,data:gY40ogoAY2I=,iv:GFf70MCLhLp6U78zZg1dwBu7GVWZvlCuVfKwcDDk73M=,tag:b7xhnkX6lEljWNROyd5UpQ==,type:str]
                size: ENC[AES256_GCM,data:wOJtAPY=,iv:A2M4nALJ+Mb3u12DpbYtDp0r1THMrnIHyazzPNcToBw=,tag:EhejFrEjbmyr94h++shvAQ==,type:str]
                accessMode: ENC[AES256_GCM,data:xi09z1aUqh3RYwt3eg==,iv:L2udBSpUELL0zrNb4hqOOajL0hQmScwB+jqxSq0/0QI=,tag:w34mQxnd/yFXJzjPqNP+0Q==,type:str]
                keepPvc: ENC[AES256_GCM,data:x4htsg==,iv:EqsJfxeZNcnOY88v0TAxvHZnK194igqtwg7tx79yiZk=,tag:5d/jY1EZjQetsOJM4Ah7ig==,type:bool]
        resources:
            requests:
                cpu: 50m
                memory: 256Mi
sops:
    kms: []
    gcp_kms: []
    azure_kv: []
    hc_vault: []
    age:
        - recipient: age1esjyg2qfy49awv0ptkzvpk425adczjr38m37w2mmcahzc4p8n54sll2nzh
          enc: |
              -----BEGIN AGE ENCRYPTED FILE-----
              YWdlLWVuY3J5cHRpb24ub3JnL3YxCi0+IFgyNTUxOSBXY25DbjBHRXptTFd4U0Qv
              WUpBejVlem5qRkNqdTFkL204MjQ4SG95d2hRCmNqay9vL2t1ZjRKemJHbEUva29j
              ZW5DcnVrTDlJNjNtK3VXZlRRV1ptM2MKLS0tIFFDMjBKOU1IOTRQZmhyUkU2NFJI
              akd6NWdaQWcraVF3ODE2Yk9CeVRYVlkK9+kkjjx7Tc460EBcyKo8ABuowyun7BHF
              MfxYFcO1qSoate+NX1RPZjErpoW3SccgPd6YgkN6zXxic5PGZu4ILQ==
              -----END AGE ENCRYPTED FILE-----
    lastmodified: "2025-08-03T20:07:48Z"
    mac: ENC[AES256_GCM,data:IJboxKsmBu4xBfLAufFLcqGlrRtKiZLMZi3QQ81yn6op3YcHEnrAhz298mGXzHT7EDsdQf8SdvJw6A8YnJ/oZ+V8O2XZjF3Os/Jmb4UC0MgA8Tx/14FVLJ7w2MEvH+HcBn63VhBjCOyWd5LukMIwZ4fpviUl/Y8NhxulAX9F5R8=,iv:ZvhSalxt6ny4+3pJDNq8DiHuGar37AQl6L2zAFK5+ag=,tag:Hb8HEi0PEA7xP/1Rl3+dgQ==,type:str]
    pgp: []
    encrypted_regex: ^(GITHUB_CLIENT_ID|GITHUB_CLIENT_SECRET|GITHUB_PRIVATE_KEY|woosh|root_password|rspamd_password|pgdb_password|matrix_access_token|pgdb_remote_url|hmac_secret_key|adminPassword|adminEmail|jenkinsAdminEmail|securityRealm|gerrit.config|routing_key|DATABASE_URL|SMTP_PASSWORD|SECRET_KEY_BASE|admin_password|extraCommands|key|clickhouseDatabaseURL|databaseURL|client_id|client_secret|secret_key_base|otp_secret|private_key|public_key|primaryKey|deterministicKey|keyDerivationSalt|token|clientId|secretKey|installationId|installationKey|uriOverride|adminToken.value|password.value|sql_password|erlangCookie|AUTHENTICATION_PASSWORD|ROOM_API_SECRET_KEY|adminPassword|configPassword|adminUser|configUser|MAIL_PASSWORD|APP_KEY|api_key|api_secret|keys|livekit_key|livekit_secret|secret_key|admin_pass|admin_email|mariadbPassword|mariadbRootPassword|privateKey|data|stringData|PASSWD|password|pass|postgresPassword|postgresqlPassword|redminePassword|smtpPassword|registration_shared_secret|shared_secret|secret|admin_token|integrationKey|rootPassword)$
    version: 3.9.1
---
apiVersion: gateway.networking.k8s.io/v1
kind: HTTPRoute
metadata:
    name: vaultwarden
    namespace: vaultwarden
spec:
    parentRefs:
        - name: envoy-gateway
          namespace: envoy-gateway
    hostnames:
        - vault.midnightthoughts.space
    rules:
        - backendRefs:
              - name: vaultwarden
                port: 80
          timeouts:
              request: 240s
              backendRequest: 0s
sops:
    kms: []
    gcp_kms: []
    azure_kv: []
    hc_vault: []
    age:
        - recipient: age1esjyg2qfy49awv0ptkzvpk425adczjr38m37w2mmcahzc4p8n54sll2nzh
          enc: |
              -----BEGIN AGE ENCRYPTED FILE-----
              YWdlLWVuY3J5cHRpb24ub3JnL3YxCi0+IFgyNTUxOSBXY25DbjBHRXptTFd4U0Qv
              WUpBejVlem5qRkNqdTFkL204MjQ4SG95d2hRCmNqay9vL2t1ZjRKemJHbEUva29j
              ZW5DcnVrTDlJNjNtK3VXZlRRV1ptM2MKLS0tIFFDMjBKOU1IOTRQZmhyUkU2NFJI
              akd6NWdaQWcraVF3ODE2Yk9CeVRYVlkK9+kkjjx7Tc460EBcyKo8ABuowyun7BHF
              MfxYFcO1qSoate+NX1RPZjErpoW3SccgPd6YgkN6zXxic5PGZu4ILQ==
              -----END AGE ENCRYPTED FILE-----
    lastmodified: "2025-08-03T20:07:48Z"
    mac: ENC[AES256_GCM,data:IJboxKsmBu4xBfLAufFLcqGlrRtKiZLMZi3QQ81yn6op3YcHEnrAhz298mGXzHT7EDsdQf8SdvJw6A8YnJ/oZ+V8O2XZjF3Os/Jmb4UC0MgA8Tx/14FVLJ7w2MEvH+HcBn63VhBjCOyWd5LukMIwZ4fpviUl/Y8NhxulAX9F5R8=,iv:ZvhSalxt6ny4+3pJDNq8DiHuGar37AQl6L2zAFK5+ag=,tag:Hb8HEi0PEA7xP/1Rl3+dgQ==,type:str]
    pgp: []
    encrypted_regex: ^(GITHUB_CLIENT_ID|GITHUB_CLIENT_SECRET|GITHUB_PRIVATE_KEY|woosh|root_password|rspamd_password|pgdb_password|matrix_access_token|pgdb_remote_url|hmac_secret_key|adminPassword|adminEmail|jenkinsAdminEmail|securityRealm|gerrit.config|routing_key|DATABASE_URL|SMTP_PASSWORD|SECRET_KEY_BASE|admin_password|extraCommands|key|clickhouseDatabaseURL|databaseURL|client_id|client_secret|secret_key_base|otp_secret|private_key|public_key|primaryKey|deterministicKey|keyDerivationSalt|token|clientId|secretKey|installationId|installationKey|uriOverride|adminToken.value|password.value|sql_password|erlangCookie|AUTHENTICATION_PASSWORD|ROOM_API_SECRET_KEY|adminPassword|configPassword|adminUser|configUser|MAIL_PASSWORD|APP_KEY|api_key|api_secret|keys|livekit_key|livekit_secret|secret_key|admin_pass|admin_email|mariadbPassword|mariadbRootPassword|privateKey|data|stringData|PASSWD|password|pass|postgresPassword|postgresqlPassword|redminePassword|smtpPassword|registration_shared_secret|shared_secret|secret|admin_token|integrationKey|rootPassword)$
    version: 3.9.1
