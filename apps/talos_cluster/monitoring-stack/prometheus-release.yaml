apiVersion: helm.toolkit.fluxcd.io/v2
kind: HelmRelease
metadata:
    name: prometheus-stack
    namespace: monitoring
spec:
    interval: 5m
    chart:
        spec:
            version: 82.x
            chart: kube-prometheus-stack
            sourceRef:
                kind: HelmRepository
                name: prometheus-community
            interval: 60m
    install:
        crds: CreateReplace
    upgrade:
        crds: CreateReplace
    # https://github.com/prometheus-community/helm-charts/blob/main/charts/kube-prometheus-stack/values.yaml
    values:
        kubeProxy:
            enabled: false
        alertmanager:
            config:
                global:
                    resolve_timeout: 5m
                    pagerduty_url: https://events.eu.pagerduty.com/v2/enqueue
                route:
                    receiver: pagerduty-warning
                    group_by:
                        - alertname
                        - namespace
                    group_wait: 30s
                    group_interval: 5m
                    repeat_interval: 4h
                    routes:
                        - receiver: "null"
                          matchers:
                            - alertname = "InfoInhibitor"
                        - receiver: pagerduty-draupnir4all
                          matchers:
                            - service_id = "draupnir4all"
                        - receiver: pagerduty-critical
                          matchers:
                            - severity = "critical"
                receivers:
                    - name: "null"
                    - name: pagerduty-critical
                      pagerduty_configs:
                        - routing_key: ENC[AES256_GCM,data:Iy/TEmlS0jdYoh90fURUXN5cwuzM22+5V+iOhYZBg78=,iv:wS9sL7pyNWsXt9pc9o1+poLacakDQwr+fBaMsV8M3Bs=,tag:HUMGIfME8ZHfvX8YEjB0aw==,type:str]
                          severity: critical
                    - name: pagerduty-warning
                      pagerduty_configs:
                        - routing_key: ENC[AES256_GCM,data:aXgFZ//wVpTJq33FUmUmmjBPiKLSyikaUTCqicCH6Pk=,iv:oNS/i5YRa1b+8tVu2E1iNx/3ow0jGEMrEN0iv6Xm5Lw=,tag:G1hQS5ajXKPi5jWCygPl3Q==,type:str]
                          severity: warning
                    - name: pagerduty-draupnir4all
                      pagerduty_configs:
                        - routing_key: ENC[AES256_GCM,data:gQE68N0GyoMUJMZnQ5wpJNbYrL12k5L4zkFwb2B5hCQ=,iv:TYZraOfL7HqgceNdZOf00x9Ef3aWYeGzXtX7Q03iEXE=,tag:zQdwjb8wqKK7v5dNgoSynQ==,type:str]
                          severity: critical
                inhibit_rules:
                    - source_matchers:
                        - severity = "critical"
                      target_matchers:
                        - severity = "warning"
                      equal:
                        - namespace
                        - alertname
        prometheus:
            prometheusSpec:
                retention: 4h
                externalLabels:
                    k8s_cluster: midnightthoughts
                # Pick up all ServiceMonitors/PodMonitors/etc. regardless of labels
                serviceMonitorSelectorNilUsesHelmValues: false
                serviceMonitorSelector: {}
                serviceMonitorNamespaceSelector: {}
                podMonitorSelectorNilUsesHelmValues: false
                podMonitorSelector: {}
                podMonitorNamespaceSelector: {}
                probeSelectorNilUsesHelmValues: false
                probeSelector: {}
                probeNamespaceSelector: {}
                ruleSelectorNilUsesHelmValues: false
                ruleSelector: {}
                ruleNamespaceSelector: {}
                scrapeConfigSelectorNilUsesHelmValues: false
                scrapeConfigSelector: {}
                scrapeConfigNamespaceSelector: {}
                # Thanos sidecar uploads completed TSDB blocks to Hetzner S3.
                # First block is cut after ~3h (Prometheus head span must exceed chunkRange Ã— 1.5 = 3h).
                # Subsequent blocks are cut every 2h once the head is warm.
                thanos:
                    objectStorageConfig:
                        existingSecret:
                            name: thanos-objstore-secret
                            key: ENC[AES256_GCM,data:wGIFt6Sc,iv:l9oxrEGfDqCUGAF+Ff4b6C4Zj5y74/j84MZMc6O7j7c=,tag:ZJbuboy9OM5kXGZ+I+BgdA==,type:str]
                storageSpec:
                    volumeClaimTemplate:
                        spec:
                            storageClassName: longhorn-2replicas
                            accessModes:
                                - ReadWriteOnce
                            resources:
                                requests:
                                    storage: 10Gi
        grafana:
            adminPassword: ENC[AES256_GCM,data:ojJvI+lN3R5VgKXmxSdAX9kT3lJnYTamjhZ7u/EwCcWmEeCzxoX/n/UHFgpmjPkiFaHoKuRJGbWVbjQts6KSAA==,iv:W6y4guYl6GK7w+HxrjnmmOLfo9TVkJ9X6I80lPd0DM4=,tag:RtHT+KmaI6/UXQ6AGFl89A==,type:str]
            sidecar:
                datasources:
                    # Disable the auto-generated default Prometheus datasource so it
                    # doesn't conflict with our custom datasources.yaml (which points to Thanos)
                    defaultDatasourceEnabled: false
                dashboards:
                    folderAnnotation: grafana_folder
                    provider:
                        foldersFromFilesStructure: true
                    logLevel: WARN
                    watchServerTimeout: 3600
                    enabled: true
            plugins:
                - grafana-piechart-panel
                - grafana-worldmap-panel
                - isovalent-hubble-datasource
                - isovalent-hubbleprocessancestry-panel
                - chaosmeshorg-datasource
            smtp:
                existingSecret: smtp-auth-secret
            extraSecretMounts:
                - name: auth-generic-oauth-secret-mount
                  secretName: auth-generic-oauth-secret
                  defaultMode: 288
                  mountPath: /etc/secrets/auth_generic_oauth
                  readOnly: true
            defaultDashboardsTimezone: Europe/Berlin
            datasources:
                datasources.yaml:
                    apiVersion: 1
                    datasources:
                        - name: Prometheus
                          type: prometheus
                          uid: prometheus
                          url: http://thanos-query-frontend.monitoring.svc.cluster.local:10902
                          access: proxy
                        - name: ChaosMesh
                          type: chaosmeshorg-datasource
                          url: http://chaos-dashboard.chaosmesh.svc.cluster.local:2333
                          access: proxy
                          isDefault: false
                        - name: Hubble
                          type: isovalent-hubble-datasource
                          uid: hubble
                          access: proxy
                          url: http://hubble-relay.kube-system.svc.cluster.local:80
                          isDefault: false
                          jsonData:
                            serviceMap:
                                datasourceUid: prometheus
                            prometheusDatasourceUid: prometheus
                        - name: Postgres-d4all
                          type: postgres
                          uid: postgres-d4all
                          access: proxy
                          url: pg-cluster-v2-ro.postgres-cluster.svc.cluster.local:5432
                          database: draupnir_synapse
                          user: grafana-ro
                          secureJsonData:
                            password: ENC[AES256_GCM,data:MjqIlir+CyFwI7auFgXrolz+jEB2hfr4IOIK9iRJ7D4owyKopfsXoFjlS3tJZjuEZjbng5zYTLUeypDLw8tjWw==,iv:KhN6iJoqjsPjDxbsdbPhkENLpe3yLvXqrGX/GvULKYo=,tag:SOZwqN60fpVC4jbWT5+vDQ==,type:str]
                          isDefault: false
                          jsonData:
                            sslmode: disable
                            maxIdleConnsAuto: true
                            timescaledb: false
                            maxOpenConns: 10
                            maxIdleConns: 10
                        - name: Postgres-connectivity-tester
                          type: postgres
                          uid: postgres-connectivity-tester
                          access: proxy
                          url: pg-cluster-v2-ro.postgres-cluster.svc.cluster.local:5432
                          database: connectivity-tester
                          user: connectivity-tester
                          secureJsonData:
                            password: ENC[AES256_GCM,data:NgdeOaYIS+ihYSZOyZ48JY70NVyMIxJnbzgonLf6bNrgUFwMnfoxAWsxRk9KrOc79LFrz8KwK3zYyx1T7odjBA==,iv:CE7iGsplD2pvTyjR7fns84+oLiYhwrOW+tjbxFSrRuE=,tag:oA0745LL8gTOvDPjaSmppQ==,type:str]
                          isDefault: false
                          jsonData:
                            sslmode: disable
                            maxIdleConnsAuto: true
                            timescaledb: false
                            maxOpenConns: 10
                            maxIdleConns: 10
            ingress:
                enabled: false
            grafana.ini:
                server:
                    root_url: https://grafana.midnightthoughts.space
                smtp:
                    enabled: true
                    host: smtp.fastmail.com:465
                    from_address: ops@nordgedanken.dev
                paths:
                    data: ENC[AES256_GCM,data:cU3v1cHGlmRm4vbyf1yUT2k=,iv:q9L/YqGbjn02XSE8XrnR10p5f/WHNgZdz70z9ue1A9s=,tag:OzVV6u9kvig2DjD6zkz5Fw==,type:str]
                    logs: /var/log/grafana
                    plugins: /var/lib/grafana/plugins
                    provisioning: /etc/grafana/provisioning
                analytics:
                    check_for_updates: true
                log:
                    mode: console
                grafana_net:
                    url: https://grafana.net
                auth:
                    signout_redirect_url: https://auth.midnightthoughts.space/application/o/grafana/end-session/
                    oauth_auto_login: true
                auth.generic_oauth:
                    name: authentik
                    enabled: true
                    client_id: ENC[AES256_GCM,data:EFrs2CyfeOONgdc9fnA6Kez1EBIinrxR0b6EyYMpndXgWdwluNKeYKNT//rIHbxXFf8=,iv:0KbHOimvfdOH1n1eJZHbU67kvX1mqxaHEEN02Vu1LxE=,tag:YLqlhexzm1jacun1DPm9Mg==,type:str]
                    client_secret: ENC[AES256_GCM,data:fmrLLIYk2KNOJryjrD9HqZ5qEbknEWTnjqR3s8YNTSN7nfIOQkY+iPhipu6IG3E0N1RxC+47,iv:WcnQrkShDCyU4pqFjQqhqapJ0YNCaxnHVEgAExVU5Sk=,tag:xvh2sWYH3rk7icRq0ADsKA==,type:str]
                    scopes: openid email profile
                    auth_url: https://auth.midnightthoughts.space/application/o/authorize/
                    token_url: https://auth.midnightthoughts.space/application/o/token/
                    api_url: https://auth.midnightthoughts.space/application/o/userinfo/
                    role_attribute_path: contains(groups, 'Grafana Admins') && 'Admin' || contains(groups, 'Grafana Editors') && 'Editor' || 'Viewer'
            imageRenderer:
                enabled: true
            alerting:
                rules.yaml:
                    apiVersion: 1
                    groups:
                        - orgId: 1
                          name: CertManager
                          folder: Cluster
                          interval: 5m
                          rules:
                            - uid: ddz3zj028wb28b
                              title: CertManagerHittingRateLimits
                              condition: B
                              data:
                                - refId: ENC[AES256_GCM,data:vA==,iv:BC0A0ZVN/7/coqgcbqKDhLG3vlV31lZzBw4WMs2TQ6k=,tag:kVYj6gJDWRGGEdtxRpNq6A==,type:str]
                                  relativeTimeRange:
                                    from: ENC[AES256_GCM,data:G+Ii,iv:6HmTMWLw2FYPhpBeHm6h+i9GLBJrDMYAd1omsdIJ3Bo=,tag:zNUBAXaFJOpafuUj3TyqfA==,type:int]
                                    to: ENC[AES256_GCM,data:hw==,iv:qUgwRvI2mEsW5WFidjeLI0NDIY59lFu6Q4xbGpunmlA=,tag:yFtEp6uGR/bBr9SgqFpgcw==,type:int]
                                  datasourceUid: ENC[AES256_GCM,data:EX0S8Hfjzou46A==,iv:psU+38kn1fodFidi273+oWQlSOPHKKBOg1Jf4wiLa2c=,tag:Zo1zbJnvP6VMXj7CBiSSZQ==,type:str]
                                  model:
                                    editorMode: ENC[AES256_GCM,data:SjVb9w==,iv:K5dez40EKN0Y2wCx3Rx48gdQW3Y06Bs/Cfi+8HXS8rw=,tag:97G3XGeXkqgghwG+qPWmuQ==,type:str]
                                    expr: ENC[AES256_GCM,data:pTXXWLNUNyOa8WDEKAu9ynujqYJK4P4+ZtVbHRgTRP0fscatxhEEn+ju0fHGSLuIo427GVmUzsFb0ixnwXjsxIswQiIZmtpy6NNVTRRJRU/S2Pxbev7URRUqekwuINTEH7xUee05ivRg9gyvKj1Y69FC,iv:lMA5NDXsi7sKD238tHNjvxK+zypy1ZeFoXJ+BeKHUuE=,tag:CsKbauOMcRLgrsUhB5n4qQ==,type:str]
                                    instant: ENC[AES256_GCM,data:SwpaDw==,iv:4Jlftw9XiAk6MD6Cez/NAE1e/8xe0R0cH2hLbB4e45I=,tag:Ld88yVng9sSgbvAdj4mWaw==,type:bool]
                                    intervalMs: ENC[AES256_GCM,data:V6H3tg==,iv:ZVTON3vsqHq+b4GiNC0koBDbzcnh6LzwsWFyr3FehPE=,tag:PjX5H7X12nVi3QADDoV7pQ==,type:int]
                                    legendFormat: ENC[AES256_GCM,data:juASn8FK,iv:fIDN8TiPw4mV3I2dRtwn0A8lJv3CUMCersg6+R0fwSU=,tag:sAWMOK04WCam5twxRdJETg==,type:str]
                                    maxDataPoints: ENC[AES256_GCM,data:al6W1U0=,iv:k8Zd533PxVYYZ4j7hud9ZLaaZY1tiYm1oElq5LQqYj0=,tag:85I/kkTeqoZ9PJeHH3jR/g==,type:int]
                                    range: ENC[AES256_GCM,data:OmI5mmw=,iv:WpqtxbK8mex/l8zFokZFdJGxbGCw7QQjLkNBjnFJ0lc=,tag:NubC8pMLqzsbSRq+7Acvpw==,type:bool]
                                    refId: ENC[AES256_GCM,data:IQ==,iv:41IEo1k3QGY1qvtV5Ra4q2g3u3gBX1W184xhAk8S5kU=,tag:JBES9ZMhvdFyv7j3+XdP7A==,type:str]
                                - refId: ENC[AES256_GCM,data:5A==,iv:YWQw76OwjGjAJ84/bYQF7cKVa0gHukGwsSOruYPn8co=,tag:Q5KgMqExJF+lK+VCVK3Pug==,type:str]
                                  relativeTimeRange:
                                    from: ENC[AES256_GCM,data:FOBs,iv:fyVdvX0nEzGO4WKtcuG3nJTWr9cefbnJpFHTUf0PND8=,tag:RIr3TG0noGVMq6kLI4X8vA==,type:int]
                                    to: ENC[AES256_GCM,data:+g==,iv:sM9P14EW1ZV0Nri4M8NSyRuO7Db4mWizApCtEkAY37k=,tag:88T7JW0GCVM2mrDjnLk1ug==,type:int]
                                  datasourceUid: ENC[AES256_GCM,data:0/smTkTTpe8=,iv:bo7tyvnBO5hKuirWs4RePpJPMHDinVkw2OuTfqUCiZA=,tag:dp+v9ACwKd9Ygw7E5cb8dw==,type:str]
                                  model:
                                    conditions:
                                        - evaluator:
                                            params: []
                                            type: ENC[AES256_GCM,data:TII=,iv:mZpWNQjSx8an04FkB0Hc8y7LxfOusmNpLvxDbGmZEvg=,tag:rTgFLARiE30qwsPgxlm9+g==,type:str]
                                          operator:
                                            type: ENC[AES256_GCM,data:SBdK,iv:6zKS/jblMwZpVa4AgQLgaZlkiq1Wob7lUnTzQlKZUZo=,tag:xvLCZJFG66kKsYkCh1ltCA==,type:str]
                                          query:
                                            params:
                                                - ENC[AES256_GCM,data:dA==,iv:4I6r7FrwRVqIJYTwjiRjulN6r9dwtXLcbYotLQn13UA=,tag:ymgkakJ9mW2BK9MtTWaBTA==,type:str]
                                          reducer:
                                            params: []
                                            type: ENC[AES256_GCM,data:ZgEDRw==,iv:oPwq1INUwbxOh818N6qkDDdDCMrv20mmSOMJ7cMavy0=,tag:+AKAzM7Ps5w538tXiZLJuA==,type:str]
                                          type: ENC[AES256_GCM,data:61udwUk=,iv:AMY3GofeYx5w4maA9ot3skeseIdT8Jr++hvW4vgvmio=,tag:JaqqSMFJ89y/dGSBQLdduQ==,type:str]
                                    datasource:
                                        type: ENC[AES256_GCM,data:RA8NadRA6lQ=,iv:LyZJkce3vqJ+/bsAzTzU/7Z/KAfcADRSsUqlutPMzoI=,tag:YzCjQM9FKJiLekpcAR5uXg==,type:str]
                                        uid: ENC[AES256_GCM,data:VdAMvXSzczo=,iv:EmjTHvcVo2+uHO1f/e5YNbvAh1ql9ScveGQBx5Qdz0A=,tag:PQtOPYOfY3U7mvuRuwi8jQ==,type:str]
                                    expression: ENC[AES256_GCM,data:Bw==,iv:ZslWorINvVM9Ea5jM5CxmSxEdJDe0Ox64hmCKXi29nE=,tag:cxIUtf1pIStX+v2RTL3Oqg==,type:str]
                                    intervalMs: ENC[AES256_GCM,data:ovUE9w==,iv:x3XGHMG9vAVqousq1VgnH4pTtpMGlMxs1R9owFjE8qw=,tag:zQFmY6fOlkicd3xyuYTfMA==,type:int]
                                    maxDataPoints: ENC[AES256_GCM,data:CIsxFLA=,iv:v8HM2Y9zOWf2W2X+MlixAD7t55hYt7uOhwHY3AM4TeE=,tag:wIMwkEyJdLKkjyv6DZ70hw==,type:int]
                                    reducer: ENC[AES256_GCM,data:A3lRiA==,iv:0Q4vlCdOkXQe730OHNW+7sRS20bRhoVkAXtbOS6GdBw=,tag:iYV+zVqfUzMF3PbheEbN+Q==,type:str]
                                    refId: ENC[AES256_GCM,data:0Q==,iv:fAytHbTqrXWKEzayUAcbSs9jGMI11+sL/rtL/Pk77GI=,tag:CBzQmuJY1aPi4BCUPy/bBQ==,type:str]
                                    type: ENC[AES256_GCM,data:69HVfYBP,iv:w43UBIA4MdBpHHd7TOQAxUJcd6Txm0c2PE+6Eg549JU=,tag:ksdDlsCTaJG75gAZg4sneg==,type:str]
                              noDataState: OK
                              execErrState: Error
                              for: 5m
                              annotations:
                                description: Depending on the rate limit, cert-manager may be unable to generate certificates for up to a week.
                                summary: Cert manager hitting LetsEncrypt rate limits.
                              labels: {}
                              isPaused: false
                              notification_settings:
                                receiver: PagerDuty Warning
                contactpoints.yaml:
                    apiVersion: 1
                    contactPoints:
                        - orgId: 1
                          name: MidnightThoughts Ops
                          receivers:
                            - uid: "1"
                              name: MidnightThoughts Ops
                              type: email
                              sendReminder: true
                              frequency: 1m
                              settings:
                                addresses: ops@nordgedanken.dev;mtrnord@nordgedanken.dev;mtrnord1@gmail.com
                        - orgId: 1
                          name: PagerDuty
                          receivers:
                            - uid: adz30e8814wshd
                              type: pagerduty
                              settings:
                                integrationKey: ENC[AES256_GCM,data:zTkzV0pwxcoYqxaeq8zN8ya2QMT9pkN54Qq9Gn3qZi8=,iv:8+fMBgyWiNHCJHue6fjLhFQOcdo0tsuqq7G192IHgMw=,tag:dWGswaFCU3SJ3wFTYv012g==,type:str]
                                url: https://events.eu.pagerduty.com/v2/enqueue
                              disableResolveMessage: false
                        - orgId: 1
                          name: PagerDuty Warning
                          receivers:
                            - uid: pg_warning
                              type: pagerduty
                              settings:
                                integrationKey: ENC[AES256_GCM,data:LOz3Ozo0sQi9Kk59ctejB2HpsbOnisSYsDGdhJHselM=,iv:wEuLvMdV9vMyKJ1zo9HXlo6p84kcLcklR/3ly0n/Yac=,tag:N/lJ7Zta8UTS2DGMVVRX7w==,type:str]
                                severity: warning
                                url: https://events.eu.pagerduty.com/v2/enqueue
                              disableResolveMessage: false
                        - orgId: 1
                          name: PagerDuty Draupnir4All
                          receivers:
                            - uid: "3"
                              type: pagerduty
                              settings:
                                integrationKey: ENC[AES256_GCM,data:2jZ6XWNVqvSTzz06h/jWraDJCJd1yMTmgpCaHyTvOY8=,iv:impSLdlyQ4am7LXQzrPjxdLoth5AmD1J5T6Xjbdj+Wo=,tag:JMCM4PZ5htcZMjMy4GfDOA==,type:str]
                                url: https://events.eu.pagerduty.com/v2/enqueue
                              disableResolveMessage: false
                        - orgId: 1
                          name: PagerDuty Draupnir4All Warning
                          receivers:
                            - uid: de02at943dxxcf
                              type: pagerduty
                              settings:
                                integrationKey: ENC[AES256_GCM,data:ezcKnrcIMPH2ew3AGxYtxlIpqmDfwzgrsXOgpxfDBPQ=,iv:fKQS2AxdFSeveuXuL7yFfiss1jeN0cxXvNmRuY5Uxfw=,tag:zzOkUT2HciNmsyO/+iXQyw==,type:str]
                                severity: warning
                                url: https://events.eu.pagerduty.com/v2/enqueue
                              disableResolveMessage: false
                policies.yaml:
                    apiVersion: 1
                    policies:
                        - orgId: 1
                          receiver: PagerDuty
                          group_by:
                            - grafana_folder
                            - alertname
                          routes:
                            - receiver: PagerDuty
                              object_matchers:
                                - - service_id
                                  - '!='
                                  - draupnir4all
                            - receiver: PagerDuty Draupnir4All
                              object_matchers:
                                - - service_id
                                  - =
                                  - draupnir4all
                            - receiver: MidnightThoughts Ops
    postRenderers:
        - kustomize:
            patches:
                - target:
                    # Ignore these objects from Flux diff as they are mutated from chart hooks
                    kind: (ValidatingWebhookConfiguration|MutatingWebhookConfiguration)
                    name: kube-prometheus-stack-admission
                  patch: |
                    - op: add
                      path: /metadata/annotations/helm.toolkit.fluxcd.io~1driftDetection
                      value: disabled
                - target:
                    # Ignore these objects from Flux diff as they are mutated at apply time but not at dry-run time
                    kind: PrometheusRule
                  patch: |
                    - op: add
                      path: /metadata/annotations/helm.toolkit.fluxcd.io~1driftDetection
                      value: disabled
sops:
    kms: []
    gcp_kms: []
    azure_kv: []
    hc_vault: []
    age:
        - recipient: age1esjyg2qfy49awv0ptkzvpk425adczjr38m37w2mmcahzc4p8n54sll2nzh
          enc: |
            -----BEGIN AGE ENCRYPTED FILE-----
            YWdlLWVuY3J5cHRpb24ub3JnL3YxCi0+IFgyNTUxOSAwMytEbEhGSUM4Q3p3ZHFh
            V0xWcmhRaDVBYXUvVVlGUDRWc09VTTgzenhnCmZCOU1sUUJXbjdzbkdBRGFlWkpG
            NzlzM2lwRDZSZFVWTTFCNjJHNndnVlkKLS0tIHRGUkphSjBkckYwK1FQcmtKZTFh
            cXAwcjdSZTh3N2tWQlZ0K05ReWZqSm8KFJC3sJ3vZaTjz356zKQ4WmSnzsKY08+k
            gcooXIEFEAH0wxJuS5gm24TfvCasd7HdiuVO+/6HyKocJtdUI1kv4Q==
            -----END AGE ENCRYPTED FILE-----
    lastmodified: "2026-02-28T20:29:17Z"
    mac: ENC[AES256_GCM,data:+g+V8qTfBf6A0uYuYs5Abuz+vI7W8tktKUZz6gnnOCxjhza4fvGog3ayiaC0piXHFpi1yJkWbkprupfvZugDaML3lwJ1icFwhTXOMgBs3aszWGdUsDnhNRAyo4dPrfLie+uRJbRC3T9HIk6A2jWXCQfR3dMy0sRiaGiXIv4ZNnM=,iv:d9cX1ZXkhNZuBGUUMGKDn0vvQ9upQM/hKiiebuxB1aw=,tag:PvA+0m+UcgDNOdznnv96IA==,type:str]
    pgp: []
    encrypted_regex: ^(apiKey|appUserPassword|otelUserPassword|harborAdminPassword|totpVaultKey|kimaiAppSecret|kimaiAdminPassword|GITHUB_CLIENT_ID|GITHUB_CLIENT_SECRET|GITHUB_PRIVATE_KEY|woosh|root_password|rspamd_password|pgdb_password|matrix_access_token|pgdb_remote_url|hmac_secret_key|adminPassword|adminEmail|jenkinsAdminEmail|securityRealm|gerrit.config|routing_key|DATABASE_URL|SMTP_PASSWORD|SECRET_KEY_BASE|admin_password|extraCommands|key|clickhouseDatabaseURL|databaseURL|client_id|client_secret|secret_key_base|otp_secret|private_key|public_key|primaryKey|deterministicKey|keyDerivationSalt|token|clientId|secretKey|installationId|installationKey|uriOverride|adminToken.value|password.value|sql_password|erlangCookie|AUTHENTICATION_PASSWORD|ROOM_API_SECRET_KEY|adminPassword|configPassword|adminUser|configUser|MAIL_PASSWORD|APP_KEY|api_key|api_secret|keys|livekit_key|livekit_secret|secret_key|admin_pass|admin_email|mariadbPassword|mariadbRootPassword|privateKey|data|stringData|PASSWD|password|pass|postgresPassword|postgresqlPassword|redminePassword|smtpPassword|registration_shared_secret|shared_secret|secret|admin_token|integrationKey|integration_key|rootPassword|adminPassword|adminUser|adminEmail|emailPassword|secretKey|appId|clientSecret|webhookSecret)$
    version: 3.9.1
---
apiVersion: gateway.networking.k8s.io/v1
kind: HTTPRoute
metadata:
    name: grafana
    namespace: monitoring
spec:
    parentRefs:
        - name: envoy-gateway
          namespace: envoy-gateway
    hostnames:
        - grafana.midnightthoughts.space
    rules:
        - backendRefs:
            - name: prometheus-stack-grafana
              port: 80
          timeouts:
            request: 240s
            backendRequest: 0s
sops:
    kms: []
    gcp_kms: []
    azure_kv: []
    hc_vault: []
    age:
        - recipient: age1esjyg2qfy49awv0ptkzvpk425adczjr38m37w2mmcahzc4p8n54sll2nzh
          enc: |
            -----BEGIN AGE ENCRYPTED FILE-----
            YWdlLWVuY3J5cHRpb24ub3JnL3YxCi0+IFgyNTUxOSAwMytEbEhGSUM4Q3p3ZHFh
            V0xWcmhRaDVBYXUvVVlGUDRWc09VTTgzenhnCmZCOU1sUUJXbjdzbkdBRGFlWkpG
            NzlzM2lwRDZSZFVWTTFCNjJHNndnVlkKLS0tIHRGUkphSjBkckYwK1FQcmtKZTFh
            cXAwcjdSZTh3N2tWQlZ0K05ReWZqSm8KFJC3sJ3vZaTjz356zKQ4WmSnzsKY08+k
            gcooXIEFEAH0wxJuS5gm24TfvCasd7HdiuVO+/6HyKocJtdUI1kv4Q==
            -----END AGE ENCRYPTED FILE-----
    lastmodified: "2026-02-28T20:29:17Z"
    mac: ENC[AES256_GCM,data:+g+V8qTfBf6A0uYuYs5Abuz+vI7W8tktKUZz6gnnOCxjhza4fvGog3ayiaC0piXHFpi1yJkWbkprupfvZugDaML3lwJ1icFwhTXOMgBs3aszWGdUsDnhNRAyo4dPrfLie+uRJbRC3T9HIk6A2jWXCQfR3dMy0sRiaGiXIv4ZNnM=,iv:d9cX1ZXkhNZuBGUUMGKDn0vvQ9upQM/hKiiebuxB1aw=,tag:PvA+0m+UcgDNOdznnv96IA==,type:str]
    pgp: []
    encrypted_regex: ^(apiKey|appUserPassword|otelUserPassword|harborAdminPassword|totpVaultKey|kimaiAppSecret|kimaiAdminPassword|GITHUB_CLIENT_ID|GITHUB_CLIENT_SECRET|GITHUB_PRIVATE_KEY|woosh|root_password|rspamd_password|pgdb_password|matrix_access_token|pgdb_remote_url|hmac_secret_key|adminPassword|adminEmail|jenkinsAdminEmail|securityRealm|gerrit.config|routing_key|DATABASE_URL|SMTP_PASSWORD|SECRET_KEY_BASE|admin_password|extraCommands|key|clickhouseDatabaseURL|databaseURL|client_id|client_secret|secret_key_base|otp_secret|private_key|public_key|primaryKey|deterministicKey|keyDerivationSalt|token|clientId|secretKey|installationId|installationKey|uriOverride|adminToken.value|password.value|sql_password|erlangCookie|AUTHENTICATION_PASSWORD|ROOM_API_SECRET_KEY|adminPassword|configPassword|adminUser|configUser|MAIL_PASSWORD|APP_KEY|api_key|api_secret|keys|livekit_key|livekit_secret|secret_key|admin_pass|admin_email|mariadbPassword|mariadbRootPassword|privateKey|data|stringData|PASSWD|password|pass|postgresPassword|postgresqlPassword|redminePassword|smtpPassword|registration_shared_secret|shared_secret|secret|admin_token|integrationKey|integration_key|rootPassword|adminPassword|adminUser|adminEmail|emailPassword|secretKey|appId|clientSecret|webhookSecret)$
    version: 3.9.1
