apiVersion: helm.toolkit.fluxcd.io/v2
kind: HelmRelease
metadata:
    name: prometheus-stack
    namespace: monitoring
spec:
    interval: 5m
    chart:
        spec:
            version: 82.x
            chart: kube-prometheus-stack
            sourceRef:
                kind: HelmRepository
                name: prometheus-community
            interval: 60m
    install:
        crds: CreateReplace
    upgrade:
        crds: CreateReplace
    # https://github.com/prometheus-community/helm-charts/blob/main/charts/kube-prometheus-stack/values.yaml
    values:
        kubeProxy:
            enabled: false
        alertmanager:
            config:
                global:
                    resolve_timeout: 5m
                    pagerduty_url: https://events.eu.pagerduty.com/v2/enqueue
                route:
                    receiver: pagerduty-warning
                    group_by:
                        - alertname
                        - namespace
                    group_wait: 30s
                    group_interval: 5m
                    repeat_interval: 4h
                    routes:
                        - receiver: "null"
                          matchers:
                            - alertname = "Watchdog"
                        - receiver: "null"
                          matchers:
                            - alertname = "InfoInhibitor"
                        - receiver: "null"
                          matchers:
                            - severity = "info"
                        - receiver: pagerduty-draupnir4all
                          matchers:
                            - service_id = "draupnir4all"
                        - receiver: pagerduty-critical
                          matchers:
                            - severity = "critical"
                receivers:
                    - name: "null"
                    - name: pagerduty-critical
                      pagerduty_configs:
                        - routing_key: ENC[AES256_GCM,data:+odFhnTeR5Q6ecWh8u1bXkGy83kM8cGMxmpjto8UHWE=,iv:A5omVKWV4aKvDoI0uCLJdKqbhwLv6Hi8ToBF9d2HNHI=,tag:10VyDUFiGLh3yMOsDRQnYg==,type:str]
                          severity: critical
                    - name: pagerduty-warning
                      pagerduty_configs:
                        - routing_key: ENC[AES256_GCM,data:HxG4V18Pt2pNS+YBTRfIP5ubVK8bl0O/IviBAX00UcY=,iv:M+eBaQxN9oZLof5dHVZ8LNqvsg0bL1q75Ym+L3ggTEs=,tag:KcvUcwnX4VzoOq0G94RHyg==,type:str]
                          severity: warning
                    - name: pagerduty-draupnir4all
                      pagerduty_configs:
                        - routing_key: ENC[AES256_GCM,data:rYrndMSv+eDTSXM4M3GaLBz7FqAKzkp/FUZa/DUaw68=,iv:EI9FNO9F3t+wlqWY/DzoRufl2Y0uCwWtSmdyns1aHLY=,tag:ckRvM9IF+JKZJDx2XGwZPg==,type:str]
                          severity: critical
                inhibit_rules:
                    - source_matchers:
                        - severity = "critical"
                      target_matchers:
                        - severity = "warning"
                      equal:
                        - namespace
                        - alertname
        prometheus:
            prometheusSpec:
                retention: 4h
                externalLabels:
                    k8s_cluster: midnightthoughts
                # Pick up all ServiceMonitors/PodMonitors/etc. regardless of labels
                serviceMonitorSelectorNilUsesHelmValues: false
                serviceMonitorSelector: {}
                serviceMonitorNamespaceSelector: {}
                podMonitorSelectorNilUsesHelmValues: false
                podMonitorSelector: {}
                podMonitorNamespaceSelector: {}
                probeSelectorNilUsesHelmValues: false
                probeSelector: {}
                probeNamespaceSelector: {}
                ruleSelectorNilUsesHelmValues: false
                ruleSelector: {}
                ruleNamespaceSelector: {}
                scrapeConfigSelectorNilUsesHelmValues: false
                scrapeConfigSelector: {}
                scrapeConfigNamespaceSelector: {}
                # Thanos sidecar uploads completed TSDB blocks to Hetzner S3.
                # First block is cut after ~3h (Prometheus head span must exceed chunkRange Ã— 1.5 = 3h).
                # Subsequent blocks are cut every 2h once the head is warm.
                thanos:
                    objectStorageConfig:
                        existingSecret:
                            name: thanos-objstore-secret
                            key: ENC[AES256_GCM,data:+mxCwOcN,iv:XKQsX0b7KaL0JyFIpUc/MHic/9CbsBXqeKNcCC74Uug=,tag:uTU+H5RoE6k02SKkhUnYkQ==,type:str]
                storageSpec:
                    volumeClaimTemplate:
                        spec:
                            storageClassName: longhorn-2replicas
                            accessModes:
                                - ReadWriteOnce
                            resources:
                                requests:
                                    storage: 10Gi
        grafana:
            adminPassword: ENC[AES256_GCM,data:/5mxvbNxzereGYijhxinaUhyhJzY9kZWKX4S6wMx3+cb5bDAM1RJ8jdupi8vWLHYcNi0FBxKO9TcKz5muj03Tg==,iv:Ri6rJYgYhB3h4pVqKUipjiymXnvXAWTCGKxq/AJvVyI=,tag:aVsBkHeMCSYTLvUc7+/cFA==,type:str]
            sidecar:
                datasources:
                    # Disable the auto-generated default Prometheus datasource so it
                    # doesn't conflict with our custom datasources.yaml (which points to Thanos)
                    defaultDatasourceEnabled: false
                dashboards:
                    folderAnnotation: grafana_folder
                    provider:
                        foldersFromFilesStructure: true
                    logLevel: WARN
                    watchServerTimeout: 3600
                    enabled: true
            plugins:
                - grafana-piechart-panel
                - grafana-worldmap-panel
                - isovalent-hubble-datasource
                - isovalent-hubbleprocessancestry-panel
                - chaosmeshorg-datasource
            smtp:
                existingSecret: smtp-auth-secret
            extraSecretMounts:
                - name: auth-generic-oauth-secret-mount
                  secretName: auth-generic-oauth-secret
                  defaultMode: 288
                  mountPath: /etc/secrets/auth_generic_oauth
                  readOnly: true
            defaultDashboardsTimezone: Europe/Berlin
            datasources:
                datasources.yaml:
                    apiVersion: 1
                    datasources:
                        - name: Prometheus
                          type: prometheus
                          uid: prometheus
                          url: http://thanos-query-frontend.monitoring.svc.cluster.local:10902
                          access: proxy
                        - name: ChaosMesh
                          type: chaosmeshorg-datasource
                          url: http://chaos-dashboard.chaosmesh.svc.cluster.local:2333
                          access: proxy
                          isDefault: false
                        - name: Hubble
                          type: isovalent-hubble-datasource
                          uid: hubble
                          access: proxy
                          url: http://hubble-relay.kube-system.svc.cluster.local:80
                          isDefault: false
                          jsonData:
                            serviceMap:
                                datasourceUid: prometheus
                            prometheusDatasourceUid: prometheus
                        - name: Postgres-d4all
                          type: postgres
                          uid: postgres-d4all
                          access: proxy
                          url: pg-cluster-v2-ro.postgres-cluster.svc.cluster.local:5432
                          database: draupnir_synapse
                          user: grafana-ro
                          secureJsonData:
                            password: ENC[AES256_GCM,data:2K8OTkvxI1YxNDTBaDzXm8rqCo8HyAfKpYiGuMVrrV7yzP1fuYR1VmCnSJLFkFYOili42IiHFJkb+AlhtKeR2A==,iv:5c39CpktW8SNz9bGCmItO6rfjc6yzsta61Xc87r6cHw=,tag:YJMqeMpt69HCaV0EdS5VQQ==,type:str]
                          isDefault: false
                          jsonData:
                            sslmode: disable
                            maxIdleConnsAuto: true
                            timescaledb: false
                            maxOpenConns: 10
                            maxIdleConns: 10
                        - name: Postgres-connectivity-tester
                          type: postgres
                          uid: postgres-connectivity-tester
                          access: proxy
                          url: pg-cluster-v2-ro.postgres-cluster.svc.cluster.local:5432
                          database: connectivity-tester
                          user: connectivity-tester
                          secureJsonData:
                            password: ENC[AES256_GCM,data:pZXnJ1YMFeG3WRw6eAab9h5MzxiBESCJnd0dtoVbrTVEJ3z3T4/Q/+HHYpeZOB+WvAtq2ArG0Pi7D+HMIc3LSw==,iv:B0vfHLNX1AxitGIJGZ7H1pE+erFnFC26a9C+0p/LUmU=,tag:t1CAKO+HYKWR5EkhvfQkOg==,type:str]
                          isDefault: false
                          jsonData:
                            sslmode: disable
                            maxIdleConnsAuto: true
                            timescaledb: false
                            maxOpenConns: 10
                            maxIdleConns: 10
            ingress:
                enabled: false
            grafana.ini:
                server:
                    root_url: https://grafana.midnightthoughts.space
                smtp:
                    enabled: true
                    host: smtp.fastmail.com:465
                    from_address: ops@nordgedanken.dev
                paths:
                    data: ENC[AES256_GCM,data:wY9lBRuqSChoutDYRM3rWUs=,iv:fuIsp/sZuYxZtJScO5fTOWQOk/qxqvwpdA06VtNrqD8=,tag:I5KBNKTaT6EBatVWKTtrdg==,type:str]
                    logs: /var/log/grafana
                    plugins: /var/lib/grafana/plugins
                    provisioning: /etc/grafana/provisioning
                analytics:
                    check_for_updates: true
                log:
                    mode: console
                grafana_net:
                    url: https://grafana.net
                auth:
                    signout_redirect_url: https://auth.midnightthoughts.space/application/o/grafana/end-session/
                    oauth_auto_login: true
                auth.generic_oauth:
                    name: authentik
                    enabled: true
                    client_id: ENC[AES256_GCM,data:KpJM0WJInd2OAqgftnGY77b07JFE6A9yjusHCTgLq5UxpduartmW8a3EUklnjK+QAXU=,iv:TNwmrgMqTR2OlGywNUly34boVZF1b4iknIE/nqPGNKE=,tag:HklHZzEW+UHAi1YflzCDFg==,type:str]
                    client_secret: ENC[AES256_GCM,data:iJ6tF2Uu/rixG7SyskRLqjDGfyYRqgdNKw0cW98wB8/JkWK6wc9K6RFegLvv2GW6JC14LC2D,iv:Y/qHzYvi79b73PjJKinMI4O2zhaP+Z2vxi4fBVg6GiQ=,tag:qBT75u5D7eNNnzATGg7hGQ==,type:str]
                    scopes: openid email profile
                    auth_url: https://auth.midnightthoughts.space/application/o/authorize/
                    token_url: https://auth.midnightthoughts.space/application/o/token/
                    api_url: https://auth.midnightthoughts.space/application/o/userinfo/
                    role_attribute_path: contains(groups, 'Grafana Admins') && 'Admin' || contains(groups, 'Grafana Editors') && 'Editor' || 'Viewer'
            imageRenderer:
                enabled: true
            alerting:
                rules.yaml:
                    apiVersion: 1
                    groups:
                        - orgId: 1
                          name: CertManager
                          folder: Cluster
                          interval: 5m
                          rules:
                            - uid: ddz3zj028wb28b
                              title: CertManagerHittingRateLimits
                              condition: B
                              data:
                                - refId: ENC[AES256_GCM,data:Rw==,iv:KqBUT17dwxeGOCXpO3ztG4oFfxuZsOlqaOuxn7ws1DY=,tag:aNGC6W0eY+LPV4ruAD7NxQ==,type:str]
                                  relativeTimeRange:
                                    from: ENC[AES256_GCM,data:13kk,iv:jgu+n3iJfvRiBodz9JkzZUPw/zspD7LFE/9Jmr92ipM=,tag:tbuACYKrBb3hdfjukzIrSw==,type:int]
                                    to: ENC[AES256_GCM,data:/A==,iv:qIoVSqLwsFmUPK+JKzjm0U7IRzTJ1lUJClsKWBi7QNw=,tag:kTwR9eRzoG0XluEbYnv/+Q==,type:int]
                                  datasourceUid: ENC[AES256_GCM,data:sfgPciqrGaHWrg==,iv:cZ1gMCghjg+vOXWAA5c+jNABvbep/+zXuYXGE23T4t8=,tag:UDV9E6BFQfXuvO3SI7HTqQ==,type:str]
                                  model:
                                    editorMode: ENC[AES256_GCM,data:mdEqIw==,iv:ptukYPVgRiw5NI405VzUGsoj72uog6Cmq9ZLtZzn15U=,tag:WgVkNCibPKNjV+QwMF4f/Q==,type:str]
                                    expr: ENC[AES256_GCM,data:p3S3ea1MKkzVIfhSUYBwWlIlcSWt2R/pO5ayj4QDtTQJIzssAgYOqxW4sZvYNgyXyYFFE1q2OaiS9a73s6dSIYRZTLQ6cOLTb3h41RGzXjaA0oL/wONiJ4/iu4DU6iC1kA0ZfBcSaJ5HNmA1JVnpqLCO,iv:CJwZ+xud+OoOd5ZRwIFqX1Ti2+DivhOWOqEbyxI8E4I=,tag:RSRdeFwfND962HsaiIePDA==,type:str]
                                    instant: ENC[AES256_GCM,data:VNHECA==,iv:z7EzMMoES3NTgyUXBjA+X/lJdyf/kAOydSZdK2tpFp0=,tag:iQ77cp2yI6NbdHJcyGpVSA==,type:bool]
                                    intervalMs: ENC[AES256_GCM,data:vq2tyw==,iv:uiM+l2ZgjTgXMFwpaGawqV2ipKHWgJudSC96ac9c6fM=,tag:b3EfkIQQIkjPRf/j5pFmCg==,type:int]
                                    legendFormat: ENC[AES256_GCM,data:kDlGpG1Y,iv:Nz3bbyMQnDrEEnkGq5ihGTQqTw10v70G3WHuBmBn7+I=,tag:7wB0hwOrXG98cXLJWh857A==,type:str]
                                    maxDataPoints: ENC[AES256_GCM,data:TzCe6vY=,iv:/wzNj648fNAlQp+ZRTl3Cp91RPYMHyZljVuI4tTaKx8=,tag:09Lei0jIElTNfdsW6MMD1g==,type:int]
                                    range: ENC[AES256_GCM,data:72ulIvo=,iv:Us3hrewaHAi7jPfUSP5IPIzAdtXtSHvNvJC5eHuM0z4=,tag:eh8yuCoctFfvcaWMR0UwQQ==,type:bool]
                                    refId: ENC[AES256_GCM,data:sQ==,iv:0+Mqs/VNXzztqBddEge2XDFLf3VkJC7BSKsIcWM+LF8=,tag:WoW+ptqZyoBvd3XYtap3/w==,type:str]
                                - refId: ENC[AES256_GCM,data:Sg==,iv:mSTlWNvs1w8Oik4q72lb9gBGo3whnOftOSiUCfrb2AU=,tag:IiqvAD33sK8tSKjIdelwvw==,type:str]
                                  relativeTimeRange:
                                    from: ENC[AES256_GCM,data:KV8y,iv:cptjcaQzjfKTlnU6Pm5+ksV/gj2xD/IRZdGouJpuD+M=,tag:AQeYFYR0wKGgVDE7TPqkkA==,type:int]
                                    to: ENC[AES256_GCM,data:aQ==,iv:DSUW+CTt4YP+AMytfJNYGk57QWo/aZ9h7BHVTEQmLYk=,tag:IFktDFJlwXsSwRqV6i6HFQ==,type:int]
                                  datasourceUid: ENC[AES256_GCM,data:qfuMs92/8XQ=,iv:R0XUhcD77Ls5iH0x8XGepNRZ1E2A4JaywoaPQx+VYVc=,tag:tKv0AQ1tJm7mcT5ZeFX4Zw==,type:str]
                                  model:
                                    conditions:
                                        - evaluator:
                                            params: []
                                            type: ENC[AES256_GCM,data:ymM=,iv:1tWP3POaE0ObNBmKXqDRd9wJxSubIbxfhL5WGp1HdnM=,tag:s055BdyARGaaiW8t2rqy2g==,type:str]
                                          operator:
                                            type: ENC[AES256_GCM,data:OdJF,iv:jknpAEDW3sqmrm6HPPpHCM98D3QoDNQBDPhM+F+09nE=,tag:QWxutv2RoafF47ZWZyFMtw==,type:str]
                                          query:
                                            params:
                                                - ENC[AES256_GCM,data:vA==,iv:83nujlA2JoPS2q2AN2UOYALy2UxhLCRWI/zoofuqbPQ=,tag:Lb4/2FE5nQPJwOKm1EtfVw==,type:str]
                                          reducer:
                                            params: []
                                            type: ENC[AES256_GCM,data:TILLPA==,iv:EeZAzDDPgVX/Poxa3DESSwW4m9X6lXFWMJdAeWDE7eI=,tag:yZqVLM/Scol2HTqzPhh/Bw==,type:str]
                                          type: ENC[AES256_GCM,data:uG2AAfU=,iv:0Z1v2gviBeEM/BF8ULcUVGrTt3yUK8F6SW2z8e3Lly4=,tag:LaeWQV34105uLby7aDAUYg==,type:str]
                                    datasource:
                                        type: ENC[AES256_GCM,data:QFsxAZ4n7nc=,iv:nE1cGaTEhDhIrsapRMiESCmPe2BPvo4a8vI/uGme7cQ=,tag:GCLVyjOp/txdhPpo+rRBFg==,type:str]
                                        uid: ENC[AES256_GCM,data:f8ijMRweC3I=,iv:vAXQFt9n+M0ant4EPM0+ueMlgM5Tqrmg0nSc5qVGCEA=,tag:PKJqlXk2RUtC5z5+JdFQHw==,type:str]
                                    expression: ENC[AES256_GCM,data:gw==,iv:SB3YwEOJNMaFXVErkYdbbm0x/jBfplIDaI1vUq3KktE=,tag:fjJtgafKrCYtxinsVDYXMg==,type:str]
                                    intervalMs: ENC[AES256_GCM,data:dkBGzA==,iv:/siTm8IaFmjy1CzypmGGFkv9BvC8529OyDwv+b4GBkA=,tag:/5mRlKgllZPb3JJqIdGUkA==,type:int]
                                    maxDataPoints: ENC[AES256_GCM,data:P7mFJxk=,iv:rMXsO7BhIC8MrYCUUBR+GZc9vqXu3I/A93B0j8vfX3w=,tag:7u0fCxbeXx9A3m9HMC1aoA==,type:int]
                                    reducer: ENC[AES256_GCM,data:MbOKVw==,iv:Sh2cMMrAQ1FL0w1gVExuBchssqBA1I1i0uh5ggk4XEY=,tag:2RarQrTO01J3J0LKO0CXgw==,type:str]
                                    refId: ENC[AES256_GCM,data:bQ==,iv:czHLU6000mhWzFizaQLm7hernGTU7F/ZHsbaZzyvgnw=,tag:w3fBdm1vBHNidwAVt159IA==,type:str]
                                    type: ENC[AES256_GCM,data:Ypi4DtuS,iv:NPI4JWPqxPWzB7HpYtquhxRIvsP0ofvAde+Dvb/3VBo=,tag:/gdV7g4CjvHLCL0yJwv1zg==,type:str]
                              noDataState: OK
                              execErrState: Error
                              for: 5m
                              annotations:
                                description: Depending on the rate limit, cert-manager may be unable to generate certificates for up to a week.
                                summary: Cert manager hitting LetsEncrypt rate limits.
                              labels: {}
                              isPaused: false
                              notification_settings:
                                receiver: PagerDuty Warning
                contactpoints.yaml:
                    apiVersion: 1
                    contactPoints:
                        - orgId: 1
                          name: MidnightThoughts Ops
                          receivers:
                            - uid: "1"
                              name: MidnightThoughts Ops
                              type: email
                              sendReminder: true
                              frequency: 1m
                              settings:
                                addresses: ops@nordgedanken.dev;mtrnord@nordgedanken.dev;mtrnord1@gmail.com
                        - orgId: 1
                          name: PagerDuty
                          receivers:
                            - uid: adz30e8814wshd
                              type: pagerduty
                              settings:
                                integrationKey: ENC[AES256_GCM,data:FztLINdYCvdYNoqXpdjOhleDo7AyOFJIVaxz8r2a174=,iv:vZJJbgm4c5O9hwmy+Av2oIbNha80BIBI7QHFyeWe0fU=,tag:bjQTIpS2FYjCxAxGfUfMmg==,type:str]
                                url: https://events.eu.pagerduty.com/v2/enqueue
                              disableResolveMessage: false
                        - orgId: 1
                          name: PagerDuty Warning
                          receivers:
                            - uid: pg_warning
                              type: pagerduty
                              settings:
                                integrationKey: ENC[AES256_GCM,data:N573IqSI0I4McBeode3d31f539HsZgN80R+dHcJmhiQ=,iv:9O4Bi6Ji1DYe/m8F2Tf3PtqXZE9vDFlpXX3nrHsKRG8=,tag:yJySDEzhX6M4XbTLVBvcRg==,type:str]
                                severity: warning
                                url: https://events.eu.pagerduty.com/v2/enqueue
                              disableResolveMessage: false
                        - orgId: 1
                          name: PagerDuty Draupnir4All
                          receivers:
                            - uid: "3"
                              type: pagerduty
                              settings:
                                integrationKey: ENC[AES256_GCM,data:k3+CEIJcisO8VsOX5y6/2iGMiAkZKxknSvqq4pLLXfg=,iv:G4l+v9XC9ZnZwG4ZzM+WXun3j+z4TbangwBh9/+NK5w=,tag:4Uu4wgauVnuZ9/JNyEBa8A==,type:str]
                                url: https://events.eu.pagerduty.com/v2/enqueue
                              disableResolveMessage: false
                        - orgId: 1
                          name: PagerDuty Draupnir4All Warning
                          receivers:
                            - uid: de02at943dxxcf
                              type: pagerduty
                              settings:
                                integrationKey: ENC[AES256_GCM,data:4DluBpKxfnVs8rlx3y7tZLuJJX/bENzB2uAr33adeXA=,iv:Za/wRGJYzSUrUT7WnPhCyauy7sbtBHm09OvXNC9lWPM=,tag:J9CzIAf3qTdJHKluHX7BbA==,type:str]
                                severity: warning
                                url: https://events.eu.pagerduty.com/v2/enqueue
                              disableResolveMessage: false
                policies.yaml:
                    apiVersion: 1
                    policies:
                        - orgId: 1
                          receiver: PagerDuty
                          group_by:
                            - grafana_folder
                            - alertname
                          routes:
                            - receiver: PagerDuty
                              object_matchers:
                                - - service_id
                                  - '!='
                                  - draupnir4all
                            - receiver: PagerDuty Draupnir4All
                              object_matchers:
                                - - service_id
                                  - =
                                  - draupnir4all
                            - receiver: MidnightThoughts Ops
    postRenderers:
        - kustomize:
            patches:
                - target:
                    # Ignore these objects from Flux diff as they are mutated from chart hooks
                    kind: (ValidatingWebhookConfiguration|MutatingWebhookConfiguration)
                    name: kube-prometheus-stack-admission
                  patch: |
                    - op: add
                      path: /metadata/annotations/helm.toolkit.fluxcd.io~1driftDetection
                      value: disabled
                - target:
                    # Ignore these objects from Flux diff as they are mutated at apply time but not at dry-run time
                    kind: PrometheusRule
                  patch: |
                    - op: add
                      path: /metadata/annotations/helm.toolkit.fluxcd.io~1driftDetection
                      value: disabled
sops:
    kms: []
    gcp_kms: []
    azure_kv: []
    hc_vault: []
    age:
        - recipient: age1esjyg2qfy49awv0ptkzvpk425adczjr38m37w2mmcahzc4p8n54sll2nzh
          enc: |
            -----BEGIN AGE ENCRYPTED FILE-----
            YWdlLWVuY3J5cHRpb24ub3JnL3YxCi0+IFgyNTUxOSBFLy9DbmpOTzMxUUJpRXdH
            Zit4TVgrVVBudU9CU09RNGdDakM2RUgxUnhVCnR0T0ZmS3pDRlNNQ1FobUVZaUlr
            dWlhbDNvWFVGL290azA0cUMzNXRna0EKLS0tIE91WE1GeEk4dTAzOGxaU2JOVWNW
            b3hjbVZDL2xVZi81QmNpTzdFWjdwZzgKYqzkzul0qxh1pVIyfkn2p1rtgo8UM8z7
            l1yP06/Gs6p15NcP+52hgi4cpNC3O88Xn0koFXatzRmQzgn85YZfLQ==
            -----END AGE ENCRYPTED FILE-----
    lastmodified: "2026-02-28T21:28:58Z"
    mac: ENC[AES256_GCM,data:RMezxZNYZ7EBuWwt48hqbA0M5IH6jnFrEgDTX6J00fPFZwIFUNnLeWEPEnUlFy9I6E1+Kp3tLOYhU2nRExT0RAIFqVVUuxIvylN08NsHbLVX89VNlC/3G4hyXn712PDDuskEdyGP2IdSpllOksoYpqs/o7fDKIyQNmHiADdXbLk=,iv:wm6Ghy3Sq4xWz4GcT/2KO0xMdbj+RNLZJDvWx7VrdnY=,tag:WoJuBZvykCBxGBE9NWoDTA==,type:str]
    pgp: []
    encrypted_regex: ^(apiKey|appUserPassword|otelUserPassword|harborAdminPassword|totpVaultKey|kimaiAppSecret|kimaiAdminPassword|GITHUB_CLIENT_ID|GITHUB_CLIENT_SECRET|GITHUB_PRIVATE_KEY|woosh|root_password|rspamd_password|pgdb_password|matrix_access_token|pgdb_remote_url|hmac_secret_key|adminPassword|adminEmail|jenkinsAdminEmail|securityRealm|gerrit.config|routing_key|DATABASE_URL|SMTP_PASSWORD|SECRET_KEY_BASE|admin_password|extraCommands|key|clickhouseDatabaseURL|databaseURL|client_id|client_secret|secret_key_base|otp_secret|private_key|public_key|primaryKey|deterministicKey|keyDerivationSalt|token|clientId|secretKey|installationId|installationKey|uriOverride|adminToken.value|password.value|sql_password|erlangCookie|AUTHENTICATION_PASSWORD|ROOM_API_SECRET_KEY|adminPassword|configPassword|adminUser|configUser|MAIL_PASSWORD|APP_KEY|api_key|api_secret|keys|livekit_key|livekit_secret|secret_key|admin_pass|admin_email|mariadbPassword|mariadbRootPassword|privateKey|data|stringData|PASSWD|password|pass|postgresPassword|postgresqlPassword|redminePassword|smtpPassword|registration_shared_secret|shared_secret|secret|admin_token|integrationKey|integration_key|rootPassword|adminPassword|adminUser|adminEmail|emailPassword|secretKey|appId|clientSecret|webhookSecret)$
    version: 3.9.1
---
apiVersion: gateway.networking.k8s.io/v1
kind: HTTPRoute
metadata:
    name: grafana
    namespace: monitoring
spec:
    parentRefs:
        - name: envoy-gateway
          namespace: envoy-gateway
    hostnames:
        - grafana.midnightthoughts.space
    rules:
        - backendRefs:
            - name: prometheus-stack-grafana
              port: 80
          timeouts:
            request: 240s
            backendRequest: 0s
sops:
    kms: []
    gcp_kms: []
    azure_kv: []
    hc_vault: []
    age:
        - recipient: age1esjyg2qfy49awv0ptkzvpk425adczjr38m37w2mmcahzc4p8n54sll2nzh
          enc: |
            -----BEGIN AGE ENCRYPTED FILE-----
            YWdlLWVuY3J5cHRpb24ub3JnL3YxCi0+IFgyNTUxOSBFLy9DbmpOTzMxUUJpRXdH
            Zit4TVgrVVBudU9CU09RNGdDakM2RUgxUnhVCnR0T0ZmS3pDRlNNQ1FobUVZaUlr
            dWlhbDNvWFVGL290azA0cUMzNXRna0EKLS0tIE91WE1GeEk4dTAzOGxaU2JOVWNW
            b3hjbVZDL2xVZi81QmNpTzdFWjdwZzgKYqzkzul0qxh1pVIyfkn2p1rtgo8UM8z7
            l1yP06/Gs6p15NcP+52hgi4cpNC3O88Xn0koFXatzRmQzgn85YZfLQ==
            -----END AGE ENCRYPTED FILE-----
    lastmodified: "2026-02-28T21:28:58Z"
    mac: ENC[AES256_GCM,data:RMezxZNYZ7EBuWwt48hqbA0M5IH6jnFrEgDTX6J00fPFZwIFUNnLeWEPEnUlFy9I6E1+Kp3tLOYhU2nRExT0RAIFqVVUuxIvylN08NsHbLVX89VNlC/3G4hyXn712PDDuskEdyGP2IdSpllOksoYpqs/o7fDKIyQNmHiADdXbLk=,iv:wm6Ghy3Sq4xWz4GcT/2KO0xMdbj+RNLZJDvWx7VrdnY=,tag:WoJuBZvykCBxGBE9NWoDTA==,type:str]
    pgp: []
    encrypted_regex: ^(apiKey|appUserPassword|otelUserPassword|harborAdminPassword|totpVaultKey|kimaiAppSecret|kimaiAdminPassword|GITHUB_CLIENT_ID|GITHUB_CLIENT_SECRET|GITHUB_PRIVATE_KEY|woosh|root_password|rspamd_password|pgdb_password|matrix_access_token|pgdb_remote_url|hmac_secret_key|adminPassword|adminEmail|jenkinsAdminEmail|securityRealm|gerrit.config|routing_key|DATABASE_URL|SMTP_PASSWORD|SECRET_KEY_BASE|admin_password|extraCommands|key|clickhouseDatabaseURL|databaseURL|client_id|client_secret|secret_key_base|otp_secret|private_key|public_key|primaryKey|deterministicKey|keyDerivationSalt|token|clientId|secretKey|installationId|installationKey|uriOverride|adminToken.value|password.value|sql_password|erlangCookie|AUTHENTICATION_PASSWORD|ROOM_API_SECRET_KEY|adminPassword|configPassword|adminUser|configUser|MAIL_PASSWORD|APP_KEY|api_key|api_secret|keys|livekit_key|livekit_secret|secret_key|admin_pass|admin_email|mariadbPassword|mariadbRootPassword|privateKey|data|stringData|PASSWD|password|pass|postgresPassword|postgresqlPassword|redminePassword|smtpPassword|registration_shared_secret|shared_secret|secret|admin_token|integrationKey|integration_key|rootPassword|adminPassword|adminUser|adminEmail|emailPassword|secretKey|appId|clientSecret|webhookSecret)$
    version: 3.9.1
