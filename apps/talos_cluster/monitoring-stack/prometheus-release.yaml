apiVersion: helm.toolkit.fluxcd.io/v2
kind: HelmRelease
metadata:
    name: prometheus-stack
    namespace: monitoring
spec:
    interval: 5m
    chart:
        spec:
            version: 82.x
            chart: kube-prometheus-stack
            sourceRef:
                kind: HelmRepository
                name: prometheus-community
            interval: 60m
    install:
        crds: CreateReplace
    upgrade:
        crds: CreateReplace
    # https://github.com/prometheus-community/helm-charts/blob/main/charts/kube-prometheus-stack/values.yaml
    values:
        kubeProxy:
            enabled: false
        alertmanager:
            config:
                global:
                    resolve_timeout: 5m
                    pagerduty_url: https://events.eu.pagerduty.com/v2/enqueue
                route:
                    receiver: pagerduty-warning
                    group_by:
                        - alertname
                        - namespace
                    group_wait: 30s
                    group_interval: 5m
                    repeat_interval: 4h
                    routes:
                        - receiver: "null"
                          matchers:
                            - alertname = "Watchdog"
                        - receiver: "null"
                          matchers:
                            - alertname = "InfoInhibitor"
                        - receiver: pagerduty-draupnir4all
                          matchers:
                            - service_id = "draupnir4all"
                        - receiver: pagerduty-critical
                          matchers:
                            - severity = "critical"
                receivers:
                    - name: "null"
                    - name: pagerduty-critical
                      pagerduty_configs:
                        - routing_key: ENC[AES256_GCM,data:wpuKTu44j7cjgeME7hPtkgvXwLkScbciDpT8bFSXI6A=,iv:66+aPqWnJHz2Rwb+dSo5Vve01PH6Of7ZfkuwnQGpkdI=,tag:rC7Tvt6aZD+/2h8sehiMAw==,type:str]
                          severity: critical
                    - name: pagerduty-warning
                      pagerduty_configs:
                        - routing_key: ENC[AES256_GCM,data:L5l5ui7WTV5pwUOlSNFh5lUFUnPvP95Gq5/2wLAS+6k=,iv:boPXn7l9aPJ2Vl3lMZG1UVbf5R+a7Ecw2xGrzn3z/E8=,tag:Rpfe8zilW4mQuGXKTMr5HA==,type:str]
                          severity: warning
                    - name: pagerduty-draupnir4all
                      pagerduty_configs:
                        - routing_key: ENC[AES256_GCM,data:2YK7aDwRXwx1kecyZafuBpb1NovepKzC/JvMHtGC8YE=,iv:EW+lNxpkHSsq1pkdTVI88gTi/XpVdgi4cF6dqccn19E=,tag:HUI+b2n6rPNS2TW2Jme+eA==,type:str]
                          severity: critical
                inhibit_rules:
                    - source_matchers:
                        - severity = "critical"
                      target_matchers:
                        - severity = "warning"
                      equal:
                        - namespace
                        - alertname
        prometheus:
            prometheusSpec:
                retention: 4h
                externalLabels:
                    k8s_cluster: midnightthoughts
                # Pick up all ServiceMonitors/PodMonitors/etc. regardless of labels
                serviceMonitorSelectorNilUsesHelmValues: false
                serviceMonitorSelector: {}
                serviceMonitorNamespaceSelector: {}
                podMonitorSelectorNilUsesHelmValues: false
                podMonitorSelector: {}
                podMonitorNamespaceSelector: {}
                probeSelectorNilUsesHelmValues: false
                probeSelector: {}
                probeNamespaceSelector: {}
                ruleSelectorNilUsesHelmValues: false
                ruleSelector: {}
                ruleNamespaceSelector: {}
                scrapeConfigSelectorNilUsesHelmValues: false
                scrapeConfigSelector: {}
                scrapeConfigNamespaceSelector: {}
                # Thanos sidecar uploads completed TSDB blocks to Hetzner S3.
                # First block is cut after ~3h (Prometheus head span must exceed chunkRange Ã— 1.5 = 3h).
                # Subsequent blocks are cut every 2h once the head is warm.
                thanos:
                    objectStorageConfig:
                        existingSecret:
                            name: thanos-objstore-secret
                            key: ENC[AES256_GCM,data:QZ0jCOvd,iv:j0+5QYIND4IZKlZzYAaSfk6kADB1MNmvf8PrblngYpY=,tag:oY3v2jDzphqdej7yg19EWg==,type:str]
                storageSpec:
                    volumeClaimTemplate:
                        spec:
                            storageClassName: longhorn-2replicas
                            accessModes:
                                - ReadWriteOnce
                            resources:
                                requests:
                                    storage: 10Gi
        grafana:
            adminPassword: ENC[AES256_GCM,data:KRJ4mMDx1U0kQAXf6NH4NOF1i78QznNmfxsNihPAzzKZK4107IIhiwVahsOI/BJ+BMnyNMGnwt/m8QnHLCvn5w==,iv:mcxfuA4BcDLAsxTus9x7jfG0ASD8ke8O8//8Ka+cCW4=,tag:2xLZzA3zLeKEgsNkMOT0Dg==,type:str]
            sidecar:
                datasources:
                    # Disable the auto-generated default Prometheus datasource so it
                    # doesn't conflict with our custom datasources.yaml (which points to Thanos)
                    defaultDatasourceEnabled: false
                dashboards:
                    folderAnnotation: grafana_folder
                    provider:
                        foldersFromFilesStructure: true
                    logLevel: WARN
                    watchServerTimeout: 3600
                    enabled: true
            plugins:
                - grafana-piechart-panel
                - grafana-worldmap-panel
                - isovalent-hubble-datasource
                - isovalent-hubbleprocessancestry-panel
                - chaosmeshorg-datasource
            smtp:
                existingSecret: smtp-auth-secret
            extraSecretMounts:
                - name: auth-generic-oauth-secret-mount
                  secretName: auth-generic-oauth-secret
                  defaultMode: 288
                  mountPath: /etc/secrets/auth_generic_oauth
                  readOnly: true
            defaultDashboardsTimezone: Europe/Berlin
            datasources:
                datasources.yaml:
                    apiVersion: 1
                    datasources:
                        - name: Prometheus
                          type: prometheus
                          uid: prometheus
                          url: http://thanos-query-frontend.monitoring.svc.cluster.local:10902
                          access: proxy
                        - name: ChaosMesh
                          type: chaosmeshorg-datasource
                          url: http://chaos-dashboard.chaosmesh.svc.cluster.local:2333
                          access: proxy
                          isDefault: false
                        - name: Hubble
                          type: isovalent-hubble-datasource
                          uid: hubble
                          access: proxy
                          url: http://hubble-relay.kube-system.svc.cluster.local:80
                          isDefault: false
                          jsonData:
                            serviceMap:
                                datasourceUid: prometheus
                            prometheusDatasourceUid: prometheus
                        - name: Postgres-d4all
                          type: postgres
                          uid: postgres-d4all
                          access: proxy
                          url: pg-cluster-v2-ro.postgres-cluster.svc.cluster.local:5432
                          database: draupnir_synapse
                          user: grafana-ro
                          secureJsonData:
                            password: ENC[AES256_GCM,data:qSZv/R8bAw8tMSn81DJpMpsCoYiVT4HYnVME7DkMbF8iGa1CosUtFSSSuAYGhEPP7TbhTpswiIaThk7YBF/lCA==,iv:bOz35InmKwfgdfI/PDyH+aQtyjgJIuULi5oYz3MmzIQ=,tag:rfOdKvm5gCM8GZwNwCnDHw==,type:str]
                          isDefault: false
                          jsonData:
                            sslmode: disable
                            maxIdleConnsAuto: true
                            timescaledb: false
                            maxOpenConns: 10
                            maxIdleConns: 10
                        - name: Postgres-connectivity-tester
                          type: postgres
                          uid: postgres-connectivity-tester
                          access: proxy
                          url: pg-cluster-v2-ro.postgres-cluster.svc.cluster.local:5432
                          database: connectivity-tester
                          user: connectivity-tester
                          secureJsonData:
                            password: ENC[AES256_GCM,data:hBgpN65myycfwt1MtsC4QmTat0SuFyX1fo9N2N7jBxUSrop79CcmXH6AVmYoNr8h1ls3FmhDlvRRqLpXtzKfrA==,iv:aQUAV/MenVQUshkxy7bREUUAZj4k3/FnhUaPRYO0iK4=,tag:SHwTI7nNH0Ak5ePaqfQtag==,type:str]
                          isDefault: false
                          jsonData:
                            sslmode: disable
                            maxIdleConnsAuto: true
                            timescaledb: false
                            maxOpenConns: 10
                            maxIdleConns: 10
            ingress:
                enabled: false
            grafana.ini:
                server:
                    root_url: https://grafana.midnightthoughts.space
                smtp:
                    enabled: true
                    host: smtp.fastmail.com:465
                    from_address: ops@nordgedanken.dev
                paths:
                    data: ENC[AES256_GCM,data:M/d3z6DvnlULVHGMV9/A0IA=,iv:jhNv1kKBEZAeeX64zEw99kXMZFrLwa+IX8xurJCVNnw=,tag:QqBjMOZ0dtNbJ30Ftocnzw==,type:str]
                    logs: /var/log/grafana
                    plugins: /var/lib/grafana/plugins
                    provisioning: /etc/grafana/provisioning
                analytics:
                    check_for_updates: true
                log:
                    mode: console
                grafana_net:
                    url: https://grafana.net
                auth:
                    signout_redirect_url: https://auth.midnightthoughts.space/application/o/grafana/end-session/
                    oauth_auto_login: true
                auth.generic_oauth:
                    name: authentik
                    enabled: true
                    client_id: ENC[AES256_GCM,data:9XZh9SuwXi3xC+5tdNuGaiek5P/Wo5+GHB5IVlWH2Mza+FqAGxaC43DLoQ9JM/dBj3g=,iv:8WP0EehPFS6T1uY2OMUggp5CFHh+12DgNCd7b+flKDc=,tag:PpABI32cFxd1wC5UZ0PRsA==,type:str]
                    client_secret: ENC[AES256_GCM,data:K4WrX4taFzazMagh+aOMOV9mr190fQx/hT8kjFeaihyyhCnCsJfN4QazepeC4KmGY+HuxHxg,iv:i17f/kF6m9DVgxmCkTHXAFlDyeTS3cMlRTbqcYs2Rw0=,tag:MmDaYKsHVo3kM22aahTnsA==,type:str]
                    scopes: openid email profile
                    auth_url: https://auth.midnightthoughts.space/application/o/authorize/
                    token_url: https://auth.midnightthoughts.space/application/o/token/
                    api_url: https://auth.midnightthoughts.space/application/o/userinfo/
                    role_attribute_path: contains(groups, 'Grafana Admins') && 'Admin' || contains(groups, 'Grafana Editors') && 'Editor' || 'Viewer'
            imageRenderer:
                enabled: true
            alerting:
                rules.yaml:
                    apiVersion: 1
                    groups:
                        - orgId: 1
                          name: CertManager
                          folder: Cluster
                          interval: 5m
                          rules:
                            - uid: ddz3zj028wb28b
                              title: CertManagerHittingRateLimits
                              condition: B
                              data:
                                - refId: ENC[AES256_GCM,data:mg==,iv:L5ZZyBt/y6r+cODYG6u7F89dj6hH0uB2e9OeCFyXTAU=,tag:buX6YQpZs3rfCdg6YENsGQ==,type:str]
                                  relativeTimeRange:
                                    from: ENC[AES256_GCM,data:1hMn,iv:SbItPSnubEe25TIRc9OL1pCQu7AMUhpwETpSmM0PMsA=,tag:qrM7sUYBTFaHUUjDfsrebQ==,type:int]
                                    to: ENC[AES256_GCM,data:Yw==,iv:Ttf1jYX84IHeRYIZ5DtTsavfJvpedzIBGRF0wi4CkUE=,tag:W3gRE9ABIAGrIqX7226UTg==,type:int]
                                  datasourceUid: ENC[AES256_GCM,data:itAovMe3+ZocPQ==,iv:Vh+faMuW6+7xQdUjBvPd1eAdBMVatVRMHXGJDwG6PVk=,tag:/CGSpEXqTdUWMTwmYr/uHQ==,type:str]
                                  model:
                                    editorMode: ENC[AES256_GCM,data:X2PnZw==,iv:OOaPnj9D7RG46nIbdJE0pqZ1ddDlpdtAEM8VeIOQl9Y=,tag:F6kReXiV0retv4+mQCoi1g==,type:str]
                                    expr: ENC[AES256_GCM,data:w5V9w56XoXtDGa+o4Kivz1itX+nw56ED+1O/E1kCQu55bb1UrLFXIUshRZzYFHRCuDkxfwwAik11ZWe1Tq3BtZw50ci9ESM0GwluKWs4fGQ6heqaSIv7MHPJ6YZa3F3Th8pXRFoMsCYyKukO08QQQBrr,iv:CIYdwGeExYI/wuCwnNAfLwW5N20z6LHzJw7GxZZJdeM=,tag:wt+sYZ8N5i3v/bKrwXlFAg==,type:str]
                                    instant: ENC[AES256_GCM,data:kNhfwA==,iv:xiVOVFIrs6u656Ye7G+EHI1Lxkb7u3kdDREgnL7hXu8=,tag:o8EYeluH57P85lvkLe+fBQ==,type:bool]
                                    intervalMs: ENC[AES256_GCM,data:qKk7yg==,iv:zOEu6Hqf/U+VTIUt1CLtCIDSFqj4B5fCh/A2hCcjq4g=,tag:bdop4yywTV8zPHEFUTVRaQ==,type:int]
                                    legendFormat: ENC[AES256_GCM,data:YyTLvWtC,iv:CkJ9Dp7mICndVmz9WpQ2czAF1ZLxMC7+tUe+3rTt7EM=,tag:8sWwuH+NN9VqkcU4sXLEAw==,type:str]
                                    maxDataPoints: ENC[AES256_GCM,data:i/I6Y04=,iv:chAhmTcNmfqeupjnusfM8x3UGF9e66YdB6mIufX1Hz0=,tag:qs1XzYPq+X4xq3c/vY6YnA==,type:int]
                                    range: ENC[AES256_GCM,data:1srcFGQ=,iv:8J0ka7gSJ7VrsEJ4RKAzBh075e+tyiv7DAblig2+3TY=,tag:AaIZxjxtZQ3Tu8vH8FacSA==,type:bool]
                                    refId: ENC[AES256_GCM,data:8Q==,iv:heEM9x90H07FUuBde8k/Qg4z89XS7wgs2hFOIL0MBxc=,tag:7CXTkvhgvBmzxr4y+kaVHg==,type:str]
                                - refId: ENC[AES256_GCM,data:9g==,iv:Cz9xP0DNDUYBFLBURuoVlQejZi7UzpI7yZbP4kmHHMA=,tag:XFODLFtiKXRfmjcn8DnA+Q==,type:str]
                                  relativeTimeRange:
                                    from: ENC[AES256_GCM,data:l7TK,iv:pYBAFJRoAjqwJiIa552EruGmst1S/WGqjwqLlnc5Uyc=,tag:3AJYDMa/TG5KOV2thibHXA==,type:int]
                                    to: ENC[AES256_GCM,data:XQ==,iv:15xtyjeA6arYGSbBcFvEu73LN0hhd5Sn6KKzkCUvqyk=,tag:6ft//YOG1yA0yQpR9pR0Eg==,type:int]
                                  datasourceUid: ENC[AES256_GCM,data:bFwylrJmC1c=,iv:2BGfk1wansunvfRhNn/qhTOmOKP56plqBiLLBJg88r8=,tag:eywdW5MVIYZrqAHozQ1RiA==,type:str]
                                  model:
                                    conditions:
                                        - evaluator:
                                            params: []
                                            type: ENC[AES256_GCM,data:pvo=,iv:9f41hlDL0WVQwuI35ADzIXLch3cEQhVIhyhXFduxYpk=,tag:txyOkmJOp8ByNE9o4/XKoQ==,type:str]
                                          operator:
                                            type: ENC[AES256_GCM,data:H++Y,iv:NhWr8k3PgZHMgvanaQB2sszb5w/X3ACvqouT5qHa5cU=,tag:l0D0h2cJcV4127RZs3mRzg==,type:str]
                                          query:
                                            params:
                                                - ENC[AES256_GCM,data:KA==,iv:QqNetaIsI2aN170aHmIoGMedLX9/dYOUV0af+Aw7ZKI=,tag:5RJ5F3IdTTi7gjTLl7Wf6w==,type:str]
                                          reducer:
                                            params: []
                                            type: ENC[AES256_GCM,data:2TMTNQ==,iv:sBk8iSUI9ij/eQB34tJ8kfCiWSLCmggEylE6mUDxZK0=,tag:HgW9xhxOfE9aC2Ap0ggp9g==,type:str]
                                          type: ENC[AES256_GCM,data:BE+GYLo=,iv:ORCQ3FaDAEvFE0wdhwlpuLnxwDjaYiOnAF3vscEyia0=,tag:XBChoTbMhfElq1Rvn82R2A==,type:str]
                                    datasource:
                                        type: ENC[AES256_GCM,data:xCBBgpXEqQc=,iv:NjhHN6Q+w72wI9BcWYegyh82bodKnQyaAG4FHSdTOMI=,tag:59cFexvy2/uiW0NAuVT1ng==,type:str]
                                        uid: ENC[AES256_GCM,data:qrKz0gJnOss=,iv:aq6zEUKn2gHxQdmUb4cUWo+unvxPh6umt3O9aEyq5Ko=,tag:JavAVfeVQ/GtoLoiBllimw==,type:str]
                                    expression: ENC[AES256_GCM,data:gw==,iv:dauDQYZmFlPcsHWaUa5x+QYy6zoSRP3C4skl9RSXbXw=,tag:nuICglds7oW+DStm+us/eQ==,type:str]
                                    intervalMs: ENC[AES256_GCM,data:94jBRg==,iv:D3l7ZzzCFMUaGobXmZo6bv9n2nj2lGdFBIFQI8HWSYs=,tag:bi5D2LF7EEllM8S0kpxrZQ==,type:int]
                                    maxDataPoints: ENC[AES256_GCM,data:MzPskF0=,iv:mdSYh+RmrAHmPqkHRymEHpR4uH8S+Hh2fYE7CtMscUc=,tag:iIvTSgDix8u6kK7npPIscA==,type:int]
                                    reducer: ENC[AES256_GCM,data:J894iA==,iv:V5u5Nk6WNDP7UbMfcewyo4nbaXBZMgYr91dhEdo1ZLo=,tag:5bDdjKfoS1LgYFdMxUvTSg==,type:str]
                                    refId: ENC[AES256_GCM,data:tQ==,iv:vVPmQYwgN2sUoKZeiPehGndzPUBDe+1iM+9X0DNaOoY=,tag:IruiyiRbbrJb+uP+NP49vA==,type:str]
                                    type: ENC[AES256_GCM,data:noMTtsBG,iv:8muP4tnVn2cC02rGPhhLECiwE8P+IrDyYd1cZsoT95s=,tag:bR4QkgH5qK2TUJJ/hFGslw==,type:str]
                              noDataState: OK
                              execErrState: Error
                              for: 5m
                              annotations:
                                description: Depending on the rate limit, cert-manager may be unable to generate certificates for up to a week.
                                summary: Cert manager hitting LetsEncrypt rate limits.
                              labels: {}
                              isPaused: false
                              notification_settings:
                                receiver: PagerDuty Warning
                contactpoints.yaml:
                    apiVersion: 1
                    contactPoints:
                        - orgId: 1
                          name: MidnightThoughts Ops
                          receivers:
                            - uid: "1"
                              name: MidnightThoughts Ops
                              type: email
                              sendReminder: true
                              frequency: 1m
                              settings:
                                addresses: ops@nordgedanken.dev;mtrnord@nordgedanken.dev;mtrnord1@gmail.com
                        - orgId: 1
                          name: PagerDuty
                          receivers:
                            - uid: adz30e8814wshd
                              type: pagerduty
                              settings:
                                integrationKey: ENC[AES256_GCM,data:RpqPJZ/4HEd4pLD2vFnp7UX8LTXmDxXUKxROI6IC44A=,iv:fe30Gw2wBYYceNgjo+30jrP+nPftYV7qZmcZOcwM4O4=,tag:D+qZUEB39s8WKDgcntN30w==,type:str]
                                url: https://events.eu.pagerduty.com/v2/enqueue
                              disableResolveMessage: false
                        - orgId: 1
                          name: PagerDuty Warning
                          receivers:
                            - uid: pg_warning
                              type: pagerduty
                              settings:
                                integrationKey: ENC[AES256_GCM,data:co1whK6U5uISq6WxJPhdum8/hm5uu0GckTBhMvb48ag=,iv:xYp27Hs761n92EayTHyuRcb0Y3ObmtoXp5Bl9QcjEoE=,tag:PvIgWFRu/DGLyQZ3uN461Q==,type:str]
                                severity: warning
                                url: https://events.eu.pagerduty.com/v2/enqueue
                              disableResolveMessage: false
                        - orgId: 1
                          name: PagerDuty Draupnir4All
                          receivers:
                            - uid: "3"
                              type: pagerduty
                              settings:
                                integrationKey: ENC[AES256_GCM,data:eQIK9/8uT1bABTzIj49r+9F3CDdx9xZ0dUKwXvPOGYw=,iv:m/dhiw551TVB2ReD7NpWtG5tST7EETeLc4n4Aa00+UU=,tag:d9Eesm7cUFhVTEeV3A/rOQ==,type:str]
                                url: https://events.eu.pagerduty.com/v2/enqueue
                              disableResolveMessage: false
                        - orgId: 1
                          name: PagerDuty Draupnir4All Warning
                          receivers:
                            - uid: de02at943dxxcf
                              type: pagerduty
                              settings:
                                integrationKey: ENC[AES256_GCM,data:5rYmEE4z0l+V0VHP2i9bGI6I/hk1gVWjsDhGGirtsdo=,iv:t2YsNctCDL8sQ8GnXOU4T+CDqaRVs/Q6G3Sed0S/uA4=,tag:nxiNjsznaz4ccUCFTzIwZA==,type:str]
                                severity: warning
                                url: https://events.eu.pagerduty.com/v2/enqueue
                              disableResolveMessage: false
                policies.yaml:
                    apiVersion: 1
                    policies:
                        - orgId: 1
                          receiver: PagerDuty
                          group_by:
                            - grafana_folder
                            - alertname
                          routes:
                            - receiver: PagerDuty
                              object_matchers:
                                - - service_id
                                  - '!='
                                  - draupnir4all
                            - receiver: PagerDuty Draupnir4All
                              object_matchers:
                                - - service_id
                                  - =
                                  - draupnir4all
                            - receiver: MidnightThoughts Ops
    postRenderers:
        - kustomize:
            patches:
                - target:
                    # Ignore these objects from Flux diff as they are mutated from chart hooks
                    kind: (ValidatingWebhookConfiguration|MutatingWebhookConfiguration)
                    name: kube-prometheus-stack-admission
                  patch: |
                    - op: add
                      path: /metadata/annotations/helm.toolkit.fluxcd.io~1driftDetection
                      value: disabled
                - target:
                    # Ignore these objects from Flux diff as they are mutated at apply time but not at dry-run time
                    kind: PrometheusRule
                  patch: |
                    - op: add
                      path: /metadata/annotations/helm.toolkit.fluxcd.io~1driftDetection
                      value: disabled
sops:
    kms: []
    gcp_kms: []
    azure_kv: []
    hc_vault: []
    age:
        - recipient: age1esjyg2qfy49awv0ptkzvpk425adczjr38m37w2mmcahzc4p8n54sll2nzh
          enc: |
            -----BEGIN AGE ENCRYPTED FILE-----
            YWdlLWVuY3J5cHRpb24ub3JnL3YxCi0+IFgyNTUxOSBaVEd3V3ZBS3dMeDFPUjZ2
            ZjVDSGlqSEh2KysyUmEyb04zNXNuQmp3UG5NCjZPZzlaSmZQUUdBVFErNkhGeTVY
            MjdxbUJDQzVqVDhKeFZqbHdNS2pXc0kKLS0tIGVMQXV3ZkhmNVo0MWUwdGRmbjJz
            bzRHYVRoNTFKNHlyZlVNZnlyV2JzejAKBJQ9rVWMcWcIKiT3LJJf+3UWG84ARdDQ
            nXZx3f/BkRF2rQV1gG1lgKJj6jlEzL9JUwK1MJusTaa/dRCnGzqEGw==
            -----END AGE ENCRYPTED FILE-----
    lastmodified: "2026-02-28T20:34:40Z"
    mac: ENC[AES256_GCM,data:GRGGygmCTB4wlBfNzMb3WyuMAYNfjtyhbvxEqpUoJ1ia3vBlTUv/X77WcwoTeacFPMl1z5EgqzDwMfbm7MfAiw8QcRqb6WlM2QM5g3yV5YhNAFAHw1yj1VRXWsKoPAbfZpu+kCx/mDDJz/bhhsh51iZJ/3kmQ7VECH1bEM3w6K4=,iv:qxuXj5a6XjoN6NjmDPe9kxpP5puCUrpAiuF8CAPOaaQ=,tag:cIMKmlY9kXkSQWHTH1DFhw==,type:str]
    pgp: []
    encrypted_regex: ^(apiKey|appUserPassword|otelUserPassword|harborAdminPassword|totpVaultKey|kimaiAppSecret|kimaiAdminPassword|GITHUB_CLIENT_ID|GITHUB_CLIENT_SECRET|GITHUB_PRIVATE_KEY|woosh|root_password|rspamd_password|pgdb_password|matrix_access_token|pgdb_remote_url|hmac_secret_key|adminPassword|adminEmail|jenkinsAdminEmail|securityRealm|gerrit.config|routing_key|DATABASE_URL|SMTP_PASSWORD|SECRET_KEY_BASE|admin_password|extraCommands|key|clickhouseDatabaseURL|databaseURL|client_id|client_secret|secret_key_base|otp_secret|private_key|public_key|primaryKey|deterministicKey|keyDerivationSalt|token|clientId|secretKey|installationId|installationKey|uriOverride|adminToken.value|password.value|sql_password|erlangCookie|AUTHENTICATION_PASSWORD|ROOM_API_SECRET_KEY|adminPassword|configPassword|adminUser|configUser|MAIL_PASSWORD|APP_KEY|api_key|api_secret|keys|livekit_key|livekit_secret|secret_key|admin_pass|admin_email|mariadbPassword|mariadbRootPassword|privateKey|data|stringData|PASSWD|password|pass|postgresPassword|postgresqlPassword|redminePassword|smtpPassword|registration_shared_secret|shared_secret|secret|admin_token|integrationKey|integration_key|rootPassword|adminPassword|adminUser|adminEmail|emailPassword|secretKey|appId|clientSecret|webhookSecret)$
    version: 3.9.1
---
apiVersion: gateway.networking.k8s.io/v1
kind: HTTPRoute
metadata:
    name: grafana
    namespace: monitoring
spec:
    parentRefs:
        - name: envoy-gateway
          namespace: envoy-gateway
    hostnames:
        - grafana.midnightthoughts.space
    rules:
        - backendRefs:
            - name: prometheus-stack-grafana
              port: 80
          timeouts:
            request: 240s
            backendRequest: 0s
sops:
    kms: []
    gcp_kms: []
    azure_kv: []
    hc_vault: []
    age:
        - recipient: age1esjyg2qfy49awv0ptkzvpk425adczjr38m37w2mmcahzc4p8n54sll2nzh
          enc: |
            -----BEGIN AGE ENCRYPTED FILE-----
            YWdlLWVuY3J5cHRpb24ub3JnL3YxCi0+IFgyNTUxOSBaVEd3V3ZBS3dMeDFPUjZ2
            ZjVDSGlqSEh2KysyUmEyb04zNXNuQmp3UG5NCjZPZzlaSmZQUUdBVFErNkhGeTVY
            MjdxbUJDQzVqVDhKeFZqbHdNS2pXc0kKLS0tIGVMQXV3ZkhmNVo0MWUwdGRmbjJz
            bzRHYVRoNTFKNHlyZlVNZnlyV2JzejAKBJQ9rVWMcWcIKiT3LJJf+3UWG84ARdDQ
            nXZx3f/BkRF2rQV1gG1lgKJj6jlEzL9JUwK1MJusTaa/dRCnGzqEGw==
            -----END AGE ENCRYPTED FILE-----
    lastmodified: "2026-02-28T20:34:40Z"
    mac: ENC[AES256_GCM,data:GRGGygmCTB4wlBfNzMb3WyuMAYNfjtyhbvxEqpUoJ1ia3vBlTUv/X77WcwoTeacFPMl1z5EgqzDwMfbm7MfAiw8QcRqb6WlM2QM5g3yV5YhNAFAHw1yj1VRXWsKoPAbfZpu+kCx/mDDJz/bhhsh51iZJ/3kmQ7VECH1bEM3w6K4=,iv:qxuXj5a6XjoN6NjmDPe9kxpP5puCUrpAiuF8CAPOaaQ=,tag:cIMKmlY9kXkSQWHTH1DFhw==,type:str]
    pgp: []
    encrypted_regex: ^(apiKey|appUserPassword|otelUserPassword|harborAdminPassword|totpVaultKey|kimaiAppSecret|kimaiAdminPassword|GITHUB_CLIENT_ID|GITHUB_CLIENT_SECRET|GITHUB_PRIVATE_KEY|woosh|root_password|rspamd_password|pgdb_password|matrix_access_token|pgdb_remote_url|hmac_secret_key|adminPassword|adminEmail|jenkinsAdminEmail|securityRealm|gerrit.config|routing_key|DATABASE_URL|SMTP_PASSWORD|SECRET_KEY_BASE|admin_password|extraCommands|key|clickhouseDatabaseURL|databaseURL|client_id|client_secret|secret_key_base|otp_secret|private_key|public_key|primaryKey|deterministicKey|keyDerivationSalt|token|clientId|secretKey|installationId|installationKey|uriOverride|adminToken.value|password.value|sql_password|erlangCookie|AUTHENTICATION_PASSWORD|ROOM_API_SECRET_KEY|adminPassword|configPassword|adminUser|configUser|MAIL_PASSWORD|APP_KEY|api_key|api_secret|keys|livekit_key|livekit_secret|secret_key|admin_pass|admin_email|mariadbPassword|mariadbRootPassword|privateKey|data|stringData|PASSWD|password|pass|postgresPassword|postgresqlPassword|redminePassword|smtpPassword|registration_shared_secret|shared_secret|secret|admin_token|integrationKey|integration_key|rootPassword|adminPassword|adminUser|adminEmail|emailPassword|secretKey|appId|clientSecret|webhookSecret)$
    version: 3.9.1
