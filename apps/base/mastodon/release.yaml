apiVersion: helm.toolkit.fluxcd.io/v2beta2
kind: HelmRelease
metadata:
    name: mastodon
    namespace: mastodon
spec:
    interval: 1h
    releaseName: mastodon
    chart:
        spec:
            chart: .
            sourceRef:
                kind: GitRepository
                name: mastodon
                namespace: mastodon
    values:
        image:
            tag: v4.2.12
        imagePullSecrets:
            - name: ghcr-pull
        externalAuth:
            oidc:
                enabled: true
                client_id: ENC[AES256_GCM,data:uoG/ALOerEcaie3wBrcsqETXpcgY+DvTVU9aGGXafFye5EiO/j+kvA==,iv:6f7FZxlm1u0s+bn6L0vLQ8BZb5FgZoM2TTwvnumH290=,tag:o8SyKknsuQjrvYOiWPL5Dw==,type:str]
                client_secret: ENC[AES256_GCM,data:h4Y0UHVVhEAFGUvWAl3zvSQaT27aovn/DAPgQ+oNb8EStrfPJloKaCT2vI9StEWUhOhjm6ZKffssKG+I/dkCaPEMp2AJ43xtZC0VD5ZR7KyG0D1c/j/9AMMhXTq8c1IEZsHoEOFy/ZqEs8OshxAAsgEJVizAxTm5HBlYjZld8NI=,iv:Z7jmWhH2xGlYDsflMKmguFLldbtBKKFWS1DuR/fjfp0=,tag:qP3DQCQ7FpBg7/cfMYlTUQ==,type:str]
                display_name: authentik
                discovery: true
                issuer: https://auth.midnightthoughts.space/application/o/mastodon/
                scope: openid,profile,email
                uid_field: sub
                redirect_uri: https://mastodon.mtrnord.blog/auth/auth/openid_connect/callback
                assume_email_is_verified: true
        podAffinity:
            requiredDuringSchedulingIgnoredDuringExecution:
                - labelSelector:
                    matchExpressions:
                        - key: ENC[AES256_GCM,data:JyUJZKNHx6vhd2vK1Qx7s9PDxCQ+DRRewA==,iv:OxQsKjEwVDw73Qs3Egbxlwc6vXobTG/WD6j51WhOaGw=,tag:o4DaHqIrXCGB7b6POzfk2w==,type:str]
                          operator: In
                          values:
                            - rails
                  topologyKey: kubernetes.io/hostname
        elasticsearch:
            enabled: true
            preset: small_cluster
        ingress:
            annotations:
                cert-manager.io/cluster-issuer: letsencrypt-http
                external-dns.alpha.kubernetes.io/hostname: mastodon.mtrnord.blog
            hosts:
                - host: mastodon.mtrnord.blog
                  paths:
                    - path: /
            tls:
                - hosts:
                    - mastodon.mtrnord.blog
                  secretName: mastodon.mtrnord.blog-tls
        mastodon:
            authorizedFetch: true
            local_domain: mtrnord.blog
            persistence:
                assets:
                    existingClaim: mastodon-assets
                system:
                    existingClaim: mastodon-system
            secrets:
                secret_key_base: ENC[AES256_GCM,data:oBXt5wcW01CGePjsCpuk74z+T01YiKxccdRn5ieCU2x+ZzaFxMPeBwRspCt+yKWFk5ugwiGiAtVm4mF00mHMOGGUblwbvbSOEMO/Eg2OBQJKzVMY7/oWxCmX+dP0lafx9vDTvDD/ixUFmfI9hCU987HM6ZLd1xJbCRmHd1KCkF4=,iv:/YhxXuJ+7VqQWG8OvQAbiu7YB8N54JbM3hk0zWujmlA=,tag:8YqFR2cra13lx/0slp8OzQ==,type:str]
                otp_secret: ENC[AES256_GCM,data:OwaJ8ZbYTOLXYIjjXZWAFjFVUS725G77DQ1XlZkU++VQjp4WyUKNc4Qt8XfSE7WhZtVkUj7R1F6KE3UB7jkirulMqw9P9OS0MZ3E443I30bB1V15SylbjpSGrDZNOyXgYz40sjFwY0KioVjWDLJ7YtPDSaG0M7VwZAxTH2ra1P0=,iv:NOU1pC0akwzwiEgmFnAmbtGDXQ3uDtDlZo9+j3vXQ0c=,tag:NIcmYgFFFz/2O3zug9Y3rQ==,type:str]
                vapid:
                    private_key: ENC[AES256_GCM,data:zU4sLUdo+kmquIy6Rl2r4o7A2xGC5o9KwHDTTpDoQy8vmrsHeMMxjNZ0NbU=,iv:GNS1eXrJWGwms2Q/DP0UqQ8b3A+90/FLQipg7z6HdQU=,tag:CQCDzDTEgaqYBd77YgLiaw==,type:str]
                    public_key: ENC[AES256_GCM,data:ZVdjr74ALynw1tj5sJRcRLQaatn1SAcZR5U8ltWp1eY2iW2sZ4uHvB7bK2YqbUJitYBMWwS+q8wgRxPkfWB/hV1eQhDnRWpMVnc1cqQj+oEBjaPbtoxC7A==,iv:N8EUmEq6YTj+gvaPAn+w4Kaq7GN1FO193NR7e0ogtvk=,tag:DZUuhvrw37p+4L5yKOj3Ug==,type:str]
                activeRecordEncryption:
                    primaryKey: ENC[AES256_GCM,data:MAAqXcFFUUzsFj+ytludUqcnOG/CM69aLe9YYtqBOyzYX7X1CMn/A9uJbEzraeRxo0r6sXCoMMsqSOlNl/CWKg==,iv:dO7RMQIzGOpNpPgUhgIaC79Rrc8GQEhIq0Rdm7TjxU8=,tag:bYHOeElo65P1CZKbrVy4lw==,type:str]
                    deterministicKey: ENC[AES256_GCM,data:moUnaSls65eo56xhaLH7BusZq/6M+FTCdPUDrd3rpMHrgsjWLSGq0wV4XztM3EcaAfSKIr3ujUO6zNVTstt/Rw==,iv:KUNZlj3zEyF6NW3TElkiqA0sPTqjDyemVT3K9LTN5UU=,tag:Vj6S9ehuyfsEba8yAIdS6Q==,type:str]
                    keyDerivationSalt: ENC[AES256_GCM,data:3Z8mHy345svHpKeMBKI8onV3WYcir1ahV8x4LWp6FGVI9wiLDss4umuI6xDpmFxtn9n8SX+/j0LIs88vyRZELQ==,iv:A50p2w3nQskMVR1LRy/Q5IsYHnMr0jjJFGuJpVBSrO0=,tag:L0XRKYj/trg/IlVeS6T/ng==,type:str]
            singleUserMode: true
            smtp:
                domain: smtp.fastmail.com
                port: 465
                from_address: Mastodon <ops@nordgedanken.dev>
                reply_to: noreply@nordgedanken.dev
                server: smtp.fastmail.com
                login: mtrnord@nordgedanken.dev
                tls: true
                password: ENC[AES256_GCM,data:Rt2/U57fuEk06L2DkWuhQA==,iv:TYAQjL+qX12XHcnueTALhJa3A1EQETzzgjSxk74szwA=,tag:5VS1NcmwnYGDKzbVVETY4A==,type:str]
            streaming:
                sslMode: no-verify
            web_domain: mastodon.mtrnord.blog
            extraEnvVars:
                TRUSTED_PROXY_IP: 100.64.0.0/10
        postgresql:
            auth:
                database: mastodon
                username: mastodon
                password: ENC[AES256_GCM,data:7sBiFCqS1iAXAnAeIWwozb9XJWa91L6vD5VZPTlPwqeFRHfG+bndYSNtYoafTg9aOFBoDi0W2WkOihhcsPPUhQ==,iv:xRq2FrdmtYgvtRuQXPGObE1wA/1vAH4KSJ5tJqRmxKo=,tag:b3P/cebS+2cklkTUuXEl7g==,type:str]
            enabled: false
            postgresqlHostname: postgres-cluster.postgres-cluster.svc.cluster.local
            #postgresqlReplicaHostname: main-ctrlc-repl.postgres.svc
        redis:
            enabled: true
            #hostname: keydb
            auth:
                password: ENC[AES256_GCM,data:ynP3bDtIrMtkXqq3/o+MRj0ineob9Y/slsetV39VJxhCCyn2fiED2fW9RbfzyDfNdiMO27EY5pNNh9IxE8bkUA==,iv:dugJiCWovanyuOcipMRaaDFCin8ogjXz3eV/SXZC7yc=,tag:TytA3mLRTepsHBKXi5T3tw==,type:str]
        replicaCount: 1
sops:
    kms: []
    gcp_kms: []
    azure_kv: []
    hc_vault: []
    age:
        - recipient: age1esjyg2qfy49awv0ptkzvpk425adczjr38m37w2mmcahzc4p8n54sll2nzh
          enc: |
            -----BEGIN AGE ENCRYPTED FILE-----
            YWdlLWVuY3J5cHRpb24ub3JnL3YxCi0+IFgyNTUxOSBvYS9waVZCYUsveG1FYzNY
            SEpDRFNYajNlS3AzWXZDZGltaUJkc3V0RnlJCnNaTjhzeHcwSVdqaHp3L2JQZmJj
            OXNRWnZlTGtIVWtFWkN3dCtvbVd2d28KLS0tIGI3bDFpR20ydkUvUXZ6TldCOXdX
            M2Ywa0JsbldBWGJxcE1HVzNzR1NjYlUKkZQ9BwPMXDjSQL1nwK5AAS2lZ+BeMFEk
            qFftjvGJ66Unu2QWXjR4+pB6iM5rIzspsaOb8XD5N6DgkCvCYXq+Ng==
            -----END AGE ENCRYPTED FILE-----
    lastmodified: "2024-09-11T16:56:38Z"
    mac: ENC[AES256_GCM,data:gicIb5WCx8+B41GyUSbuMMcuXLJYJGBlBko+N9FJ/xt9JpMv6azX2n/pLbbjXf1c5WF62PYuGBwi9P7o3W9kI9tuf6hABt/YGEQPYqti9N2kZ6RwVrPkteVjMIBABebRqH46FkhBdyyVbb6rRfRHCFdfQNn5l25Ok6Fc75wPRsQ=,iv:pe1/jO6fjYSirUIyx5CyxAQLUm48pLRoXjmc1IYa4cQ=,tag:1eQBROmkimV5/2wEEdOAfA==,type:str]
    pgp: []
    encrypted_regex: ^(admin_password|extraCommands|key|clickhouseDatabaseURL|databaseURL|client_id|client_secret|secret_key_base|otp_secret|private_key|public_key|primaryKey|deterministicKey|keyDerivationSalt|token|clientId|secretKey|installationId|installationKey|uriOverride|adminToken.value|password.value|sql_password|erlangCookie|AUTHENTICATION_PASSWORD|ROOM_API_SECRET_KEY|adminPassword|configPassword|adminUser|configUser|APP_KEY|api_key|api_secret|keys|livekit_key|livekit_secret|secret_key|admin_pass|admin_email|mariadbPassword|mariadbRootPassword|privateKey|data|stringData|PASSWD|password|pass|postgresPassword|postgresqlPassword|redminePassword|smtpPassword|registration_shared_secret|shared_secret|secret)$
    version: 3.8.1
