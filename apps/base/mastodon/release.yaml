apiVersion: helm.toolkit.fluxcd.io/v2beta2
kind: HelmRelease
metadata:
    name: mastodon
    namespace: mastodon
spec:
    interval: 1h
    releaseName: mastodon
    chart:
        spec:
            chart: .
            sourceRef:
                kind: GitRepository
                name: mastodon
                namespace: mastodon
    values:
        externalAuth:
            oidc:
                enabled: true
                client_id: ENC[AES256_GCM,data:vuuS5E7fygvMH1nOn7vQHXhSWxgyXGU3bZQhKdni5mu31cp6/098tg==,iv:Eugk+KrIO4JcQPoUzeiQv/ycZ6a9mgoirWP4vM8y470=,tag:Pk/0CL465HpXlWf7xlSGzw==,type:str]
                client_secret: ENC[AES256_GCM,data:eeq7TKB7KPFpOnkBNhMj82CDsqI5bxe0MbicIYqyl0THllqE800Ma1A8MlPfRm5Q8lgvAGua/+3uS8aWWDGAgwdh9j1cCPv7hgdyK2eYtnbDObLsTcOq9aXWCb/QKDV14Ox9peOJBI5u624/vWdntFEV0I5uFNvZCGwHI6EAKf4=,iv:9IeYnoMAZZL/NGfpH3bmYHqNrPTM/x9FXo/ufiCWQJA=,tag:Bp6GLdkthPHarT89sklxgQ==,type:str]
                display_name: authentik
                discovery: true
                issuer: https://auth.midnightthoughts.space/application/o/mastodon/
                scope: openid,profile,email
                uid_field: sub
                redirect_uri: https://mastodon.mtrnord.blog/auth/auth/openid_connect/callback
                assume_email_is_verified: true
        podAffinity:
            requiredDuringSchedulingIgnoredDuringExecution:
                - labelSelector:
                    matchExpressions:
                        - key: app.kubernetes.io/part-of
                          operator: In
                          values:
                            - rails
                  topologyKey: kubernetes.io/hostname
        elasticsearch:
            enabled: false
        ingress:
            annotations:
                cert-manager.io/cluster-issuer: letsencrypt-http
            hosts:
                - host: mastodon.mtrnord.blog
                  paths:
                    - path: /
            tls:
                - hosts:
                    - mastodon.mtrnord.blog
                  secretName: mastodon.mtrnord.blog-tls
        mastodon:
            authorizedFetch: true
            local_domain: mtrnord.blog
            persistence:
                assets:
                    accessMode: ReadWriteOnce
            system:
                accessMode: ReadWriteOnce
                resources:
                    requests:
                        storage: 10Gi
            secrets:
                secret_key_base: ENC[AES256_GCM,data:gWUxmzSPSSF+mz8BpeXg03nNV/G87RClHkFevWN6QJ3HouF1MaHhJRlbVAjhuds6s9GOuAZFzdgwBB2rCoD9TA8Jbr2RAiWBSjpJoEH7Tyiqb8LfvSjbmIv0wOz1E1426W9im9gkUo7w2XAyEFNC40XR7+Ras+KyGlFjErB1sMs=,iv:ALNEQTDdXr0JZubFWMx3pcXb34bFxb5LjjByJ74D9w4=,tag:oME/83Z09zgXWtsrTaVWxA==,type:str]
                otp_secret: ENC[AES256_GCM,data:cfswS8t2U2zjCqnVKWKlDEwuVz3G8MeRX51mYVB0rTiVcr/a1aJG35dLjZg6xjBcKyGzdSv45lOkkHAZaGwsJov4suwnmUc9+Z0eFT17dpfuqpBWNdJa3U8Iz1YLnWuaKRANrtfymEKy3QkpqlQr0tW0FVz2lIw2ikW1RXxHWuQ=,iv:2dL9bqj7TsTZ0LHbWxGL9d9iwoSW7j5BHg3MBWiBH/4=,tag:SfqZsL+SAUeMDIWb+BYCYg==,type:str]
                vapid:
                    private_key: ENC[AES256_GCM,data:kP50XgfmtKLv7QfX7C11vtFwFyr/qeDjGBxEw3ft75zdL9XVXGC68A3829Y=,iv:8MCKyjSERmGXaA5JfU/bxRoHmLXfjayKmswnP+ey1do=,tag:3uZA06CwPjsU67JS4ANxYA==,type:str]
                    public_key: ENC[AES256_GCM,data:fY6/EB4VGWMzBQwCVzDq9VX99Gp8p6TI24RGSjhgkSrt1fQG3ueBaUppooQCtDGjLYTa4BXHkO622zqN6BWYNY8fpvkT9Xjyc0vRK31T0WyV/otvFC4E5Q==,iv:y9rHT55ZU8bpa2oVYWsSfu9Jz/Ir5x1/utTGBUiCUeQ=,tag:HQEsI5NYHx4nFYE/nb80BA==,type:str]
                activeRecordEncryption:
                    primaryKey: ENC[AES256_GCM,data:EvD0pOYWxWK8oIgFOIv5SfRhjS6M5kxhhTU0i5kxV2fRC3HyKNL3XMaKffucAmVjDhaxmH6RrOL4J6sFUUceyw==,iv:Hd8UU3L2sH2JbH3ooaL06E2lLDqy5lZyrtYZJb+xqyM=,tag:8xyWw19Slby/9tDGjmGmcA==,type:str]
                    deterministicKey: ENC[AES256_GCM,data:bcztuj7CW79AaoMlCaogzL3CQB8mPs/d9PHNhelp5xbX6dGy9jB02b0IKMxT7gNl1lKx/y4AZtoHYi/Pa2HbgQ==,iv:87ncCZKDeaYZCErJomtanJ6v4ceVF+inkQQyr4sG6rk=,tag:PcTYpflgn3QcCa00zzcMow==,type:str]
                    keyDerivationSalt: ENC[AES256_GCM,data:M4xTLOfEh9Q0QEre3l3tnRMZMTMhUZA1MwX7YVAVEFybEaUR7dsHcvjmDBFz1Ctc9FgtCp+sWXU2U21XwPmH0w==,iv:CR9I9HqnvycO2X/W4B7varcVDOxx+2XoNsFcA914FX0=,tag:kXQ/BLuUwW9FVZj1r11fvw==,type:str]
            singleUserMode: true
            smtp:
                domain: smtp.fastmail.com
                port: 465
                from_address: Mastodon <ops@nordgedanken.dev>
                reply_to: noreply@nordgedanken.dev
                server: smtp.fastmail.com
                login: mtrnor@nordgedanken.dev
                tls: true
                password: ENC[AES256_GCM,data:1ZuRMOs1J9Wb,iv:O4Vdy+Kwh2qEZi62nwjZNRlW7gJW3b31BRd2BW4g/TU=,tag:Supd8/Qhg7QYQTv4yCpxZA==,type:str]
            web_domain: mastodon.mtrnord.blog
        postgresql:
            auth:
                database: mastodon
                username: mastodon
                password: ENC[AES256_GCM,data:ujIbdrFMVuZZXbxGbjXekwyzCT19X4zxAoau+NK1T13uFnLebSbIF69PGFXhk2AmQhqUW7BaTWNLnlegyYdXdQ==,iv:fvdw60Km9KZDAuBnff6F03a5yTKQef6wnjPW+cCj+k8=,tag:aqzeB3buYDYjOyHYdvoXuw==,type:str]
            enabled: false
            postgresqlHostname: main-ctrlc.postgres.svc
            postgresqlReplicaHostname: main-ctrlc-repl.postgres.svc
        redis:
            enabled: false
            hostname: keydb
        replicaCount: 1
sops:
    kms: []
    gcp_kms: []
    azure_kv: []
    hc_vault: []
    age:
        - recipient: age1esjyg2qfy49awv0ptkzvpk425adczjr38m37w2mmcahzc4p8n54sll2nzh
          enc: |
            -----BEGIN AGE ENCRYPTED FILE-----
            YWdlLWVuY3J5cHRpb24ub3JnL3YxCi0+IFgyNTUxOSBqd1htYWNhc1huUFRicWlQ
            TXRGVG5INXZFWlJ6bFZKYThXV1NKTHdQdXpzCjM2OHJ3R1RlR3JuSlNHZXpGeXE0
            ZjNTME1pajZxcXhIK01wMWt4WURwekUKLS0tIDVZMGNaK1hsVjF3NkdnUnAxVUJ1
            Rlp3enQ3T1lGZ2JYZWI4dW1EbFR5QlEKN12NDBln9397hvVvfIe93a183GBoyOjW
            McULA2dtpAdcp589U7x1oluH4kblWhvYWQKmI7f4sfial+s1RYrYtw==
            -----END AGE ENCRYPTED FILE-----
    lastmodified: "2024-05-06T11:36:23Z"
    mac: ENC[AES256_GCM,data:28CQu/qTFOvdt2zpH0cTilbVqGVkCJwR3mdN8+tq9+qfMW5qN3nW4Ja1jDMzQB+3d1oshQGCVtqMAFshcyUzfmPpVU8xxHHQGjcs9MuVWs7UDK4HB4hWMqDsIL26H8d/CWc03MXimVVZegrx3h8rVycC5JWG73es+ccRNB2ekx0=,iv:AgaDHOrn+6s7Orpvjxh4hy1YLCYFxRv7z4GtRvfWRsQ=,tag:EMsg98zdLunMkHuNfdMIpA==,type:str]
    pgp: []
    encrypted_regex: ^(client_id|client_secret|secret_key_base|otp_secret|private_key|public_key|primaryKey|deterministicKey|keyDerivationSalt|token|clientId|secretKey|installationId|installationKey|uriOverride|adminToken.value|password.value|sql_password|erlangCookie|PASSWD|AUTHENTICATION_PASSWORD|ROOM_API_SECRET_KEY|adminPassword|configPassword|adminUser|configUser|APP_KEY|api_key|api_secret|keys|livekit_key|livekit_secret|secret_key|adminPassword|admin_pass|admin_email|mariadbPassword|mariadbRootPassword|privateKey|data|stringData|PASSWD|password|pass|postgresPassword|postgresqlPassword|redminePassword|smtpPassword|registration_shared_secret|shared_secret|secret)$
    version: 3.8.1
