apiVersion: helm.toolkit.fluxcd.io/v2beta1
kind: HelmRelease
metadata:
    name: element-call
    namespace: element-call
spec:
    interval: 5m
    chart:
        spec:
            version: 0.1.4
            chart: element-call
            sourceRef:
                kind: HelmRepository
                name: element-call
            interval: 60m
    install:
        crds: Create
        timeout: 25m
    upgrade:
        timeout: 25m
        crds: CreateReplace
        # Force recreation due to Helm not properly patching Deployment with e.g. added port,
        # causing spurious drift detection
        force: true
    values:
        livekit_key: ENC[AES256_GCM,data:LeqHT8NR2A23gFiM7MccFwpm8TGskdLpmP8jgHGfWBDmDpl31lH5s/jsWzANJIwa+OlREIaiZIWBW4wzzLDJ+g==,iv:1GXzmROVivgZRE3Sj34PimcGE40+dBfbW3u8C3j5J8g=,tag:3hmRi1AnORZLtO3A+yxH5Q==,type:str]
        livekit_secret: ENC[AES256_GCM,data:Dqkh93XEogeBEOhoULVjqV93CKlAwpM6Y1vlXc2Wgz8NkPtsefFKVODezO1PAvPjsd+xUPWAUzmfeLj4V+1fiw==,iv:kS/iLoUBtz/iZSoPtAaqmokVjSmOYi8pT8H9TaYGWSg=,tag:bqXV88FtamRx1vsG75A4Ww==,type:str]
        element_call:
            replicaCount: 1
            config:
                eula: https://example.com
                homeserver:
                    base_url: https://matrix-call.midnightthoughts.space
                    server_name: matrix-call.midnightthoughts.space
            ingress:
                enabled: true
                annotations:
                    cert-manager.io/cluster-issuer: letsencrypt-http
                hosts:
                    - host: call.midnightthoughts.space
                      paths:
                        - path: /
                          pathType: ImplementationSpecific
                tls:
                    - secretName: call.midnightthoughts.space-tls
                      hosts:
                        - call.midnightthoughts.space
        livekit-server:
            livekit:
                keys:
                    bQXMwwlTCTbxDd6xRHYaaK5gzOzyb1gzS5E89vrJ96ONp3kEH4Ljh9su5L3BQc33: ENC[AES256_GCM,data:TuO1zkigvgqhQlOfVckPNeUWHViN6NATlcMtes9EOqAIkWO/0gSwqPH5oHteV0avWDdGvc1LGCCJaieM50ajmg==,iv:Z7wB+XZuHh35N7imS3GazZ9/SAfpbaRtITgPpgOC0FM=,tag:CvDP+JMwW7+gcC0bUWFetw==,type:str]
                    iHMQVcTZSmUek9m55nFcvpGWaAR1nGpQggvEmvKyWqWbu099EjSZ2sQkU1ZMpR1h: ENC[AES256_GCM,data:gxxDmZIMiT+JdJxHZiodeU+bCW6yUcQVn+YRsjSu8FuJetoe/D+9SRqfde5WL9olL6uqvtp4ii6PWO1S7a7rVQ==,iv:S8R+qVyk1VeCroSDtdMn/YKtwB7hHZfjk29MKEk5ib8=,tag:POdBNCyIMN712LghiAXGfQ==,type:str]
                redis:
                    address: element-call-redis-master:6379
                    db: 0
                    password: ENC[AES256_GCM,data:dXPMGEfEsYzLDCqsoYJ9FyTjBdcdJxuc457zIKFYqwZF0qtax+RLAExXLUJph+D23jY+iKP/ZMBaLkoUsXCfBg==,iv:81glRUIYD/bLntPnndzuYb99cHij8kVjRXwHPzE5BfI=,tag:0hFx6FNyLF3ATxPKDsUTtA==,type:str]
        redis:
            auth:
                password: ENC[AES256_GCM,data:zODP6OIsF69EttPmf4hpO/trHgIhqanzdIPGWCfrbQ4gHoT3NIpEl0AlGX0rl47GJc2TxgQlh/LwGjUUVKR46g==,iv:C6m5jno00u52kEBaZtgLyVVIy0HSurprbbR4q+OOyrg=,tag:KPULtbBnf04Y5zAfCvsuuQ==,type:str]
        egress:
            egress:
                api_key: ENC[AES256_GCM,data:BWdg99dD6tejIU7DsrTPAswhE3feoygBo08+wsTnQ6P/WJwgPum2yYYtzYX23W1/0Y1kRAOydv2ChbZRjQUR8Q==,iv:1ajfvGHskFIj5Yq7maA86WRMica8hNf/ojdnF18hxNg=,tag:wNmDZ5L11ozb1TN8YWDBlg==,type:str]
                api_secret: ENC[AES256_GCM,data:kJDe9HitFkS5yrj1zjdZluVZE18mizunCmqpV6ob5eRkTwLVL0zcG4bTHmHrVhgShe1kDXsz9Y7eoDF88ht8Vg==,iv:cPqMQx6EXrN1DHhcV3xxltg/hzyzalcvTYBOkFSpq5c=,tag:DBNA9QqnVGzbf1B2BatuDQ==,type:str]
                ws_url: ws://element-call-livekit-server:7880
                redis:
                    address: element-call-redis-master:6379
                    password: ENC[AES256_GCM,data:CsVTNbHieWeOUUi7tJYvmGibEG5Ngw9LYBkK64sAfQc9HVRsgMuGqMH6DCGd6eDxxIXlKNZY64jGmEFWMhfXXg==,iv:OU1acYkGScJMMdMYkbjJAtzbN0qa/JXOi5IcuaSPVp8=,tag:oN+GWg3PXRIpNeCM4Lnw9Q==,type:str]
                    db: 0
sops:
    kms: []
    gcp_kms: []
    azure_kv: []
    hc_vault: []
    age:
        - recipient: age1esjyg2qfy49awv0ptkzvpk425adczjr38m37w2mmcahzc4p8n54sll2nzh
          enc: |
            -----BEGIN AGE ENCRYPTED FILE-----
            YWdlLWVuY3J5cHRpb24ub3JnL3YxCi0+IFgyNTUxOSBqeTNya21VTE1QZm5ybUdh
            dGxqRjBIRWRKdnlBd2VlYWdaQ25qVDA4QzJ3CjJISU1XWG1hVkFBa2hkZ1pramkx
            dnpGNUptM2RUdlcyYkhTV2ZrSVhqVzgKLS0tIGp5UmFIQ2ltRnE0eGRiUUFRVzgy
            cVU4RjQ1d2pzYUVobDVtTzVPdHNlWGMKu5UHP/TFPSHoBL7LQv34dF8Zt4nUExsu
            xupQIpEKbzGq2shOPMd+TOQU3R/+xS6b7l9eBi0ReGf/6UKxhCcx0w==
            -----END AGE ENCRYPTED FILE-----
    lastmodified: "2024-03-06T10:04:00Z"
    mac: ENC[AES256_GCM,data:fuxjCHSPb4xKknu1El8CpbXBwm6S5WdUs4/l/UsCTo+2Psix5aTK58QHBfSGxUfjC+KkL6MMss/6XjgV+yeUy6cdt0lHvYopR3Pefa1pjUBqZMOGdfTDVS9R2EWExSEbKFfgrqlKuFL7YuKtBgJptCYIZvB5ew1JwVmYyqvFOD0=,iv:Ep9V8ibbvg56Gm6Z8Lr0vkbv1pST6OtiLhZ5jQDWa1E=,tag:34wBzPWxElkPUQ1brZIJbw==,type:str]
    pgp: []
    encrypted_regex: ^(api_key|api_secret|keys|livekit_key|livekit_secret|secret_key|adminPassword|admin_pass|admin_email|mariadbPassword|mariadbRootPassword|privateKey|data|stringData|PASSWD|password|pass|postgresPassword|postgresqlPassword|redminePassword|smtpPassword|registration_shared_secret|shared_secret|secret)$
    version: 3.8.1
