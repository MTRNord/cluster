apiVersion: helm.toolkit.fluxcd.io/v2beta1
kind: HelmRelease
metadata:
    name: element-call
    namespace: element-call
spec:
    interval: 5m
    chart:
        spec:
            chart: element-call
            sourceRef:
                kind: HelmRepository
                name: element-call
            interval: 60m
    install:
        crds: Create
        timeout: 25m
    upgrade:
        timeout: 25m
        crds: CreateReplace
        # Force recreation due to Helm not properly patching Deployment with e.g. added port,
        # causing spurious drift detection
        force: true
    values:
        livekit_key: ENC[AES256_GCM,data:fqYClu1sdONe7+SceTiOTxx6vkk8Scbecm2oAieGO7IFtxaN/HFRlJ+dEcyQxlUNYUROLScgQaOfuLnZ7doW+g==,iv:whlsABOp5QfDHIZC14cTnysaJdY33kmdjOLALZsDHWQ=,tag:ZqxlVOycvubr7cNNH3QrEw==,type:str]
        livekit_secret: ENC[AES256_GCM,data:zdfEwie7xFdfs9AWtu0Sq1m5WX6QC1/yGKA3x6fUwh8dudtvgh4lTOLS0baSDEit77hgFkQ5WUMSUv8QDs+HTA==,iv:UrpU8y9psofTZFLSWEatr40IikmhO6mNrWXWdVAyBHk=,tag:Ks/3ls89i30UeiivfO2QxQ==,type:str]
        element_call:
            replicaCount: 1
            config:
                eula: https://example.com
                homeserver:
                    base_url: https://matrix-call.midnightthoughts.space
                    server_name: matrix-call.midnightthoughts.space
            ingress:
                enabled: true
                annotations:
                    cert-manager.io/cluster-issuer: letsencrypt-http
                hosts:
                    - host: call.midnightthoughts.space
                      paths:
                        - path: /
                          pathType: ImplementationSpecific
                tls:
                    - secretName: call.midnightthoughts.space-tls
                      hosts:
                        - call.midnightthoughts.space
        livekit-server:
            keys:
                bQXMwwlTCTbxDd6xRHYaaK5gzOzyb1gzS5E89vrJ96ONp3kEH4Ljh9su5L3BQc33: ENC[AES256_GCM,data:U53OV4oQBroXpLFxjUS7P+61oHQf5YB3bjLsyNlUq4PKHm5/6h7OwUxikAG+1A8P+SOBgQXlz9uBwzVvNaRFsQ==,iv:LOQBdfGgGZA2HWTmSt6dbMp6hniS7KebQJhLkMaRkq0=,tag:FJW7Nl6GK51kAcj+2ieqPA==,type:str]
                iHMQVcTZSmUek9m55nFcvpGWaAR1nGpQggvEmvKyWqWbu099EjSZ2sQkU1ZMpR1h: ENC[AES256_GCM,data:WHLa2/qKX66AGnOjIL1j1obytct+I7pnVN0O4IsaHg8QRwqqOXnqu5W9u7OqNFRNuxQ30k9hCvw96dJ2aKZRng==,iv:Qy7lmgBjw2GjLMzTIVwMP6SGJUmMx5utQGitKBjmOeU=,tag:MRKsHD1/10i3ZN3ZksGFnw==,type:str]
            redis:
                address: element-call-redis-master
                db: 0
                password: ENC[AES256_GCM,data:4sAq6ZtkAn0fHjowKEfBiTjtnXD+PVxqE24GJJLm2IQr2Q3NtK0Rea0W85JyYU2g1PVsx/3ZKmNKTjFAuqu4NA==,iv:Q8MwtyAaFLrhFh8VkJvSnJfK/OiUcZ55LHCjZ9G5Yj4=,tag:1rv5UCesEeq2jbjGL6VARA==,type:str]
        redis:
            auth:
                password: ENC[AES256_GCM,data:lKYoM8ItVlGh3qMiz3MNPpe/wRwTOxFC0Kemw9CEsbNXpr1YLdGP6QY5odVF9FIM+N6XMltJR0GCNOV3VH4HEg==,iv:5IZLr0NL/3Dx9hLc/rlQjlHqSBdBkS0up+Ij/OqJfbY=,tag:r74LHbpp6ZJ0cb1TxGz5QQ==,type:str]
        egress:
            api_key: ENC[AES256_GCM,data:sfNmBdOtqS8AU6HztZ1cpPZ67tjkMOURhqKyFIMjZ6jaL/f5djZUKS5A/c+P88+JHrlJi7YJBUwGX6DmR/qBqw==,iv:Aq23vKuplhxhCffLobeAZhRl27/ryiGUaDNKlZjccf0=,tag:cZXObHiuKbWY3pHzWyYaSw==,type:str]
            api_secret: ENC[AES256_GCM,data:8fEf0JBVd2TpH7LOGSkyCueCJUh1lVHvUk/p75Fjwxw0uF2NmIrFd5AGAP9ZT1b3dnWZv83+v23vFKr3aErURA==,iv:t/BCrxnmB2QNISZi8QlrsiN6V2v36E9EaPU7RZOfXPY=,tag:fNwtjr3/SlZDtK3qlrSWGg==,type:str]
sops:
    kms: []
    gcp_kms: []
    azure_kv: []
    hc_vault: []
    age:
        - recipient: age1esjyg2qfy49awv0ptkzvpk425adczjr38m37w2mmcahzc4p8n54sll2nzh
          enc: |
            -----BEGIN AGE ENCRYPTED FILE-----
            YWdlLWVuY3J5cHRpb24ub3JnL3YxCi0+IFgyNTUxOSAySFpDSUJTRTNaMnNxRXhX
            TlRmdVliMWVpbndzL2paUGZudytwbVY0OGdJCmJzNUdTSUdPVDRmMlNLeVdVNnlm
            N0U4VENSbmFLQzV3NG1UUmdOUE5yMXcKLS0tIG5xbFV0bzZrb3lWVEw1b1FLdjhW
            ckVFZ3FmSExKYkZPbW5FRlIrOExxRVEKp/z8GF6JRKen4RErfC6YWX39VPj4/OAE
            fqc+MjEmKIXIXtAmVlOsv5HvY5/UfyGDkyZ6mXKggFW1q8SELU77Kg==
            -----END AGE ENCRYPTED FILE-----
    lastmodified: "2024-03-06T09:36:13Z"
    mac: ENC[AES256_GCM,data:05o1K/alIcjAuRuiaY4Inn2CtUm+DCauLhrcBHspvp4ATUwIZVUaB5p636EdYi+FjUtJr4xmmfdJXc0pH7Huz6YdBEWhQR5jaQZ7vHJLU9I8KIeZy+eaZoWppN9oPJeVFcBI7gw2Ozxt5oj8q9RHRD2y9nlcB+SkLmlvi/xyWvY=,iv:6SS+7aN4nsBCNehPLcqL/K2NndMSAU1wCEhDclPbwis=,tag:eFeDauN+9VkDPU/82vJBew==,type:str]
    pgp: []
    encrypted_regex: ^(api_key|api_secret|keys|livekit_key|livekit_secret|secret_key|adminPassword|admin_pass|admin_email|mariadbPassword|mariadbRootPassword|privateKey|data|stringData|PASSWD|password|pass|postgresPassword|postgresqlPassword|redminePassword|smtpPassword|registration_shared_secret|shared_secret|secret)$
    version: 3.8.1
