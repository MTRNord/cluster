apiVersion: helm.toolkit.fluxcd.io/v2beta1
kind: HelmRelease
metadata:
    name: element-call
    namespace: element-call
spec:
    interval: 5m
    chart:
        spec:
            chart: element-call
            sourceRef:
                kind: HelmRepository
                name: element-call
            interval: 60m
    install:
        crds: Create
        timeout: 25m
    upgrade:
        timeout: 25m
        crds: CreateReplace
        # Force recreation due to Helm not properly patching Deployment with e.g. added port,
        # causing spurious drift detection
        force: true
    values:
        livekit_key: ENC[AES256_GCM,data:PR3Rgu80xHY3a2m3Z49NC8BeWGoxlH2SB8mBW/Ec+DKzrGXG0jrViMsU4WUZLFAmTrq+SYWgS0LsRr7bj4Jlkg==,iv:fo4A3Qo8SDnSP2UU2A9x+ECP4ipWXSNiRS3fuFQXzsU=,tag:FncbR8Mj8I8PDBanGgu/UQ==,type:str]
        livekit_secret: ENC[AES256_GCM,data:h1Drkyb6mcl03x5pI3N179nvcom0rCVmhbwcbLcwt6+5igMlJ9QuGgGTwJ0jFsnmJFiE8iB1I0HFqDsfnZr/Tg==,iv:xV0acFiKVA9Qv/+2UMPeqaaEUUtLiApqkZky5b0LY7c=,tag:2LKU9h3nRVYUw+FeRg1JOQ==,type:str]
        element_call:
            replicaCount: 1
            config:
                eula: https://example.com
                homeserver:
                    base_url: https://matrix-call.midnightthoughts.space
                    server_name: matrix-call.midnightthoughts.space
            ingress:
                enabled: true
                annotations:
                    cert-manager.io/cluster-issuer: letsencrypt-http
                hosts:
                    - host: call.midnightthoughts.space
                      paths:
                        - path: /
                          pathType: ImplementationSpecific
                tls:
                    - secretName: call.midnightthoughts.space-tls
                      hosts:
                        - call.midnightthoughts.space
        livekit-server:
            livekit:
                keys:
                    bQXMwwlTCTbxDd6xRHYaaK5gzOzyb1gzS5E89vrJ96ONp3kEH4Ljh9su5L3BQc33: ENC[AES256_GCM,data:SLYXGdqRty/qOB/wfOVaNzTMjumJqlvrFKQ0UW6dPon5zN8hu/WQTkS9x0ociqXRKWRKNpBbvbLawws0cS7pTg==,iv:FuOAkaXHLnrBott6wgYi5QlkFPxTMcu9idQz/xCSbFw=,tag:kk/lSnrBI58z54xOWxYOVQ==,type:str]
                    iHMQVcTZSmUek9m55nFcvpGWaAR1nGpQggvEmvKyWqWbu099EjSZ2sQkU1ZMpR1h: ENC[AES256_GCM,data:YgBTzx3UTjdDR7Oj09QM5rcKbvwXQFj5zK2gFNJHfEhrj1ItnCcs42gK4CHXEWwA/SDuGveNn9tV2d4WfJijVw==,iv:dUu8hG/n2QNSNfx5OIia8y1GlCXsTgy9a3QY5mYyNEE=,tag:kJGH3C+Xcwd4yZPHoIGRng==,type:str]
                redis:
                    address: element-call-redis-master:6379
                    db: 0
                    password: ENC[AES256_GCM,data:REpTMwk1whnOtP7gg5fhtez1P9djxhbA7dHYpfruuO4dhR9i0nokh6pzlYpP0ajxAC1fIYXwOUnnhQHEWVjhXA==,iv:t1Ra5vlLeA07vUtUaaF/KH+zBFErPwxIzAMEs3L3UJY=,tag:Krv2AsgjC8VX7C+sBvlB1Q==,type:str]
        redis:
            auth:
                password: ENC[AES256_GCM,data:NKe98UcOJttyNXzZNISin3WnSHX5iF4LvkKK2du5aiNchcdDpqj+JSVINYIG0Pge9nOoyRWpwvt4hBC1Ds8uug==,iv:bNtFDQlg0ABkTh0+QEsRYTQN0/wiixd1hpGeYMoLyck=,tag:WrtuPnbzl/hQU4WJUSzDUA==,type:str]
        egress:
            api_key: ENC[AES256_GCM,data:hwEd4uoH6mri7++jWsjFD+mVIrqqfUNNZnt6PIxy+bV1V052PwaLZVgeCRekYTQXsJc0wPFbEQGu1DCedlTdGA==,iv:Lj/bLwkvQsJDg9SMmMfcr7j8KVSa5vJ/pf29YnDqsSo=,tag:d79HA0Dn1MbKVnn+mnssSA==,type:str]
            api_secret: ENC[AES256_GCM,data:tbqvnx05I14k4mpzSrAzDjgS9e4sr52j5+TKgFcXYCz5VfCfsiToKxEnoL9sZjS1QygZCSS8I2GE7WaJr9tO0Q==,iv:1S7G5f4wtMGYtv6htl/oMG3QMcXDgHSV1fZDDaIWERY=,tag:sc5MGvWE9F2fJSoqlKtwXg==,type:str]
            ws_url: ws://element-call-livekit-server:7880
sops:
    kms: []
    gcp_kms: []
    azure_kv: []
    hc_vault: []
    age:
        - recipient: age1esjyg2qfy49awv0ptkzvpk425adczjr38m37w2mmcahzc4p8n54sll2nzh
          enc: |
            -----BEGIN AGE ENCRYPTED FILE-----
            YWdlLWVuY3J5cHRpb24ub3JnL3YxCi0+IFgyNTUxOSBnWW5ya29WemQxRzk1bytq
            UzV3ak40MlZlT0lvZ1h5QmxZMUdnUm9GVXdBCjNNTGdsQ1dOTVg0RlRhSE1QU0gr
            dWU3L3A4TG9mVFdoU1ZCekhKem1lS2MKLS0tIGNOVUJ0VkYvd2VldjJMbnhueVg0
            RlFqMytTVUxwKytLWkg5UkFlQWJ3R0EK3d6SXxLtiYI7P8ffM+ieAuKCPARoEWcv
            gBJWmVoPP0JRO7RPYTkw/MJlCwU2JG4Li+qxNhz7Wv6e9zjY5eW43g==
            -----END AGE ENCRYPTED FILE-----
    lastmodified: "2024-03-06T09:47:10Z"
    mac: ENC[AES256_GCM,data:Geuwyz5oX3Bp8EWKiuXH0tdLWOBL5FFrtoiS6JaNpL3d76r7U4gjvYCO+WkM1btEp8F+beqJIG/zJWJBCnFKT0OHjVKmJ4kFchYRDvPsx8vuIWPd8sVilgKbEPd7M1RX8kOhfvP7ExjncPXSP4uvnQhVwHFFLJTBuq+8NyFolcM=,iv:DBz+vYjjepfevXWlVfJzmAk1YhHSl4Q+YwlHZhEeJz8=,tag:zK+ElwOABqUU1jo8duiHBA==,type:str]
    pgp: []
    encrypted_regex: ^(api_key|api_secret|keys|livekit_key|livekit_secret|secret_key|adminPassword|admin_pass|admin_email|mariadbPassword|mariadbRootPassword|privateKey|data|stringData|PASSWD|password|pass|postgresPassword|postgresqlPassword|redminePassword|smtpPassword|registration_shared_secret|shared_secret|secret)$
    version: 3.8.1
