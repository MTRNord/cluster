apiVersion: gerritoperator.google.com/v1beta13
kind: GerritCluster
metadata:
    name: gerrit
    namespace: gerrit
spec:
    containerImages:
        imagePullPolicy: Always
        gerritImages:
            registry: ghcr.io
            org: mtrnord
            tag: latest
    storage:
        # Which StorageClasses should be used
        storageClasses:
            readWriteOnce: ceph-filesystem
            readWriteMany: ceph-filesystem
        # The shared storage will be used to store git repositories, logs and other
        # components shared between Gerrit instances
        sharedStorage:
            size: 1Gi
    ingress:
        enabled: true
        host: gerrit.midnightthoughts.space
        annotations:
            external-dns.alpha.kubernetes.io/hostname: midnightthoughts.space
        tls:
            enabled: true
            secret: ENC[AES256_GCM,data:62anhjwEsYak/3tNg9Pg3pH4XwKqbcl5Es5zfmMCiJbk,iv:e/lF/H//ks5Za9a15n+0AqloE+yhFF42DIlYnQBvFjc=,tag:gIplxAvHns5KAxHXelHvUw==,type:str]
    # All Gerrit instances in the GerritCluster serve the same repositories and
    # thus have to use the same serverId, which has to be set centrally here.
    serverId: midnightthoughts-gerrit
    # List of Gerrit deployments to be installed in the GerritCluster
    gerrits:
        # A primary Gerrit
        - metadata:
            name: gerrit
            labels:
                app: gerrit
          spec:
            mode: PRIMARY
            replicas: 1
            resources:
                requests:
                    cpu: 1
                    memory: 5Gi
                limits:
                    cpu: 1
                    memory: 6Gi
            service:
                type: NodePort
                httpPort: 80
                sshPort: 29418
            site:
                size: 1Gi
            startupProbe:
                initialDelaySeconds: 30
                periodSeconds: 10
                timeoutSeconds: 10
                successThreshold: 1
                failureThreshold: 10
            readinessProbe:
                initialDelaySeconds: 30
                periodSeconds: 10
                timeoutSeconds: 10
                successThreshold: 1
                failureThreshold: 10
            livenessProbe:
                initialDelaySeconds: 120
                periodSeconds: 10
                timeoutSeconds: 10
                successThreshold: 1
                failureThreshold: 3
            plugins:
                # This way plugins are installed from the Gerrit-war file
                - name: download-commands
                - name: delete-project
                - name: oauth
                  url: https://gerrit-ci.gerritforge.com/job/plugin-oauth-bazel-master-master/lastSuccessfulBuild/artifact/bazel-bin/plugins/oauth/oauth.jar
                  sha1: 005ff9ae2f724c3bd4cd6f4259ee9c03b4ce88a5
            configFiles:
                # Some configuration options are specific to the k8sgerrit setup. These
                # will be set by the Gerrit Operator.
                gerrit.config: ENC[AES256_GCM,data:p//btiAaiugGbOoeVVdnqEyz6e7GVB8ue6U1mF6yi8/xJLb17lzaXMVMZ7wKKVFHPaiNUneJfGppm7E2ruh92Ik5yqHa1wLKLUsYpGbVTovqELmv+r6/QB+JRLhXEBmYI3HTh0TGvX2JJLkrgEufKN2wTh/tzHvjxvSgaHgvkUK/+0UJz4nUawoqioiKcC8kFd0kBgskowkhVLgjFhNt/W/o4NXkc+V1CEhjBVrG+rbiNKhHvoRVULyI54qKIm3xF3x+WP4D0YF/QZ78ORJO2PlEqVHp8q4nfSt2miot0ahDO8OtZuQhi7zqmDO6n0uQhjaBp/qlk945jDjPW9OWIiLCL4abrjLNhPSN04y3NK5h8OxEyyLNpeMGo9jkuJsc3YEWx4QcwnJydFcCazIdVsBWwf1s3oU50531A7U1B0b/yk9W2cpVTkoMrQNeaPhhCx7F/ReDgYvnjtbLzr9TFBLLoChDIVkMX6QOmhOKOKB39iCZna6tlN0K/bqURRmucrJCajdq9KgjGwz/hcMtDXj7Wj268TQk1OqKGzm+QHeQcgy70aRz9X2TBcWo/rPKneqOMEBR6Y6NvLl1Q6ybgTveRLeXCG/HsWWKp+CsMPUutOrnIlDCi8lUivvhcn95RA8qe5ZiRR10ixV5OFdvDs8M9f9ql3JjQHNjC8tCLfdYJcANkrozgMikXqjr+Ur8KQeSL7hBBsoV/JtxF3/NaEJfxywXr1UdruzCVzZj5BTnKqJGCK60aNjHcASsWVSVQBzviVV95yY0Xm8nF9wLTZHczRSZ5RS1tUB6OHiHOITIngG7+5TjJDe1pxhhmNY1q4pzFj7lOWA9KuP2TlsXfXYIkbzg1DLE7k3Q/aTMo6MNaV5IfcRv8ttfjkrH+X67RVgoMcCngYBDSUPglUPTqVAL6MEMCVOhL6s9w73VNb8BqMekWvk1xJIqsd3JzQ0lZKBcqll0S4FBubyUT9EndsK3nrRXjBwuXjfv8/mrnGxv0L1BayncYFNz6JgljHA0kFGSsKxfqpZFUlRNrHnK+pIYHiIdH+6f/Z7F3rPP/b+1hzPyPWRpZJqcNM2DCmG6b03FYK1lSqJ86qySVuehiiGe7JywlLMzP9PjFcO5nGVYeQRtKaVOIgT8nm1umVq9SfdRoDM9SRS1JF1e6mNi+B2He1/ze2uLYhJ2ntClVe+ZWkRmr47SW1TTsOOnrd733fZsFfFEGH+f84T4s28lmrdFunQliL7rmM8cVmimjqWgAfXVplj4LHy+e2knz3ThoiwwGmRyaZB7vR5EAHPAo5KS1v2CPBZf2MnoA9HsMPnNRoK98nQADgloLOo9cTT9fHfh9SAqBn5yQJxTM/krKqj0gxs3YOPXpHtpjcUWwt34gqXDH33eqB7SQBR1xei8C/kyCctyNlSO5linR8dcN0UqTEiVOBj6/0g/kV60etOMaaxZYXu3LYY2TOmo7prO3pebnR7LmNvsNI+uAABMUg+dZlD6hcjZlNsQlhb9e/lnDA==,iv:ntGfhXLdhApvusbPFrWFX3lHWQ3wC2NmGDKtDoqj5tQ=,tag:Qtn8hFbWDRmde/s2jC8POg==,type:str]
            # Reference by name to the Secret containing secret files to be mounted to
            # $SITE/etc
            secretRef: gerrit-secure-config
        # Gerrit Replica
        - metadata:
            name: gerrit-replica
            labels:
                app: gerrit-replica
          spec:
            mode: REPLICA
            replicas: 1
            resources:
                requests:
                    cpu: 1
                    memory: 5Gi
                limits:
                    cpu: 1
                    memory: 6Gi
            service:
                type: NodePort
                httpPort: 80
                sshPort: 29418
            site:
                size: 1Gi
            plugins:
                - name: oauth
                  url: https://gerrit-ci.gerritforge.com/job/plugin-oauth-bazel-master-master/lastSuccessfulBuild/artifact/bazel-bin/plugins/oauth/oauth.jar
                  sha1: 005ff9ae2f724c3bd4cd6f4259ee9c03b4ce88a5
            startupProbe:
                initialDelaySeconds: 30
                periodSeconds: 10
                timeoutSeconds: 10
                successThreshold: 1
                failureThreshold: 10
            readinessProbe:
                initialDelaySeconds: 30
                periodSeconds: 10
                timeoutSeconds: 10
                successThreshold: 1
                failureThreshold: 10
            livenessProbe:
                initialDelaySeconds: 120
                periodSeconds: 10
                timeoutSeconds: 10
                successThreshold: 1
                failureThreshold: 3
            configFiles:
                gerrit.config: ENC[AES256_GCM,data:814Ko7e1IBoTgIPHktheKaUzlqJvgS9sXr09m5dtbUgwnYVLxjfrQUc/shsa/F/eOPq2hgwnNJ6VXUhKbBsXLrNSzy7fOUz0MiEtZ0B1ePeMnxDqxD6I1TZjZ5K/1swd1SC7LGYG4QUU2sUXDo9dLfWKCmLlWh0y0RgwJy+9MeAC2Ht8vUHYmEyJm6ahwl7rB1oScl06rwaHLDt8QFFcBxcmY+MvFy8KUtP6kQaeP6vcXu+kxX8ayiMt508U4CYEa6RIFzYpTzaZEkIOyAElLWl5eYQHM2UOZENXJHGFgK7RBMnBjmQdIVjr5RDdnoH9EIAwE/zNbhJ3QyZBdyOTKXA5fgeIWyEGtwIsuS17rE48TcIuhkEFgpuTeVinEt1LGFSTQEqplMI3seucTD/fEEs2QNOR7bJwx3iO6KdX2LqYuD+OL7YBcmlxZyI4MTMRzr9qwQHfEKtt3r6Elu2CBCdoU8vYfZNpMgtT63ZlCbtnq5LHY1pFMks+UBPvS00bxkduAp5TCd0ENuODDdNn3/8n+gLxzNMuEcZkoSWtSzE4werbQQZC0f1e0dg28OqW8+4EA7Xns5KWgr/JXNXv6PxBIMOOQB8BZH8Rn8Khfl1p4SmUFi/RJBe9OIJ6b3T4l6Qg07n5YowyqAUauNWSoL/8sowqoPiZ2Q2poHapLCJPmuu3Wm1lkoecbwyc3MNXYCWjKaAyl/SQy+tY06ZJaekaTbMc7tCNhmouLrUR1SJNx92R2PFOBDHPUxr6U6DH4gCY7HiEhbDvO8r6y6o3gzbp+OIu8+U6vZm7cWZZ5kHz2U2oNq74dLd2M+V9vCNEw2c6WM2DQOBWDnPtMLrjYg5/a5aXWNH29P+Ub91MvupXuJyFab7L/2RG0ufCQST78eIzriLGmhHhN7TJV0a16zyql1UJ7QnUTQjtxTwkcT3u43FtcZdnjRDeHdBE3K67aeGBj9c/d6Udi/CqXhq4WqJN/hHmZgnsyi9RgRcLEnhGlKeYE+4iMTOthBakX0HUwZ3Df9T1p+wUUXyfi5IsUR4W3mfGMBEJxCsppzS6YiljRqaU8bOL2Uvz96Ii6khqXbTgxspi9BHShUP0SlJbLEIVPFjaSJnPS7aYggH4yET7bTqOzKR+nB/xoW5DvCN+WI5mIYmj48kiV9mcT5ZXabs0+APR+E7yJmzaR6RvuI7l4T7nAe/bsxtRatt29/A8H0iOigIrsuVFnz+0o1WIv0pyE46jY7y8NgwcQxP7BWn+U5IIJ5zXsgt0R197atA10iT5gZSvl1I+pKmhAUXCsZLhF/2Xg504qw+XlVgQ0S8Y2axmzY4f+2i7ytMjYGotkM/wKRFk1U+ePjFZAGI43x24LZpqFputwV4XM+ikwLgDL9MK+8wbMwjyXxkTzwZukQfJCwKgDK62ULt5oUzMAjSjHClokdXE/2Q/vbKJPxQI/kVVzQYMv51LXG2H4elYKAZ2cEbb+DQPJwiKDTwuWxVYtavb6THTAz+8EVAbt+mSUQ==,iv:Gi/u8Ce6hj6zr0FbTueKh+8UhIHPA3+0cKL4sPwylGw=,tag:tT6fqq2bL5I2/4vnZPYFNA==,type:str]
                healthcheck.config: |-
                    [healthcheck "auth"]
                      enabled = false
            secretRef: gerrit-secure-config
sops:
    kms: []
    gcp_kms: []
    azure_kv: []
    hc_vault: []
    age:
        - recipient: age1esjyg2qfy49awv0ptkzvpk425adczjr38m37w2mmcahzc4p8n54sll2nzh
          enc: |
            -----BEGIN AGE ENCRYPTED FILE-----
            YWdlLWVuY3J5cHRpb24ub3JnL3YxCi0+IFgyNTUxOSB0NkN4SUNBY0N6cDl4VElX
            OU50YUZUaERlZ1ZGQ1Y3ZHZmNXN1Sk0zSWlJCnh5Skwydk5ya2srbjBQVEgxdHpR
            VEJBYWpZL2JFcHd3Q29TMUZpcHpFc3cKLS0tIFBlNndFVWhFZkJ2ejRVVlB3ZWwx
            dHd6MUxpb3grNFR0bmcxQTh4QjVNcW8KdjdYiuVIOYy21/IoQ7oKLpdTJ5jdgydN
            ix1MPAr65UjpPodPSxc9x2yaeYfHg2m0MnjkG261+0Kww79P927JFg==
            -----END AGE ENCRYPTED FILE-----
    lastmodified: "2024-12-20T02:14:29Z"
    mac: ENC[AES256_GCM,data:kVPrU3HC3I7EWuEfcIgfe8AdzH7q5JY9N84W2NpfWy+71nYhTgGJNLvweCi9muQrHav9llfBwMsiSd7izp8EzhOA6Rb9FYRnMxvI0ELYvqy6pgQ7bc95pkkZOlLfkKW/60emNep+isZg+Xq7rtMQL/qPBgClsqqmxswQR+mHkNc=,iv:h6b5tonzqbWGxEVXBooNrRxvP55z6nszcXvMh0bp3bk=,tag:QvNyTbRFDk5iEMesDD9vfg==,type:str]
    pgp: []
    encrypted_regex: ^(gerrit.config|routing_key|DATABASE_URL|SMTP_PASSWORD|SECRET_KEY_BASE|admin_password|extraCommands|key|clickhouseDatabaseURL|databaseURL|client_id|client_secret|secret_key_base|otp_secret|private_key|public_key|primaryKey|deterministicKey|keyDerivationSalt|token|clientId|secretKey|installationId|installationKey|uriOverride|adminToken.value|password.value|sql_password|erlangCookie|AUTHENTICATION_PASSWORD|ROOM_API_SECRET_KEY|adminPassword|configPassword|adminUser|configUser|MAIL_PASSWORD|APP_KEY|api_key|api_secret|keys|livekit_key|livekit_secret|secret_key|admin_pass|admin_email|mariadbPassword|mariadbRootPassword|privateKey|data|stringData|PASSWD|password|pass|postgresPassword|postgresqlPassword|redminePassword|smtpPassword|registration_shared_secret|shared_secret|secret|admin_token|integrationKey|rootPassword)$
    version: 3.9.1
