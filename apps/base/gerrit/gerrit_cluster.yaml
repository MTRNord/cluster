apiVersion: gerritoperator.google.com/v1beta13
kind: GerritCluster
metadata:
    name: gerrit
    namespace: gerrit
spec:
    containerImages:
        imagePullPolicy: Always
        gerritImages:
            registry: ghcr.io
            org: mtrnord
            tag: latest
    storage:
        # Which StorageClasses should be used
        storageClasses:
            readWriteOnce: ceph-filesystem
            readWriteMany: ceph-filesystem
        # The shared storage will be used to store git repositories, logs and other
        # components shared between Gerrit instances
        sharedStorage:
            size: 1Gi
    ingress:
        enabled: true
        host: gerrit.midnightthoughts.space
        annotations:
            external-dns.alpha.kubernetes.io/hostname: midnightthoughts.space
        tls:
            enabled: true
            secret: ENC[AES256_GCM,data:PadbDuau7X16R5BV1aWrNp26Z3nh3mOoBDmE8R1LO8Ol,iv:MZzPA/5GWW9tmQW0rotJiWlkgXMc928gzGQUgGLEvF8=,tag:8XCXsX7indGehLgK+ENhPA==,type:str]
    # All Gerrit instances in the GerritCluster serve the same repositories and
    # thus have to use the same serverId, which has to be set centrally here.
    serverId: midnightthoughts-gerrit
    # List of Gerrit deployments to be installed in the GerritCluster
    gerrits:
        # A primary Gerrit
        - metadata:
            name: gerrit
            labels:
                app: gerrit
          spec:
            mode: PRIMARY
            replicas: 1
            resources:
                requests:
                    cpu: 1
                    memory: 5Gi
                limits:
                    cpu: 1
                    memory: 6Gi
            service:
                type: NodePort
                httpPort: 80
                sshPort: 29418
            site:
                size: 1Gi
            startupProbe:
                initialDelaySeconds: 30
                periodSeconds: 10
                timeoutSeconds: 10
                successThreshold: 1
                failureThreshold: 10
            readinessProbe:
                initialDelaySeconds: 30
                periodSeconds: 10
                timeoutSeconds: 10
                successThreshold: 1
                failureThreshold: 10
            livenessProbe:
                initialDelaySeconds: 120
                periodSeconds: 10
                timeoutSeconds: 10
                successThreshold: 1
                failureThreshold: 3
            plugins:
                # This way plugins are installed from the Gerrit-war file
                - name: download-commands
                - name: delete-project
                - name: oauth
                  url: https://gerrit-ci.gerritforge.com/job/plugin-oauth-bazel-master-master/lastSuccessfulBuild/artifact/bazel-bin/plugins/oauth/oauth.jar
                  sha1: 005ff9ae2f724c3bd4cd6f4259ee9c03b4ce88a5
                - name: checks
                  url: https://gerrit-ci.gerritforge.com/job/plugin-checks-bazel-master/lastSuccessfulBuild/artifact/bazel-bin/plugins/checks/checks.jar
                  sha1: aa2d4c6cae157f9e7f26f33c4149bc254f6ed983
            configFiles:
                # Some configuration options are specific to the k8sgerrit setup. These
                # will be set by the Gerrit Operator.
                gerrit.config: ENC[AES256_GCM,data:Jv0UgGL9s2i3tDyKSbep/MoqKBSeNkC3q/itAn25TO4eTGn9kQ0oL/jNUkKYXa95D53qRoDFgki75f0ReVeyr6bd7daDYO8br9l3tR1/QVyDjWvmFXH7zancQY1Yl8ud4gBjx7FyMdORVWconrk3KuKBSKAYXxjhmIVUFnY9keMjh85QvPrBHLN4pC6At9Nm9uC2Sceu3CHsIgxzolkPcdPUG8jWCGaXA3xwtgCsUyI+6OlJs+6ag+kFoGcMLn0CBzY2J0/nEYlwd/za4BAjG1A4K75+fTl/vA7ZRwcKW2Tz7zSJ0sjTBjJKO6kVBNYIKtjgdm+NERs0F4O7UleHqt0Oe0qlvUKmfkXhB5Kpg2D3LHXqiJYOftF8mgN5DNKClKwt+Ah9hpfykm9jVUOXp/kWy+e2UX4afMrabsTOc2kW5zIyr5PXcjIoijrRj7ATex4tAkFps7+YZVQYVupuMSd7L8d/7oz6zHtXyQfFOfeW/lrTSMtQDt5K9FQ6gxi8zMZ93enHUvx4mKyVaITdrL4MgTj/IWtiEeTH/5Ji0h+j/QqcLH35VC3lW3cXcSH9T/kDXKgzVIFIeYio9WA1LbjuIovDj6GjHx8RZUMLeehEmPpE27JACs2Ky3uJjuOOZPCNYpef8TPp/ORdILBPPn/yy/zA9CT1pNqxror/K+eF6Bp1CiS7CCFBJAAmx4F25QrpTWrFPe79rcZp8a7Nb+hrKOpD4G1oZHKcwQ8oksBwmnH7irH4nITnUt/0zGL6lnGC+Yl7UXMOAAaFYK521Dy/OqKr/4iV7iwLDPej2K942ApG5OpTUPYfddq9QwS5lMGBqWKx/hnz6N6ZOvKTqZ3gMSYqIDYfqD4xcW/g3YeF0UmMo3ED21eNSltQ8v1KLf7AFeQKFLoxHKJ5ykCDG7zWdvo8vlCIBoorHdCOVR1m4KlbqSWJ+dhwx9EEEaU5BQO6qzZ1KRS1Gn9Z2AZXDIEka2iNgawwlWHHVcYwIwlHVba+zoclqT378UgkQF0hqkwOPJnHeupQKK6EzNyoTpd/U6P1OWPnK+BfcvIY6ZexIiSmBh6XILQnKlIwnOtVKRMzlxPFSocB2wxwJ0Fx26FfP5XiPoKas2cWYFXYYS7hJTLrz9N16v9WlW6T0JDmj5ELVuEU2kmDo9N7XPOiEU3/GCdCJpmUixmmeItBYEaV6B8pvto/B09d7RNraHvORdbjuQIvloksretCD43M+F96jHysthGBLnTtd9m+Tp6talz6/0xPgXgB9o/ESC5tl/w/vWw91WVMCNj7W480u7nDtNfxW7bvc1xaUQZRid3c9SdEicbiLCUtDBL32ePFdgoUhFkDjRydNx4zrWcUL4LAZBhJOjSHw90WH+4ar/FIDtIq+ArlKxsAEKj9TBuRUq4trhTFm7YAq8XgaSg8ZelCMTrPki2mVG1zio3Mk+oxPvFUNb1wPPw88ArQKtm3HnhPh552j6gbxw0hsGYMW0cCl0OLTIeKgIyDIsNmdzKXrWubLG2lRhcrQ2RfU5RlHjzsdJHjuPqMB2ZeUbtnyZulzBjlp96kGho3DAGTLV8=,iv:2q0C1fTTGCRE0MRhs/l16BBAIv5vZxkz/aIvkWombvo=,tag:EI3kE4kkbAz4RVRg9G0Org==,type:str]
            # Reference by name to the Secret containing secret files to be mounted to
            # $SITE/etc
            secretRef: gerrit-secure-config
        # Gerrit Replica
        - metadata:
            name: gerrit-replica
            labels:
                app: gerrit-replica
          spec:
            mode: REPLICA
            replicas: 1
            resources:
                requests:
                    cpu: 1
                    memory: 5Gi
                limits:
                    cpu: 1
                    memory: 6Gi
            service:
                type: NodePort
                httpPort: 80
                sshPort: 29418
            site:
                size: 1Gi
            plugins:
                - name: oauth
                  url: https://gerrit-ci.gerritforge.com/job/plugin-oauth-bazel-master-master/lastSuccessfulBuild/artifact/bazel-bin/plugins/oauth/oauth.jar
                  sha1: 005ff9ae2f724c3bd4cd6f4259ee9c03b4ce88a5
            startupProbe:
                initialDelaySeconds: 30
                periodSeconds: 10
                timeoutSeconds: 10
                successThreshold: 1
                failureThreshold: 10
            readinessProbe:
                initialDelaySeconds: 30
                periodSeconds: 10
                timeoutSeconds: 10
                successThreshold: 1
                failureThreshold: 10
            livenessProbe:
                initialDelaySeconds: 120
                periodSeconds: 10
                timeoutSeconds: 10
                successThreshold: 1
                failureThreshold: 3
            configFiles:
                gerrit.config: ENC[AES256_GCM,data:fAl2/ApWSr4dTkQp+MlWneGEvQGqjqceGU3Q5XSUEAP9zdPZP8gRGGnbekRB7UH2wupb/EVNme6D7sS/Oi4DfpgdlmpFy2vb93gjPILZxGxttpo0b8+OXO0Kn/5FGQJ4kJxCD6bYnzTYjeN628XWySIbMuGNeCv8jgTkhM0ye0wl52WzhIdzZOQpMrHajH2goViOYNESrpoUaM9Ja8HIXTomEwWzi6FXW0iD9Bk3WL514kwn7m2vS3waiuXwT9L5eeXwd4/dhM+lA5PMPIcEiWxdc206N6ECvEGtgxEJZQbFhmjtQ6OVgK1PZmLCltIEChaDo4VVFTP23wypVzdVJnVyso7a0Cm44zt0d2r9c2r3afzsyJwmLpEE4GbccSfAO2nJ8AcIybsObH69vdvNutEpQxsQ4Zox4UP6NFEZHCA06TWylbRTkSzyFQBaktQIBX4v9/XFNqPdJT1HypeSNQWa+dB1nrxlPqnQR2bLtskqSeYBgoFA6bUjidfz+w3N3b+PuC2IU0vxxLUT4UDHsQ6YkT8G2JFJiGInke13nq+4dT3zBmwIMEcE0bvsYqOXHQaNbesd2BveY8ISjN14WTaKkd6GBT73sQvI+0pnvIbV2Ke8nSUrmzo75/v442Faee8XsleTwWQChlK14Poz0wFYJo4rHy+uMymxPX6HS5lKoKgPMj3CiIcwgdTgC2Kg34wQq2QUqfzs8A/QKFLPBuA/SykMF3/PZRKKCIYDslTZCLeeww64ZTCFjoBwSaUdTRGGACCBS7YYvUBymibL/VKerZ8A2brgXJJzGNHTeSADpYizjyf+F3qsilzQdkW5cB64gwhSNB2aYzJmvkhHt+y6YpXjzP4FyIXCv6vClOodPx/qkb1jfQlIBjdik7Qr58CxPQnv9yEVhBUx2mzc6QOh2a+BTEk5cz48pevs3FLAL25IJte48xqZQc6u0COpeEyTDLDzjE6PLq4BSC8fw/dGMXUSwOFVbai/FHlYVUFKAUD1UgBvUvuOI7s5282DX5jlQaxMbM8JXbnj/fEloJhMiXjGLmXMFSuaBWdkikrneng4E4RvnQqcVnxdlUkKU6vvPpYX2e8gf+gFMuNwCcdECzpPm6EUo9PpnWcIx2FGyPE6l4gAkDjnpsqR5rdEq3hjRPkzlL6xXQy5Vfu3GJNIdjJoRz+JKTLSqMrVEUYkZAUoOiwj4BW7iyyTXRqnKqtrDUMMF/WC9tMssStcAG/hIr2T5efrzhgob8WQtfezLKM0QNW/gwZidqf1VsdG0k3P9lQJR22mKPp00AvciEPxm13u8sIQTdefA2alhR/eYNCPof7NvC07g4pphrbZ8yarmcdEOiXRUgv1h5AtobQ4UC4ZGaiiDykWdmx6w7LddTXBtesBO0tC8CKtW86WD5tcI+sISLe8pUUZRDWehbRraOnCw135DYjmIu+A96XsZU4rmxMGAvNv8Medh6HTRDtzT07W8GmUExprmiembJd/8b/1fjEWiLGAWcm82TNObdO2FZyUSeyoMnGiUBRarzvnvcAleQN0OwrpHeGnVilR3w0Mc+TgDlAVCZ4I/iQ=,iv:VavsmXFVq4DTtIHmJFyBCqZjE+ERz8LgUgOSg0iYATE=,tag:t1s6ZwNmK4rUE+57w0GRzw==,type:str]
                healthcheck.config: |-
                    [healthcheck "auth"]
                      enabled = false
            secretRef: gerrit-secure-config
sops:
    kms: []
    gcp_kms: []
    azure_kv: []
    hc_vault: []
    age:
        - recipient: age1esjyg2qfy49awv0ptkzvpk425adczjr38m37w2mmcahzc4p8n54sll2nzh
          enc: |
            -----BEGIN AGE ENCRYPTED FILE-----
            YWdlLWVuY3J5cHRpb24ub3JnL3YxCi0+IFgyNTUxOSBidkgreXJTQTc3eSt2dkE4
            cHdaa21xSUVZRUpKQmtDRjFwNCtkQjlWaGxnCnB3ZmVxaG15RGRkZ3kvTGdlMUVE
            a0xtbzBBcWZWQ2ZmQUJWU25mZXRZa3cKLS0tIEVZeW1LSE4vQ291endLc08wU05h
            emdZbHQ4MHl3YUs5b1VOdVg1UTQ4SFEKinfmyozp2HawqNTX9LTEApQejZaSTeiE
            vxGKP7HUCmEj/Xxv5vXxO0Xz0l9THDl6vG4WW12ystEXV2E7SJMKxw==
            -----END AGE ENCRYPTED FILE-----
    lastmodified: "2024-12-20T02:53:07Z"
    mac: ENC[AES256_GCM,data:zAr/O+FlgDxBpSTLKeXtH+q2t2bLIZZCKOfpismeViJDJ1va3xOJuNpF+Qbl9qMj8GIc/6ymxo+IiWVMqx20iR8puGfSgCnp/iYGRBY9q8n5q5zeuev9yg0DhG0RrGu7V/UbmPt+VTEHiUu+mHllLGM8CLvYdd0cdrF0mu3ki+w=,iv:rVSK/dbrVxFcNhjCmV3FROKFwIrpEheBwC3pcelkqo0=,tag:aTI7w2voLZ5Xee8AcXkjrw==,type:str]
    pgp: []
    encrypted_regex: ^(gerrit.config|routing_key|DATABASE_URL|SMTP_PASSWORD|SECRET_KEY_BASE|admin_password|extraCommands|key|clickhouseDatabaseURL|databaseURL|client_id|client_secret|secret_key_base|otp_secret|private_key|public_key|primaryKey|deterministicKey|keyDerivationSalt|token|clientId|secretKey|installationId|installationKey|uriOverride|adminToken.value|password.value|sql_password|erlangCookie|AUTHENTICATION_PASSWORD|ROOM_API_SECRET_KEY|adminPassword|configPassword|adminUser|configUser|MAIL_PASSWORD|APP_KEY|api_key|api_secret|keys|livekit_key|livekit_secret|secret_key|admin_pass|admin_email|mariadbPassword|mariadbRootPassword|privateKey|data|stringData|PASSWD|password|pass|postgresPassword|postgresqlPassword|redminePassword|smtpPassword|registration_shared_secret|shared_secret|secret|admin_token|integrationKey|rootPassword)$
    version: 3.9.1
