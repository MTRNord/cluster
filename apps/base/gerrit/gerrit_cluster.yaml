apiVersion: gerritoperator.google.com/v1beta13
kind: GerritCluster
metadata:
    name: gerrit
    namespace: gerrit
spec:
    containerImages:
        imagePullPolicy: Always
        gerritImages:
            registry: ghcr.io
            org: mtrnord
            tag: latest
    storage:
        # Which StorageClasses should be used
        storageClasses:
            readWriteOnce: ceph-filesystem
            readWriteMany: ceph-filesystem
        # The shared storage will be used to store git repositories, logs and other
        # components shared between Gerrit instances
        sharedStorage:
            size: 1Gi
    ingress:
        enabled: true
        host: gerrit.midnightthoughts.space
        annotations:
            external-dns.alpha.kubernetes.io/hostname: midnightthoughts.space
        tls:
            enabled: true
            secret: ENC[AES256_GCM,data:FIhGV0mJTJ+NsmBrLVbEpSQJ/mo1+KDAqSuRvVpiEB0f,iv:oD59GGtVtAtX3vN2IDO62saKlftMC/kDkIHo3ER+6gM=,tag:5ukkOc1TfLIXLr+aPbV6xw==,type:str]
    # All Gerrit instances in the GerritCluster serve the same repositories and
    # thus have to use the same serverId, which has to be set centrally here.
    serverId: midnightthoughts-gerrit
    # List of Gerrit deployments to be installed in the GerritCluster
    gerrits:
        # A primary Gerrit
        - metadata:
            name: gerrit
            labels:
                app: gerrit
          spec:
            mode: PRIMARY
            replicas: 1
            resources:
                requests:
                    cpu: 1
                    memory: 5Gi
                limits:
                    cpu: 1
                    memory: 6Gi
            service:
                type: NodePort
                httpPort: 80
                sshPort: 29418
            site:
                size: 1Gi
            startupProbe:
                initialDelaySeconds: 30
                periodSeconds: 10
                timeoutSeconds: 10
                successThreshold: 1
                failureThreshold: 10
            readinessProbe:
                initialDelaySeconds: 30
                periodSeconds: 10
                timeoutSeconds: 10
                successThreshold: 1
                failureThreshold: 10
            livenessProbe:
                initialDelaySeconds: 120
                periodSeconds: 10
                timeoutSeconds: 10
                successThreshold: 1
                failureThreshold: 3
            plugins:
                # This way plugins are installed from the Gerrit-war file
                - name: download-commands
                - name: delete-project
                - name: replication
                - name: oauth
                  url: https://gerrit-ci.gerritforge.com/job/plugin-oauth-bazel-master-master/lastSuccessfulBuild/artifact/bazel-bin/plugins/oauth/oauth.jar
                  sha1: 005ff9ae2f724c3bd4cd6f4259ee9c03b4ce88a5
                - name: checks
                  url: https://gerrit-ci.gerritforge.com/job/plugin-checks-bazel-master/lastSuccessfulBuild/artifact/bazel-bin/plugins/checks/checks.jar
                  sha1: aa2d4c6cae157f9e7f26f33c4149bc254f6ed983
                - name: github
                  url: https://archive-ci.gerritforge.com/view/Plugins-stable-3.7/job/plugin-github-mvn-stable-3.7/lastSuccessfulBuild/archive/github-plugin/target/github-plugin-3.7.3.jar
                  sha1: 6e1956cc4e51deee1028f3e534bc5cbeb98603bd
            configFiles:
                # Some configuration options are specific to the k8sgerrit setup. These
                # will be set by the Gerrit Operator.
                gerrit.config: ENC[AES256_GCM,data:Go5ROs2DklGcKOj2FnnDP81MmE/hJpQ7wwPFSCLs3it6QVYox9YXD7Hz2WzkmQYOlX1P1R19hU8bClyjfxgix5hJWcKh7/6QFEBdxSBH1VSAJwIclK37F6isb1knhCKm4pfiXv4BCUau79HoVuxvhGMxOYYc9kn52yV7HR98RLIKd0+3t0O9bTDVr3/psd8VkohXdyvVPcRnPZkUEt6IwcMTK2ZARnVXK4HetrtwtLJhPsfJUUjqcdkvsj/eNR3+AuGAkzZclfcK7xUmaLR0a3jRWVffgjAB6eTAfFTqLBboCEs+ktY0xbXHGNKEVTbmj8pKi1SVAWc7oHe5EGTnYO5gjC9zQI4Oajm1Q5LTFXDPiipWfJr1tCOx94QC446t+gf9AFMTorN4uWbl2gicJk3FuVAmFfnYMCYAZiVo19dMACeGb8L5nrTidJ8pJvvY1/ouMbQ4lhwif3EGWOgyTC322n1ABON06ukTuU3OMx0YOvEYL4OAOFEi41WqjxLsEWucBwEEh+xBnZh8Yv3p5K1hW7mNZ++Uvz+VqISD3C0XQixsbJSCY7hCR5xRpKu9hMGAqCQP/VCX84eogZfOHKN/qjYlUbEMY0S3q9lUyMsoLcyqjpbQZyma7K1bE8/ZYd+0O9igP5WT5OdM0aB3n14PQniYtmkg6wKCrwyQoncxy3S4ak+kSVtPwC8D0Fx49zsm1mI9m5o1hzcdxMGMfPbY5ikcBLwPuIMx2ZsBGK5LcPoefOySYK0mx8R/EFAfooPBKhUfnJqMr3cG1PSDlt3zKxaJG5ugDcsXsMxuLrhjdBaiG0zGU6ETVXsHQQtxOYFnRXvKJcMzn8KuU8fP2rI5/9VTyAb2cVqC+2zoVJPclZeDljRmugVmKrGNpKFrZTSsnVRSkEOen08+YDu5GSCsXB7YuB8imUf35KfNk/bENBxTmf/VnLwoYT4oSkj4NfjXsRvLGBSoNzYufutpEvsHNYXNQt3FdDOpFEpyscM721SqGQmdQfhrcw9n9VjXS20WsAzqx0wBVCw8YTTtDIy05KOEfsjSPoDnbwDd2OHxeCcwWNwhv2VqxEOMxOLJoICXafiALJfGaFQr3M+SLqV7fktat5Sz5oytOpuW76KVfd9QV3xA9fbBx+Ks6tvMCwXGXAJjWNBISRWSS785B0LufVLAu00zWlBz8t2Mu2eyuI+H1QsofEuqH1AX4S3T/GzXB3qqHUz4n7lHkhytUiRJzJcpaoD/e4iU+t7lXq4J2gKBVY/eIkLOMlyEIgJ6JnLz1Xng2JwiESqtgpdA5RUZoHlP1QUrXutYQKPXV3uX6RLni7QDMwP9QA1ewVdo5v6AGb7DRxZIXy78JpjiLvHmkwk4YVkqiCOkFOF3wrY9Ka4vmzXfV8hOdiFK5HSMio81tav44/Tdjv5q8Flv7AXyTJJcnB/an98JwwQ3IAFZuMuASrZIWQdYSPBrS3/YA+Sl+kfmykA1gPknVOEmpyI6dBCjjxEPfmFYfD6hQS43lLcqjhFjx4HZC6Zo8w2SSuHsGSfZKGlqROMQBDSB2Hp8bwYCCEpIiKKKzqL+1RQ41thDXYceYvtJmjhq20vO,iv:pj/sGL+qM3MhLpQEUNQkTA8cHUuRAIQbMVKbA5objwk=,tag:08DqLJ2QknhsgJohULkkRg==,type:str]
            # Reference by name to the Secret containing secret files to be mounted to
            # $SITE/etc
            secretRef: gerrit-secure-config
        # Gerrit Replica
        - metadata:
            name: gerrit-replica
            labels:
                app: gerrit-replica
          spec:
            mode: REPLICA
            replicas: 1
            resources:
                requests:
                    cpu: 1
                    memory: 5Gi
                limits:
                    cpu: 1
                    memory: 6Gi
            service:
                type: NodePort
                httpPort: 80
                sshPort: 29418
            site:
                size: 1Gi
            plugins:
                - name: oauth
                  url: https://gerrit-ci.gerritforge.com/job/plugin-oauth-bazel-master-master/lastSuccessfulBuild/artifact/bazel-bin/plugins/oauth/oauth.jar
                  sha1: 005ff9ae2f724c3bd4cd6f4259ee9c03b4ce88a5
            startupProbe:
                initialDelaySeconds: 30
                periodSeconds: 10
                timeoutSeconds: 10
                successThreshold: 1
                failureThreshold: 10
            readinessProbe:
                initialDelaySeconds: 30
                periodSeconds: 10
                timeoutSeconds: 10
                successThreshold: 1
                failureThreshold: 10
            livenessProbe:
                initialDelaySeconds: 120
                periodSeconds: 10
                timeoutSeconds: 10
                successThreshold: 1
                failureThreshold: 3
            configFiles:
                gerrit.config: ENC[AES256_GCM,data:qaa0LYDnvqYOecEBuhbcF5zfK6pVQ8b/Mg+zqvsJ9SXr/0/EieRw9iQFNIboMZq2F9YTVCXkQDFI0GU6ExP52buvVBTlEudYSKdJfIBxe+rky8W+fOhZF73LR9ZD/yKizihWEYzQVeA7sShWjdXDVOMdUNja5fFzazZn7QSB7wjUquESg0dqIoWXqj5C/F8EEbT8c9sC8d+6YwLdC28sFP1k+dIwuHBGFYVpS2SXFoV4EMge+qHQIJxlAfyBAiO7RISdmLDYbMRD5FVXzYUkyjjNtdLLxSHwZAMh7O20wA9oAA1t+uuOQOstOfaKOPNiRhHXl/Ko3ueIVjz5CIyvjvpJeXFLVirS01VgGsrPsTa30zL/EXgoo0xE9EsZlrMu/jlMVp+cT6J6fx23wDwiGzuI7KHRAZZO85rDc/4FYBBWVX/ttf6YmhQa5tlqKAA82yLCKmsihPaBhdanByLd3hWp54ieA2vGZeP0hBUo4wRX5ztc32BfP5NXHLKRt9VHqWcotAAnUJ/xhPVDeLCm5l429uAWsUXIHemgedu6FIy8V65avkVnq05eWPoMlFx6m0nKzbu1959VwUafm8tc8bpgBImvGTIGtKV9+xa8/t5MKOB4r9YBYK8uhLwv9NkxFuZ4BtoCRENAngHKplO2jVtSp/QP5cYgH6Jmgpz4/bcHRx7ElFaIkEfY4qx0NeOvVcAk9t96E+Pho2LrjuU3snWxeVjqTdXDUJ3qPiMyd5SjkO0f6DSRLWZPBs6ALPJy/89fTz/6o4m5DcWG0ssiV3lSA64hWUBG6E88Us9o277sHcjZ0km3sN1MkEPTocU2umIR5T+HhdcXCxv1IzOBSjr46QqCPciXQ0s7jx/FN0QEV8sJDmqi545ojfCMTzk2k8sLA4G7gqhqOgWGW/d8s91Fkl76LfsNoIMQGgITCj1sckC62QLWskS4f55Y7G1ZKDLdnsnOm/Ka5hs6+E5UavFnLAoeLIKP8bnUcAvufh7AeDT4+pm8zqXSNWI35MCWmkHjrZiDS2njtH0ZSLGrnf2EJvmOCZnm2oPePI/IN9d2azHQ+RCqJ4uRUhPnL7JLopnPJ15pyqLp/LBW+kIKsYUpdyGX9q4hAnqAWxZQUGzFSeRp8DIRjI25URTbF7C+uA5GPrb86DQ8iK2+TCkaakiPNi2bHqvAk9hwlB2hq6Jf1OngLBtLzL8J5B5Z9lJCfQw5TI1ykzH+YpFh7Z594yu1Z3LKxAgQLU21Ng9P5lN45EkQSV3NbvCJa7HeQENbbFWBtGIC5B8fzCnatzE24aAHcrJcunAZD+4gLBJa4D22AbWAvSNPMP2Gxzhr/M1flhdmIYTLydt3Ndpp5bpninKFDwFgampNW+iNbxd56P5dI4TpU7kzsi2ANz1cGat5oWKwDIPabI7bLoksG5QAnHEItz9wkt6UP6SMbVzJzSTNL/HdSiBDEcAO8HXWwehokndU8bu9Ym6HsqL3p9trmXLa1eMYp5Cog4cUImT4LwLpzADMJI2eROlByZW12ABfws0WWQr1QfUknkwysgK+5THT16GchhVbFfY4Ch4Ua/rhrx1V5YZit2IKAPzjG2Fa,iv:JhfLFLIrifhk9q/1yE4qo1j+V2BwRkOEbwrIP6U+8uM=,tag:470FdeJmVgv3f18Ft6aUlg==,type:str]
                healthcheck.config: |-
                    [healthcheck "auth"]
                      enabled = false
            secretRef: gerrit-secure-config
sops:
    kms: []
    gcp_kms: []
    azure_kv: []
    hc_vault: []
    age:
        - recipient: age1esjyg2qfy49awv0ptkzvpk425adczjr38m37w2mmcahzc4p8n54sll2nzh
          enc: |
            -----BEGIN AGE ENCRYPTED FILE-----
            YWdlLWVuY3J5cHRpb24ub3JnL3YxCi0+IFgyNTUxOSAxN3dMQmRISCtpaHNGVlV6
            Qml2dEYxbHBlU2hnU1ZpeEdyeFJqUWZBVlF3Cnd0eERicEMyeURwM2pnREFlVzgv
            cnRrMytxZEhSQWxNTlR0LzRRODVBUVkKLS0tIHNxK1hFU3pSbjZvdFFzeHFIUkJi
            aWN5VkRjSTBkbDVJU1Q2NExSMDBzdm8Kg4tnYgfZFPkJn8mXWaHkXzRfhYjVxEih
            NRS350GWISCfDFRW1fFwMNqD3oTEjpw/KyGYQsDQJorc7dDRaEXblw==
            -----END AGE ENCRYPTED FILE-----
    lastmodified: "2024-12-20T09:05:02Z"
    mac: ENC[AES256_GCM,data:D+dwUPaiON2kIkuRb7/plgU4HMoMdhGGovTizW9wbzU7Rbw8DOJYimPPGID0M2M+Vcjr8U0cwZmqBnYQK478PPFpmZNa2T4kVOujRDB4X/ii9Cfw1Ah74n7UNCzxTFF2lTl4SMiuKNP0WpnvNjFirOTaT0B07IF5f9qBlpuXH9E=,iv:0DlFt9bEiJobSCyXv8ECNYDOrx6NybyCALQFNgzGG8Y=,tag:KAeCIXvysxB57cok+RgNGQ==,type:str]
    pgp: []
    encrypted_regex: ^(gerrit.config|routing_key|DATABASE_URL|SMTP_PASSWORD|SECRET_KEY_BASE|admin_password|extraCommands|key|clickhouseDatabaseURL|databaseURL|client_id|client_secret|secret_key_base|otp_secret|private_key|public_key|primaryKey|deterministicKey|keyDerivationSalt|token|clientId|secretKey|installationId|installationKey|uriOverride|adminToken.value|password.value|sql_password|erlangCookie|AUTHENTICATION_PASSWORD|ROOM_API_SECRET_KEY|adminPassword|configPassword|adminUser|configUser|MAIL_PASSWORD|APP_KEY|api_key|api_secret|keys|livekit_key|livekit_secret|secret_key|admin_pass|admin_email|mariadbPassword|mariadbRootPassword|privateKey|data|stringData|PASSWD|password|pass|postgresPassword|postgresqlPassword|redminePassword|smtpPassword|registration_shared_secret|shared_secret|secret|admin_token|integrationKey|rootPassword)$
    version: 3.9.1
