apiVersion: helm.toolkit.fluxcd.io/v2beta1
kind: HelmRelease
metadata:
    name: forgejo
    namespace: forgejo
spec:
    releaseName: forgejo
    chart:
        spec:
            #chart: forgejo
            chart: ./
            sourceRef:
                #kind: HelmRepository
                kind: GitRepository
                name: forgejo-git
    interval: 50m
    timeout: 25m
    install:
        timeout: 25m
        remediation:
            retries: 3
    values:
        image:
            # Codeberg.org was down.
            registry: docker.io
            repository: mtrnord/forgejo
            # Overrides the image tag whose default is the chart appVersion.
            tag: "1.20"
        containerSecurityContext:
            capabilities:
                add:
                    - SYS_CHROOT
        signing:
            enabled: true
            privateKey: ENC[AES256_GCM,data:gGN3YV0f5syjZ2GTNjtpLsd5kV0UfqjAHS98xut2lVLz1nlj4CMgdFZPc/kBK0qmjrz6vam7jt4VBhBh8wwuxZWYwCqRvaTrTjmu0b9zHwOripezC6Iq4xZOHATIv9kDHYaFrdv1J68TK+/U/epI1av2iTRPs103q8AKpKBKSShbqkh0e/Cc25g4cie54OcMOYF22ZR+5QQjcAu61fozhib6i9lD9fatHv7KUG2hTex4NcuYkyJiAcJOcC/EuSV/0BvFPHAstPNG17/fraSlyBrrPY8jbLuLvkli9QQZrNha0IDVrkcvVQxZtmfm9If9Zi8HnI9YZfw9XgOAGYm6C3wWQfduk55DFjUOJN4yP4I2A6rKx5RBuKKD9D5bnykycZfLpKPjS8Dc1Pw8QP9/0XbPcYyLqPncDHNJ1OqW+ughrTy0nWpCRaguSnta9i4AAIntHN+OPq0i8zHOY9Bu/HU5yTp+EZxEHnXhGW3I+gpN23ZmyRxkx3ZfYTjOdB9+msmup1VVTXuwC4Rav/iiTP5pwvj0hRSD41WCET3mrKK7wWu4TPLnyF/gVuoaL5mK0nxZPaLkWixMazNznqyFxdMdVHojKoTj5L0BYZZhoPE6mqTINjwYfXZ++C58VVbQJs/3unth4sAtNwAhqHjb/TrGqRrkcl9rpATzZLuov4tiOM+gAiW3Bd/KzNlS5B0NgKSuD9emrovLopdIN2OiMzVBSe7cA6axpWSshaR32K9t5ykhFdMXt5UbkGf1QldHo2B8+IdDKd56yZBdIwL98JrkZvIFX3k10Ie3qmYDfqoaVXx7AOs5GzFVebkuessUyjMvk95PEtPdrdHsL7QZQzHbt9ff7t+zW0tlVJTVhx9aHP+oimlx29GWOB/iVMlvMQcK/ORETFEI78bOdRp99kzv9Ca53RUpdQHuy46zoJV49ykBOBjXhRpLc3Vqh4lSSqtMZQjYm6xS5b1toZuSjAWqSFuXUc9BAps1FoxzctATf48phhGhzg==,iv:8xA8Dfx0RFeDFXPUlB8q4bRMSgvDsJp3Rb8UjdK4HHA=,tag:dPG9V3J+U8Y1mwqyenqNDQ==,type:str]
        memcached:
            enabled: true
        persistence:
            enabled: true
            size: 50Gi
        ingress:
            enabled: true
            annotations:
                cert-manager.io/cluster-issuer: letsencrypt-dns
            hosts:
                - host: git.nordgedanken.dev
                  paths:
                    - path: /
                      pathType: Prefix
            tls:
                - secretName: git.nordgedanken.dev-tls
                  hosts:
                    - git.nordgedanken.dev
        gitea:
            oauth:
                - name: keycloak
                  provider: openidConnect
                  key: gitea
                  secret: ENC[AES256_GCM,data:QfNNEX17h6VhjA5Gh2Up89CsytS7+8ZzS4D2YBczHOc=,iv:hYoYcIA02qjib335xp46kFuCW3F99sZ3qo5kFULXHS8=,tag:N8rTl3hGJXOCPbzIVsFCPA==,type:str]
                  autoDiscoverUrl: https://keycloak.midnightthoughts.space/realms/Gitea/.well-known/openid-configuration
            admin:
                username: gitea_admin
                password: ENC[AES256_GCM,data:6mI2vU5wN/lATIoz/z8+zJq+Tz83YvW9LiGssSWaM/oOdX23RrG+lrPQOsF7JcPe8Z0mxOuzYo5gu8TCyaf+aA==,iv:mh5VFxBIsWI4ElG00S6x38MpAEdb7ASJ0lZHqipK7Nw=,tag:N9JwoD7ShEDyhP1pPlUU7w==,type:str]
                email: ops@nordgedanken.dev
            metrics:
                enabled: true
                serviceMonitor:
                    enabled: true
            config:
                actions:
                    ENABLED: true
                    DEFAULT_ACTIONS_URL: https://git.nordgedanken.dev
                indexer:
                    ISSUE_INDEXER_TYPE: bleve
                    REPO_INDEXER_ENABLED: true
                repository:
                    MAX_CREATION_LIMIT: 0
                    DISABLE_HTTP_GIT: false
                service:
                    DISABLE_REGISTRATION: true
                    ALLOW_ONLY_EXTERNAL_REGISTRATION: true
                    DEFAULT_KEEP_EMAIL_PRIVATE: true
                oauth2_client:
                    ENABLE_AUTO_REGISTRATION: true
                server:
                    ROOT_URL: https://git.nordgedanken.dev
                    SSH_PORT: 22
                    LFS_START_SERVER: true
                    START_SSH_SERVER: false
                federation:
                    ENABLED: true
                mailer:
                    ENABLED: true
                    FROM: ops@nordgedanken.dev
                    SMTP_ADDR: mail.nordgedanken.dev
                    SMTP_PORT: 465
                    PROTOCOL: smtps
                    USER: ops@nordgedanken.dev
                    PASSWD: ENC[AES256_GCM,data:rlxYS1berFV/,iv:mwqPFcXm2ArRq75azO68SVyIfsqYJXd9x1tZxWpdgUY=,tag:2Fbi7lYkqAuUWC6R6Ovafg==,type:str]
        postgresql:
            enabled: true
            global:
                postgresql:
                    postgresqlDatabase: gitea
                    postgresqlUsername: gitea
                    postgresqlPassword: ENC[AES256_GCM,data:ctUJLnd16rRiCUookf5tdAbffII03AAGbyP/iPIjqOQyGJ6JRflc5NEbaV3/50WZgXAYt6p0kH1+to3fNIOiHA==,iv:KFKA1z6ccIoRGYt2EvQJZpPa/ATojg73zgBEKRJMu5o=,tag:HeYRXY94vJ7maerPzrw5qg==,type:str]
                    servicePort: 5432
            persistence:
                enabled: true
                size: 25Gi
sops:
    kms: []
    gcp_kms: []
    azure_kv: []
    hc_vault: []
    age:
        - recipient: age1esjyg2qfy49awv0ptkzvpk425adczjr38m37w2mmcahzc4p8n54sll2nzh
          enc: |
            -----BEGIN AGE ENCRYPTED FILE-----
            YWdlLWVuY3J5cHRpb24ub3JnL3YxCi0+IFgyNTUxOSAydE51dlczQ2kvWEczL0lZ
            amVQbW5xUGtIVlpzdXA0UTJ5Y09qbzFsN0ZRCjdGbHNtZlphZE9VQnJhaitkOGJ5
            NDFOT1UyR3NHZVlub2RSa3ZCZ3Q3ZWsKLS0tIEpRbG5VTzh5YUNmQ3ZxZ3lDYis2
            enZvT2xGU055MEhpbHN0U0hzVWRTWUEKIKZIchWfWH6DxMX9vqmtDMrMA+qJl75I
            pqkwhCp/HBVuXas2Jgxsx104fcoouNJJmmxjaGc5jvaBBxiMQRj4jw==
            -----END AGE ENCRYPTED FILE-----
    lastmodified: "2023-08-10T20:05:15Z"
    mac: ENC[AES256_GCM,data:u1zm81VmcEnl0C7FFCUcAJlqefP/+qYYLzDtHOqiTiz8XR3UMDPf+TUArJyOeXnIVar8LSyTk065GoIelg5/9k/6sBh9yRpSdUelZMwZ8ih//R3JB32+N5nYZsWffb0gCyMAdvmljrfK78hmpYKQCsi7FNWFppsYDSTwsmN7ql0=,iv:LSoDv7bBGtmCbt8fG55VUz2b/s87J9q+Ywl9Cm1Eztw=,tag://B9cZsyqK+q//3M2DMNVQ==,type:str]
    pgp: []
    encrypted_regex: ^(privateKey|data|stringData|PASSWD|password|pass|postgresPassword|postgresqlPassword|redminePassword|smtpPassword|registration_shared_secret|shared_secret|secret)$
    version: 3.7.3
