apiVersion: helm.toolkit.fluxcd.io/v2beta1
kind: HelmRelease
metadata:
    name: forgejo
    namespace: forgejo
spec:
    releaseName: forgejo
    chart:
        spec:
            #chart: forgejo
            chart: ./
            sourceRef:
                #kind: HelmRepository
                kind: GitRepository
                name: forgejo-git
    interval: 50m
    timeout: 25m
    install:
        timeout: 25m
        remediation:
            retries: 3
    values:
        containerSecurityContext:
            capabilities:
                add:
                    - SYS_CHROOT
        signing:
            enabled: true
            privateKey: ENC[AES256_GCM,data:rDrBOrXCq3mQM1EZY2+AEG+++srJrp2QfMKM/e52pmncq+DlacuskiPdRfsga7wT1rO13dXyhf3TWipmaBP81XSsdKox9zGkNvUMicb+5p2jH4Rfsh7kKFm8lE1vW6FG+DCeW1O+qDuIP2MR1XgM9Xt7EYzMlkjMGZk+1aOmCypsNc2RefZoZejPOs6ba8jH4nF0lTEr23FLYaki86DLFwHXME9bCvWInA3A+wcSfyPfJb2F3NfCP341lQAUo833/0eEv44A6xVL+V1Pl72SKxsCiAP7VjAu1dz+UdEb23+VE8GaaKQZK0dhGUJxXs9z/th2I1EYobfyXIu387nHZTvwFvRjn4txIP5hEDOS8OP2JTNjTrQm5irfthgPfCYgKnj5lq/KkbLumgNupIYfNXRSkARb+QHhMCFFi8Qz95XiYkbwofqgCoXjsGcl7WoxlkX4jXWU50+l9aUxkAW6s29O1qL7jLJR8fGyehRkAbmp437paKGg0213vHzGE20dbby9Re2aV/SxJDaaIIMvWIBfvOZK/sZIxu7yNTr3GGjdnmrUXdNYnORnQox8CWCP6UDnv4JQbDlWrOqQrp/ZIIoi2pzgbTDLTJi9qdkB0PNCUos2eD5v44ZbsvvwTXMbFq2CU+iHlEs7iX5RKA038dxWy73aEHYJE1pDKvpF1waLRtTDOQ9BG8z0W6WYOdOJyfX/mrYXgRLnQMs2cbXF4hhcB1MUfuHP2KJKTr9UTPrNHkhFn8/XNIQoThy8aMX61/yHGjV9i8HA+Ca+JK9ILILedCe4nIflMZ3wOchG2yzk7mUjny2QMxxeH/KU5YZWTIFJDSKxcSSWVwE9i0LampK42Y8IZlGMgFVVd/gFesSNbOoiKAdIJxRf5HL7O4LwgTqB0HnKybkEsn0829NllOTIfMUkILTPghWLCk0Ic35WGMeLzhQUMBPV08CLokcMr1I1A8Br9nqnqA15it2pQNlWYJXq1bU1g0poWv6mNizeTnB8KCQ=,iv:oej9MjdcXln6N3yhntcTNtW3aG5dktTeBNIR9FfDv44=,tag:BDk4bXU+/HybFLkRNPE2GA==,type:str]
        memcached:
            enabled: true
        persistence:
            enabled: true
            existingClaim: data-gitea-0
            size: 50Gi
        ingress:
            enabled: true
            annotations:
                cert-manager.io/cluster-issuer: letsencrypt-dns
            hosts:
                - host: git.nordgedanken.dev
                  paths:
                    - path: /
                      pathType: Prefix
            tls:
                - secretName: git.nordgedanken.dev-tls
                  hosts:
                    - git.nordgedanken.dev
        gitea:
            oauth:
                - name: keycloak
                  provider: openidConnect
                  key: gitea
                  secret: ENC[AES256_GCM,data:MXF2TJoYpePZlrH0/VExse/vCJrkOmrStIoomhLFQPU=,iv:9s1rpsRkXvg0Fn8bVF6uUG9N8WsrrudelBOLc1tED5g=,tag:bd12HytbKTxWv4HzFg1P9w==,type:str]
                  autoDiscoverUrl: https://keycloak.midnightthoughts.space/realms/Gitea/.well-known/openid-configuration
            admin:
                username: gitea_admin
                password: ENC[AES256_GCM,data:zhscb+gkicOiYhNo8EK5NoPM5T7hPS4BzV6p6NNS4PaX1L3aAxZilgd1lUyBmwdF8vfaZ1VBovIjv8ewB5Oc+w==,iv:bXnCM2Ev80lllJTG77w/OLFJeXP6YWHVH90zY3mmKSg=,tag:L7bOhT0NK9ZDzUDG9iDIcA==,type:str]
                email: ops@nordgedanken.dev
            metrics:
                enabled: true
                serviceMonitor:
                    enabled: true
            config:
                actions:
                    ENABLED: true
                    DEFAULT_ACTIONS_URL: https://git.nordgedanken.dev
                indexer:
                    ISSUE_INDEXER_TYPE: bleve
                    REPO_INDEXER_ENABLED: true
                repository:
                    MAX_CREATION_LIMIT: 0
                    DISABLE_HTTP_GIT: false
                service:
                    DISABLE_REGISTRATION: true
                    ALLOW_ONLY_EXTERNAL_REGISTRATION: true
                    DEFAULT_KEEP_EMAIL_PRIVATE: true
                oauth2_client:
                    ENABLE_AUTO_REGISTRATION: true
                server:
                    ROOT_URL: https://git.nordgedanken.dev
                    SSH_PORT: 22
                    LFS_START_SERVER: true
                    START_SSH_SERVER: false
                federation:
                    ENABLED: true
                mailer:
                    ENABLED: true
                    FROM: ops@nordgedanken.dev
                    SMTP_ADDR: mail.nordgedanken.dev
                    SMTP_PORT: 465
                    PROTOCOL: smtps
                    USER: ops@nordgedanken.dev
                    PASSWD: ENC[AES256_GCM,data:o7SlgAzDcSyq,iv:0PZi0D3vcc0HJL5j8pOJgByD/efC1GHe8U5dFNwtbWY=,tag:XqTtXeZJWU5V2Gj7kJARbQ==,type:str]
        postgresql:
            enabled: true
            global:
                postgresql:
                    postgresqlDatabase: gitea
                    postgresqlUsername: gitea
                    postgresqlPassword: ENC[AES256_GCM,data:NkrLlEX6P8YwJxOn9JoZSOBmZ6Hm+R+fY5ZZPTLi9SdQEvElcD1yd/RDqStmKozSnJVuqDXCgRbt+lAGt0o4bQ==,iv:ZSD8eTKXztc82/v7G7aier/GCpe6fhh4lgIXmdjfcCY=,tag:9tLLrBw9gio7DjWD269NRA==,type:str]
                    servicePort: 5432
            persistence:
                enabled: true
                existingClaim: data-gitea-postgresql-0
                size: 25Gi
sops:
    kms: []
    gcp_kms: []
    azure_kv: []
    hc_vault: []
    age:
        - recipient: age1esjyg2qfy49awv0ptkzvpk425adczjr38m37w2mmcahzc4p8n54sll2nzh
          enc: |
            -----BEGIN AGE ENCRYPTED FILE-----
            YWdlLWVuY3J5cHRpb24ub3JnL3YxCi0+IFgyNTUxOSBuRGJhb1BwWlpMcUVBZzNO
            WEpyM0tRZHhyOFJXeXM4OEhTMUFMdFdsUTJNCjJpcnN4QWNKUEpndVB4WVlxKzQ5
            YmJxZHlGUUhvYTA5WmtpTktDRHl6cnMKLS0tIENLNHB6OW9KTk1MRDd4UGNKRnZ6
            MzJiaUFuYXB2dTdLN3pPL3Z4NU5zNkUKnyEZUpU1jpkHo+rbir4sIo4pu2F5dsUS
            3FF7yMG6wM+Q91z6/23EFPUHikzcyP4Ex35ALRi7i2q1KnPnCIHPMA==
            -----END AGE ENCRYPTED FILE-----
    lastmodified: "2023-08-10T19:05:51Z"
    mac: ENC[AES256_GCM,data:bRqPqXrpQmG6+MK8g+fkc+ndwIw9XRpZeRLgYkXnNJhi0swmjwibVYq8DN6cnGlrwsMvk9/6EYFIzyAq93VTnlANfguMryowjV4UxRdl2sH8G/CSUFSdJtTplJwY0NQ1NXyY/MOl7El52UIu+UvaJFRmM86lbRZlt5nXJCbkKRI=,iv:vSMU0ycU3IinRDWzFpgBv/kiOSxRmmRDtVi7mFESa0o=,tag:O4aeoAaQe7BKjsJ7TtTvTg==,type:str]
    pgp: []
    encrypted_regex: ^(privateKey|data|stringData|PASSWD|password|pass|postgresPassword|postgresqlPassword|redminePassword|smtpPassword|registration_shared_secret|shared_secret|secret)$
    version: 3.7.3
