apiVersion: helm.toolkit.fluxcd.io/v2beta1
kind: HelmRelease
metadata:
    name: forgejo
    namespace: forgejo
spec:
    releaseName: forgejo
    chart:
        spec:
            chart: forgejo
            sourceRef:
                kind: HelmRepository
                name: forgejo
    interval: 50m
    timeout: 25m
    install:
        timeout: 25m
        remediation:
            retries: 3
    values:
        # image:
        #     # Codeberg.org was down.
        #     registry: docker.io
        #     repository: mtrnord/forgejo
        #     # Overrides the image tag whose default is the chart appVersion.
        #     tag: "1.20"
        containerSecurityContext:
            capabilities:
                add:
                    - SYS_CHROOT
        signing:
            enabled: true
            privateKey: ENC[AES256_GCM,data:mlxTEeQktLfnhl6JlzL5LE/jKb7kQbFZx/v7xr3bDO1JrEWl5tIVWyUfQ4YE9zyhDEs8YX/+3leBy0rwzPlokvNiLCRKVxdNvgYW1f2HZAxOeTTOVPSIhkswXdj2ZIHH5uPH7Sl9hzecxYZVKBOJ5+0Nz1OsGKtBaeqrB1Rmp3bNY2ag8Q+HKZ5bFfCi5KEdNX+L64ZJR/OcO/Wc9mci0LZe79nRzwIf6P1W3RryPlv13O+Qa1sSuix/8ri3bHqsiOJl41RL/4d73g8UIVODnqocZBY+rCMsgoygwFwjjTPFp9yQDJVxVNlWNOF4JEkzwTK7jPMpNhhHrx4W+lhbqLdRyJooECxuu0WbwKkvmpDRHsItTgEj+BqXWwKqFfbDGGV7M2yo0dpCagW5sP2jcysKVE1b+Aue4ewIb26spTVtquZBT2Yw9MtFa0csGnB5kfANM0IEEEcJW2jGLUpSXiPqDsufiR2Nwkkvz+NgS5bdXGhEQlf52kuMu67hXTKP/iBxgNdpu/wGfqfyKspdikSJkQPzGoDV6SFAgaqqzHL7lNTInRUQWqfx+l1rQATApuqMYknNu0jH1WwEr05c2dAWhag4c+F43aLPkweNsT26NEoR2mKrGTleBhwSyZiO7g54vbA3ZBGPt6wiBdj/7iYN+uKPt/fAQatYPUK1mU/zu5+be4qsSxf8uVmmEVlPfBPNIGiNgL3VX1IBb5H92LFjQIbtggra5ITLEGAhzZUMx4oRsVUDrQ66o1d0ipCAY05CsZM3oXJND1nwUauaqyb/f3BGSgp/dh+qKb9EvS5QntQ8uM017Hcgs0jjjFF0NIIq5hQA+Q5k5LunOs9gmf5FHS3OMtwiSI0haFwKfpzobsp1AcD20yRuEwVabz9WIvAfhnD4QKku5mlS6WbP6WxilNBAoqBrBu+kL6DNjNQv+sCT1IneW/BNKnQaJlDDe3irIs4M6AgU3jjTXwYCshJUJrB4IvICXl9+x5fmmuyWZChPGoP1/g==,iv:b7K3JAlkd6nnraRMLslq2CgqN0l2N/W/J64A/z7hpFk=,tag:o8LmIQNtu6VZvIQTk8MFnw==,type:str]
        memcached:
            enabled: true
        persistence:
            enabled: true
            size: 50Gi
        ingress:
            enabled: true
            annotations:
                cert-manager.io/cluster-issuer: letsencrypt-dns
            hosts:
                - host: git.nordgedanken.dev
                  paths:
                      - path: /
                        pathType: Prefix
            tls:
                - secretName: git.nordgedanken.dev-tls
                  hosts:
                      - git.nordgedanken.dev
        gitea:
            oauth:
                - name: keycloak
                  provider: openidConnect
                  key: gitea
                  secret: ENC[AES256_GCM,data:ZHMQtFBdRsHcmmtjeTPOjC0s1Imh2FGslF4VbnSgTAE=,iv:InBrhwxrc8VhcLUk8KKLLyYJqFuyWu6Id2URuqiQwc4=,tag:0Eqqetie7reWzfwvoWbQQg==,type:str]
                  autoDiscoverUrl: https://keycloak.midnightthoughts.space/realms/Gitea/.well-known/openid-configuration
            admin:
                username: gitea_admin
                password: ENC[AES256_GCM,data:jqtfKY3/CsiiOYQbOrjfXfX2sEQSSbjRXRCjwf92J5azdWvAZBoKvi8BaUmI5kqpTKdqFkLLR+vEoJ9/h6JRJQ==,iv:Vq2BfWRepTMZQrtJi3r+ve0KJytqUhj9TmtznazzNn8=,tag:Qq6xCEbFHvhGHhwAEutMig==,type:str]
                email: ops@nordgedanken.dev
            metrics:
                enabled: true
                serviceMonitor:
                    enabled: true
            config:
                actions:
                    ENABLED: true
                    DEFAULT_ACTIONS_URL: https://git.nordgedanken.dev
                indexer:
                    ISSUE_INDEXER_TYPE: bleve
                    REPO_INDEXER_ENABLED: true
                repository:
                    MAX_CREATION_LIMIT: 0
                    DISABLE_HTTP_GIT: false
                service:
                    DISABLE_REGISTRATION: true
                    ALLOW_ONLY_EXTERNAL_REGISTRATION: true
                    DEFAULT_KEEP_EMAIL_PRIVATE: true
                oauth2_client:
                    ENABLE_AUTO_REGISTRATION: true
                server:
                    ROOT_URL: https://git.nordgedanken.dev
                    SSH_PORT: 2222
                    LFS_START_SERVER: true
                    START_SSH_SERVER: false
                federation:
                    ENABLED: true
                mailer:
                    ENABLED: true
                    FROM: ops@nordgedanken.dev
                    SMTP_ADDR: mail.nordgedanken.dev
                    SMTP_PORT: 465
                    PROTOCOL: smtps
                    USER: ops@nordgedanken.dev
                    PASSWD: ENC[AES256_GCM,data:+1ps0UDmh80R,iv:T7fR+KPT0iK74/0zEYObo/SjfsaACtHSzzC2IHfv7BM=,tag:yJUqDvblNLeaMYwRLEMuXA==,type:str]
        postgresql:
            image:
                registry: docker.io
                repository: bitnami/postgresql
                tag: 11.11.0-debian-10-r62
            enabled: true
            global:
                postgresql: null
                auth:
                    password: ENC[AES256_GCM,data:SP7xUOCW9+Gi2ODSkKLbz6QR5VKh0Rwh8ZGjbjFzbOCEmdUSB4w1YxujqqegGJbF7XtV72qKm7jTujEWAzUzMw==,iv:iQlATCPLjm6JIHRFRhjRJ4ZPUO1TlM7Kz0sKHhlEF3c=,tag:g1jgn+wP4jqtq2G966ZpJw==,type:str]
                    database: gitea
                    username: gitea
            auth:
                database: gitea
                username: gitea
                postgresPassword: ENC[AES256_GCM,data:ZMZduAaedtfjTA==,iv:2OZP8QqM1KI2xRTFpkP0ZJX81Ar5TolxNU//0IoXJ3E=,tag:xVpmiSM7DB89o90Ki8kJ+Q==,type:str]
                password: ENC[AES256_GCM,data:hZPwV3BZJtO0NCRv2A46voGadU9DiWSiOwN+biHh0mwjYlPBnpsuKPvhP2rI5vVUzemlAykEJPDKr0Lk0b1AIQ==,iv:MXOAcKZg+o6zvj0zkq1wC23tWh4Scd3t+Ye11IZGzUU=,tag:UFV/tRPfeMJyfpZoBC/Pjw==,type:str]
            persistence:
                enabled: true
                size: 25Gi
sops:
    kms: []
    gcp_kms: []
    azure_kv: []
    hc_vault: []
    age:
        - recipient: age1esjyg2qfy49awv0ptkzvpk425adczjr38m37w2mmcahzc4p8n54sll2nzh
          enc: |
              -----BEGIN AGE ENCRYPTED FILE-----
              YWdlLWVuY3J5cHRpb24ub3JnL3YxCi0+IFgyNTUxOSBicWNhaWhsNjYrUGZFYi8w
              M21uTG5RVTMrS3pTeFQ2T2wwbVRQRERqeFI0CldpV3FmRG1zWS9XZVU2OTRld204
              TnExa0VTVklSRW80aXlUYkV4QjNwbXcKLS0tIEh6TDkxbWV0Rlg2d2RhTDQ3dUFP
              dldZNzlYSGk4VWxiWjRJY3ozWHA5NzAKgklAkwi3uwNc89io1Ptucrn30iHGOkD8
              mU8hT+aIExROMmBT+7hak0OiiZ2CK5mUmZE+O+Fr3X8fy8LVKp4v4w==
              -----END AGE ENCRYPTED FILE-----
    lastmodified: "2023-08-17T21:11:22Z"
    mac: ENC[AES256_GCM,data:bsCPYJUw2+HINX2wLaPb5e45bQwGwQeXIKSR8t5yaFcEFLwspJUTIgvlVcvHjbbCVnx9r4999SVKCZ9xLwy3Ztqj/qBOwD2r2GaSGpbyht8vL5qhnq8OSxImzMDuD2AO0Tka6tcosTKMr7KH8QSCC8YMa5SmeMSTGa/Hkq0SAZU=,iv:bhZHXttVzejW43RHN7LLxfXh+NVmAOs497RKiw7Ht7s=,tag:8apH+niO2mN+8pwqZUhTqw==,type:str]
    pgp: []
    encrypted_regex: ^(privateKey|data|stringData|PASSWD|password|pass|postgresPassword|postgresqlPassword|redminePassword|smtpPassword|registration_shared_secret|shared_secret|secret)$
    version: 3.7.3
