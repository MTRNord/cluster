apiVersion: helm.toolkit.fluxcd.io/v2beta1
kind: HelmRelease
metadata:
    name: forgejo
    namespace: forgejo
spec:
    releaseName: forgejo
    chart:
        spec:
            #chart: forgejo
            chart: ./
            sourceRef:
                #kind: HelmRepository
                kind: GitRepository
                name: forgejo-git
    interval: 50m
    timeout: 25m
    install:
        timeout: 25m
        remediation:
            retries: 3
    values:
        image:
            # Codeberg.org was down.
            registry: docker.io
            repository: mtrnord/forgejo
            # Overrides the image tag whose default is the chart appVersion.
            tag: "1.20"
        containerSecurityContext:
            capabilities:
                add:
                    - SYS_CHROOT
        signing:
            enabled: true
            privateKey: ENC[AES256_GCM,data:AmPd8LzXt54dLo3xToVl4YHwMH+KU9vafyNeHUigBB4Fe5l5AJJe3G96rgOpwrT98kvxAX0J2RnF1csiHul39TuWiG0lknsDuMc2zAZCJsYG8eNIIKaOZmVfXdoc+v/G5HJ7ZpqzGSvHHyZIJ4vx0hZAiZAnsay1WRCXeZwKg8HmcdDyDOBTXG1J8QXOzmsXjtI0xaMzeDjjo2Kis0qt1KEvVrylS6LtbNZca/9oPzhoBqFxM+6qQwb5DsOY89NIUmMhDI2uNpheqv629kXF1LDFJAtnPluyIwlUcNC+zdy2rtqBuDkOS9CVBqhCxODjCx+g3/e7ypRcsmSDMpKB56er1WPqWtYGv5r8d94Wy8IXcjBEm66iQxcobSwb2ayMGSDrGNFmraLocGWXF6xF/yzw6tQruiRpEc5W8exQj5c6beOyISpxXNTqQcA4WWy1g9kMblnaAPhxF8iSdhnID8v810Hi28kAqLtHXOMpU8ZulTwJtpsMTc7knIUznv2NzFqmrHqlAMAtNvD93krGMhCNNcSc3IY9otfew7Nh4PJxbQSH7iSv04PK4oCuD1+Q+PPItTPTi8Upfkhm9Zbz1V/GiZ176rRzAbEDYdqh27bdqmTph53047EPgojHqEhmdRSaqDkLbjS83zUyCbLVi3Jrt3j5ayF/OPzdAVpXIgDhC4SQNXV/rcI72cc2pTJzSxWCAQM+tVSJdZasju3NiiT8B867QlHIw6K8+HU26Ft1dea0LI9sp/xcjSXiAt53dKc0n9gVJrtEKoTLZM/cXCERl/pjFq6fAeToLCq7Jkn35kdCVSjCMiHU6QihALpZkaopMx9jSpbHHU1Ao3LWsE/g4EA0gXBRR70cvuDDwBbHZnmCTfDzlNyAEJY+lU5NUOoPcRhb9Jp3ZPSL/CYzD4l8wwV5Rml9i5MSdGLrSDgGuyDh93R1wfzBGqJ4R9TW4gfcvAP91MjltwHixTyPw1F0VWkLNWkADt5HeE3nLMHA8skRVxPjwQ==,iv:RhrT7iX8qPpnhqkFYUHr7dBx2K+VBBf84Gv4PWZgBAg=,tag:052NwVS4DqcjXDa2TrPzhA==,type:str]
        memcached:
            enabled: true
        persistence:
            enabled: true
            size: 50Gi
        ingress:
            enabled: true
            annotations:
                cert-manager.io/cluster-issuer: letsencrypt-dns
            hosts:
                - host: git.nordgedanken.dev
                  paths:
                    - path: /
                      pathType: Prefix
            tls:
                - secretName: git.nordgedanken.dev-tls
                  hosts:
                    - git.nordgedanken.dev
        gitea:
            oauth:
                - name: keycloak
                  provider: openidConnect
                  key: gitea
                  secret: ENC[AES256_GCM,data:FhVqVtYg9VUY1Sgslq9PixqJJEtZS3oe+CMhLskuqNQ=,iv:vmUojaEO33n689COuYGrozbV4KHer84FzG8gbYus5KU=,tag:iEvc8Ilb0+cWlMX0Eokx2Q==,type:str]
                  autoDiscoverUrl: https://keycloak.midnightthoughts.space/realms/Gitea/.well-known/openid-configuration
            admin:
                username: gitea_admin
                password: ENC[AES256_GCM,data:/ajVOvxyVGyVsUW9AF00PG7Q4puInj4hgDGwnTIYSKqTReggcKShLOvUT2D6epGeppad/nR0jJduT17G0Qs2Sg==,iv:qqfa+0dTJ2yzDBPBBNgE5QUHvT1eWjsCusTqaCv1M/o=,tag:W+KW9ZhRMyHh0bVr1G+MhQ==,type:str]
                email: ops@nordgedanken.dev
            metrics:
                enabled: true
                serviceMonitor:
                    enabled: true
            config:
                actions:
                    ENABLED: true
                    DEFAULT_ACTIONS_URL: https://git.nordgedanken.dev
                indexer:
                    ISSUE_INDEXER_TYPE: bleve
                    REPO_INDEXER_ENABLED: true
                repository:
                    MAX_CREATION_LIMIT: 0
                    DISABLE_HTTP_GIT: false
                service:
                    DISABLE_REGISTRATION: true
                    ALLOW_ONLY_EXTERNAL_REGISTRATION: true
                    DEFAULT_KEEP_EMAIL_PRIVATE: true
                oauth2_client:
                    ENABLE_AUTO_REGISTRATION: true
                server:
                    ROOT_URL: https://git.nordgedanken.dev
                    SSH_PORT: 2222
                    LFS_START_SERVER: true
                    START_SSH_SERVER: false
                federation:
                    ENABLED: true
                mailer:
                    ENABLED: true
                    FROM: ops@nordgedanken.dev
                    SMTP_ADDR: mail.nordgedanken.dev
                    SMTP_PORT: 465
                    PROTOCOL: smtps
                    USER: ops@nordgedanken.dev
                    PASSWD: ENC[AES256_GCM,data:tBgM+Ykh/5ma,iv:thc/wggIbmgfC611gpfZkFGdv99klR7vUG0AzI67C/U=,tag:jf5bz/sxe3Boo0O20UHvIg==,type:str]
        postgresql:
            image:
                registry: docker.io
                repository: bitnami/postgresql
                tag: 11.11.0-debian-10-r62
            enabled: true
            global:
                postgresql: null
                auth:
                    password: ENC[AES256_GCM,data:XLEmYEpvXVemkoKXtkZqvqf+Sq83FrmXCCo7zHFwv7OFR3rBxbCKDnEvM2LSz4WGScgASMlf7da2/EPKB4M8QQ==,iv:uV5Rv+9sBG+2WfNtmQwLZg//8viUJQWL/A4jmWJyJM4=,tag:bflOIJMeFx2I0ANWraKaFg==,type:str]
                    database: gitea
                    username: gitea
            auth:
                database: gitea
                username: gitea
                postgresPassword: ENC[AES256_GCM,data:A+j0FnFnURubNA==,iv:OCzA3mIpEEf5vT6lpVoQvnsjG0UDl98yQAzb+PPN09s=,tag:fd9vNIXK80uRJfjwoAR4pg==,type:str]
                password: ENC[AES256_GCM,data:13sscF446Fo3E7QLLAby7oTHhh3ki+uNgP2CH9wBDsBk6QDFfzoFb4m03E2jLMaIzVzASDJKHCTYDGgttpAMbw==,iv:/n+ulNeQQSEht25EgjoY+qWZ7tSJd0sfU54EbJYQNDE=,tag:WPcb0F31lOKBWjbAYVFEvw==,type:str]
            persistence:
                enabled: true
                size: 25Gi
sops:
    kms: []
    gcp_kms: []
    azure_kv: []
    hc_vault: []
    age:
        - recipient: age1esjyg2qfy49awv0ptkzvpk425adczjr38m37w2mmcahzc4p8n54sll2nzh
          enc: |
            -----BEGIN AGE ENCRYPTED FILE-----
            YWdlLWVuY3J5cHRpb24ub3JnL3YxCi0+IFgyNTUxOSA3dWZtcHJCTmdSNW1qRCsy
            WkZqRWhIS3lhWVdQaGFYQ2VuNmQxWUV2VW13CmovSEFjSnJST01ET0ZQU0YvUFk0
            VnNNVkJjaUlURENRekFhbTJ2SEMvN3MKLS0tIFlvdGhkNHJSNHNnY1VldDU0WXRy
            TEtaYkxJaEhJNjZaalpUZFovc1VvQUUKhF2wTfcnFbKSOnidndD7DM8h8KzJmXYZ
            WttbHV3To/mn6lvbaRBmzvjdt/UAQgqvJSVVV0CDCRFoCUzDQt2Xdg==
            -----END AGE ENCRYPTED FILE-----
    lastmodified: "2023-08-10T20:59:49Z"
    mac: ENC[AES256_GCM,data:QYT6WPqp7L8JNZYtVMcYw5C5CFsAl2gkXRyRyedi3yV4PnBLs++Xr9nm8586JuttTTF3ytK7MZSB4Gve6F42+sgn1ms/YtNheteaBqZ8abehVOzobSSZbQEZq/XdBsCoZ8E8V3PazHp3lG9pzwH1J6dM4SD6GtirsWgGcTl91dM=,iv:7eQKX8KO9I/bhif1m7oQ9KqN4YLvuwJRo0zwa982IxA=,tag:mjaAFNIJo7pha8WjtBijiA==,type:str]
    pgp: []
    encrypted_regex: ^(privateKey|data|stringData|PASSWD|password|pass|postgresPassword|postgresqlPassword|redminePassword|smtpPassword|registration_shared_secret|shared_secret|secret)$
    version: 3.7.3
