apiVersion: helm.toolkit.fluxcd.io/v2beta1
kind: HelmRelease
metadata:
    name: forgejo
    namespace: forgejo
spec:
    releaseName: forgejo
    chart:
        spec:
            #chart: forgejo
            chart: ./
            sourceRef:
                #kind: HelmRepository
                kind: GitRepository
                name: forgejo-git
    interval: 50m
    timeout: 25m
    install:
        timeout: 25m
        remediation:
            retries: 3
    values:
        image:
            # Codeberg.org was down.
            registry: docker.io
            repository: mtrnord/forgejo
            # Overrides the image tag whose default is the chart appVersion.
            tag: "1.20"
        containerSecurityContext:
            capabilities:
                add:
                    - SYS_CHROOT
        signing:
            enabled: true
            privateKey: ENC[AES256_GCM,data:YCjvRIgohsx4JbSnWAacc7lszMSHuSOnACYvRiPz6+Hd+4LII8D/PmCNO0Fgn9n5g/Aod/qrhJqB+NnIimPbXc1fWvbzz1jwWlKh5eaWZVTSSJMz6wT72ov2U1zxhWAOb3R/vRS94E0fvvqVRkiCvVsmvNWHRXVrrRSx6mTybvKr02nEyJkUTFIXz6T61cKDTXbtAWao7A6OEo1bk/WLDCkVhjaN4OaBjvncDWy5tAvWtSEzhISVFHRvTGHVREtFIb85M4Cn1QImXx9+DCgbQPAnNCUTjrYNrmghKPiDhz6Jl4ZJ4IloHszH6Iko+nKuSHYxshj4UpY4L/8ek+2pHDn/kOgWoH54j8gQvkUx13khGINeFrtQWB1O74eg+hYsYesHnT/V2nWEIg0LnhSXem0iBHbmc5Rj189lDAmnwhqcX6DmKiXZgIGj60JA4aCRH7szv1+oQSpBo01kt2a/1e0w6Tcd7sqTp1x2hEY0Ge+y/WId3X8zz4Eb0it14zji4dMNE2nu4GPfFf4pNekZERSogaEjO/sllF8RyoRUzE6rlaHHPFdjrKLq4PBkkhZ2lKLd6dNSb7Yv3aQ6WjPHVA9O3DJxO596tNN/hLoqDIcGdLs+yC4Oamo1j9+Yth9f1CXH5BBVBTs3uRhiyfaFE9do9Fs7z0hFIFYY8egLW/AhhJnNuvuRnxS/bq8HvTYD2TPsKZFptEEaT3WCe5toFYsOllPqxpLa1XIndi+KpOg6gBOulGV6puRDihu2VmHQUW9PufRkYw2Kl13w7RQsMCdCzuZ5LoFNJWMEJm/Z33mThUCM/NwM8ElcDJILRmFXJkrK/zF3kTT9noNi0VYptxII558MtYMh8Z0J3y5ANQHZqKzO3BMr1yaDc8pssmw4+UI3vwkI1hMmjOPRPg0NjN8CKBObIJXdxAehujqOohAFD6JzM/aidR76j8IoocqCYnUnAmRbAMqyQF/a2yqFGHHmSZN+kqEO7J0K/mRhndkJcxGh8TMstA==,iv:PEkS6oP058PfphbKr6kSJOwJjHzgUFD5YdJHlKBY4FY=,tag:Tvb53w13gJfReimCrMY6Ug==,type:str]
        memcached:
            enabled: true
        persistence:
            enabled: true
            size: 50Gi
        ingress:
            enabled: true
            annotations:
                cert-manager.io/cluster-issuer: letsencrypt-dns
            hosts:
                - host: git.nordgedanken.dev
                  paths:
                    - path: /
                      pathType: Prefix
            tls:
                - secretName: git.nordgedanken.dev-tls
                  hosts:
                    - git.nordgedanken.dev
        gitea:
            oauth:
                - name: keycloak
                  provider: openidConnect
                  key: gitea
                  secret: ENC[AES256_GCM,data:2DJ0InzGyxQV88m/KfY10p8cj/aI9UvKPrt0Xr90eHM=,iv:jb+lbFn5ySzr7K9uOCum2M+BHNgQkZvcRR92yGXru0g=,tag:s5zP2C3qns+0HYkpujP8wg==,type:str]
                  autoDiscoverUrl: https://keycloak.midnightthoughts.space/realms/Gitea/.well-known/openid-configuration
            admin:
                username: gitea_admin
                password: ENC[AES256_GCM,data:ETv6CIUqU22YsF9vYPVIbb2Ou4g1aS4IXp5PxyyDKqc8XwVeTvJsUqpg82cLh3kzscNw9KJ0YWRZMeuLJtCZaw==,iv:IBTBUIVZ12r2bPBXCSqVXHP0Z9OwF0sDtTvuEoDKx9M=,tag:dJlmTRmF4z/7EgHOBaxutQ==,type:str]
                email: ops@nordgedanken.dev
            metrics:
                enabled: true
                serviceMonitor:
                    enabled: true
            config:
                actions:
                    ENABLED: true
                    DEFAULT_ACTIONS_URL: https://git.nordgedanken.dev
                indexer:
                    ISSUE_INDEXER_TYPE: bleve
                    REPO_INDEXER_ENABLED: true
                repository:
                    MAX_CREATION_LIMIT: 0
                    DISABLE_HTTP_GIT: false
                service:
                    DISABLE_REGISTRATION: true
                    ALLOW_ONLY_EXTERNAL_REGISTRATION: true
                    DEFAULT_KEEP_EMAIL_PRIVATE: true
                oauth2_client:
                    ENABLE_AUTO_REGISTRATION: true
                server:
                    ROOT_URL: https://git.nordgedanken.dev
                    SSH_PORT: 22
                    LFS_START_SERVER: true
                    START_SSH_SERVER: false
                federation:
                    ENABLED: true
                mailer:
                    ENABLED: true
                    FROM: ops@nordgedanken.dev
                    SMTP_ADDR: mail.nordgedanken.dev
                    SMTP_PORT: 465
                    PROTOCOL: smtps
                    USER: ops@nordgedanken.dev
                    PASSWD: ENC[AES256_GCM,data:zmppITFeUvel,iv:2qUYpiOM1msEBBOF09234FiocOIdynk0418ComviWoU=,tag:0Rw8z+Bdll7iuQLuX8enFg==,type:str]
        postgresql:
            image:
                registry: docker.io
                repository: bitnami/postgresql
                tag: 11.11.0-debian-10-r62
            enabled: true
            global:
                postgresql:
                    postgresqlDatabase: gitea
                    postgresqlUsername: gitea
                    postgresqlPassword: ENC[AES256_GCM,data:3isz2cIt9cd2wAJQ8N9LwOnReH9NN8mVnjCMNZ3+eFeoIx1nRV416N+1CEKKzYdDiPYygC3BWZPXVGBTq596sA==,iv:J8RNoj8Ns2vR0hiJobB42eoe+iD50zumHjUm0GTVbCk=,tag:lMmga4D1WakVXajd2DmNAg==,type:str]
                    servicePort: 5432
            persistence:
                enabled: true
                size: 25Gi
sops:
    kms: []
    gcp_kms: []
    azure_kv: []
    hc_vault: []
    age:
        - recipient: age1esjyg2qfy49awv0ptkzvpk425adczjr38m37w2mmcahzc4p8n54sll2nzh
          enc: |
            -----BEGIN AGE ENCRYPTED FILE-----
            YWdlLWVuY3J5cHRpb24ub3JnL3YxCi0+IFgyNTUxOSB4VnlZaHVsVzMvcjBXaVNq
            MGJNMmtYb1c2c3F5T3VnOFYzTXdBL1l5RWpBCjY1YllhQWU2M1VHT3lXYXFQb1Fl
            UDk3c1VQRWhDc3Y4MGtQSlQ0N05sbVEKLS0tIHNwcTlTVldHcmVkMUkrOCtiYmZa
            MEZEbllJOExob2ZudW1iek8rSllvcmcKGUV/UkPJtHCc18oBf6X7Kfg9xhXG+NsD
            JwUjSpbBVRt5Pe7cvRqNXlYTcEC937gLjzW+Fxk6wAoATGi05sm6ag==
            -----END AGE ENCRYPTED FILE-----
    lastmodified: "2023-08-10T20:26:57Z"
    mac: ENC[AES256_GCM,data:aD5H8JXFIUVSz8ue7qJrA1C8JyiQe9oLNqm7pX6SoD8nv3w+5+vw2vTMOgWMoKtVKxik0Pcj383kNZqOj8/4WxK1Lm4n1hqW22Njo2xpoaSuSVUiWJQm9IDV3toUhLZWyl9xqiG2p6NaCZ0KzaE5kIPpLvhsi+acH1jPgxqWRTM=,iv:JRGthfZmLZvD+pWGSy+cXMyR+erInCFQ9VTvb8XxwKY=,tag:4HMQ9YDP1DP8mZivm63nYg==,type:str]
    pgp: []
    encrypted_regex: ^(privateKey|data|stringData|PASSWD|password|pass|postgresPassword|postgresqlPassword|redminePassword|smtpPassword|registration_shared_secret|shared_secret|secret)$
    version: 3.7.3
