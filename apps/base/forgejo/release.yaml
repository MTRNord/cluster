apiVersion: helm.toolkit.fluxcd.io/v2beta1
kind: HelmRelease
metadata:
    name: forgejo
    namespace: forgejo
spec:
    releaseName: forgejo
    chart:
        spec:
            #chart: forgejo
            chart: ./
            sourceRef:
                #kind: HelmRepository
                kind: GitRepository
                name: forgejo-git
    interval: 50m
    timeout: 25m
    install:
        timeout: 25m
        remediation:
            retries: 3
    values:
        image:
            # Codeberg.org was down.
            registry: docker.io
            repository: mtrnord/forgejo
            # Overrides the image tag whose default is the chart appVersion.
            tag: "1.20"
        containerSecurityContext:
            capabilities:
                add:
                    - SYS_CHROOT
        signing:
            enabled: true
            privateKey: ENC[AES256_GCM,data:GljAHipp3lJ0HSomyMYQ9/ckvUlWxiwz3HBSlrOEIoMnbGNAKzxuKW0Ju8kBZI8AWZabrQAKYvOxh7pzUemd773WNK8rz6e8uOJbhOJiN478lVjwqrJhXY3Z5+12b3zMhVR0yNLDHwjexbXFIcD6pVdShYh8nNb0DtX2ubqsCa0V9aVWg3EuCVyrjMe0L6lMuAnUEOePBuSf4U0zI7OONgKulNtVAZ5XoD2Mus9kG2XQW+PTAxgKrqIS8jXCbi7hjfVpGDNIokHfac9YjwseKUCJFa1X01HgxAE5XVZkpoI1VddVv14NC7UM9wuz4t37kg7Ja4PBEAyfP3jeJVC1lp4OgRr/apLV/R2m7ieUFkQqIKSEeXbLV8n1PHghXUXyR2i6bs4H3I90RIjSqUgmFhArDMasWv2dWX22R6fiLTvUWI/gx1FN/0CuANr12tzGVCDO5dS6XfC2m5nR+gWfsEN7KPYiyXdWxPnuzAcuUI+/P2dYCvS9n+PXXPLc2RGWGHZlPR3AaR8DnpyINyWQjKU+dcEyrb0hzC/0SthqnrgSvoylp1rGaK9tj36lk4B+60Pc0VU0nL+3oiGudTFeCUPejG1/FrAjucdHX3MjPM048BG8EPQiSukcSN035beL/2KoI4VLGOV7N+yHyhhBdg8EF907c6zsYfdgv1d/MrapyQTbkizt1RS2LUCPIyVMuhXQjKVpmmnnqVGL9b9CA+O4LI0dMe2lLn+ScDgWeVwvfMwTK4h1S5RalqgbaKlZsJ/8ZSm+4i1wY5xVFV7rMqqwLbsI1As4O7A3ONdd+tXel+fQNoCoIR7cIQNpY58zcRWfw7v7JSpVfXlMwEc9clr6BO1nOshh1p29lIODCtgQwThn/FiUX3ltPsfFUTkpsUudhXc8sP+6mInW9uwvzDLfSh8k8Nimv7WuTnDbgNSToL5wFiBVqsC29f04RAofeRZYawQKVMGnSPXH9igFQPCkDV6rCASvDPLn+pPSl9LKWVzEwFGKjg==,iv:RpR0+PgUKt7pSEZ7UV1NAw8z0R2ClU4ed4ZN/UlQkk4=,tag:V7BB66lkmw9ykRPXFfzp7g==,type:str]
        memcached:
            enabled: true
        persistence:
            enabled: true
            size: 50Gi
        ingress:
            enabled: true
            annotations:
                cert-manager.io/cluster-issuer: letsencrypt-dns
            hosts:
                - host: git.nordgedanken.dev
                  paths:
                    - path: /
                      pathType: Prefix
            tls:
                - secretName: git.nordgedanken.dev-tls
                  hosts:
                    - git.nordgedanken.dev
        gitea:
            oauth:
                - name: keycloak
                  provider: openidConnect
                  key: gitea
                  secret: ENC[AES256_GCM,data:ppIyl4ZWwr1hfLMjsQEPBAXDe7t60CctATLa0h7LO18=,iv:jQwTJQ9rEltm9Vcou7G90SlysShUNNZpZlIvSwrtwz0=,tag:bIn9QA4DpizubqWF7V4HXA==,type:str]
                  autoDiscoverUrl: https://keycloak.midnightthoughts.space/realms/Gitea/.well-known/openid-configuration
            admin:
                username: gitea_admin
                password: ENC[AES256_GCM,data:2GGPROxOtZnYKMs80SfRHg0Kxoq1kBnf8gH3YAUzs9xECjRcjTPKJa1LI8cwZ2Imi//keg1m1HRTM7HWC9+zaA==,iv:DgeZHI9BLzzfrJuhgiJ+dFrYBMGDuZJvosZPGBJeq9c=,tag:gqV/yTl4Atx06NriMovOWg==,type:str]
                email: ops@nordgedanken.dev
            metrics:
                enabled: true
                serviceMonitor:
                    enabled: true
            config:
                actions:
                    ENABLED: true
                    DEFAULT_ACTIONS_URL: https://git.nordgedanken.dev
                indexer:
                    ISSUE_INDEXER_TYPE: bleve
                    REPO_INDEXER_ENABLED: true
                repository:
                    MAX_CREATION_LIMIT: 0
                    DISABLE_HTTP_GIT: false
                service:
                    DISABLE_REGISTRATION: true
                    ALLOW_ONLY_EXTERNAL_REGISTRATION: true
                    DEFAULT_KEEP_EMAIL_PRIVATE: true
                oauth2_client:
                    ENABLE_AUTO_REGISTRATION: true
                server:
                    ROOT_URL: https://git.nordgedanken.dev
                    SSH_PORT: 2222
                    LFS_START_SERVER: true
                    START_SSH_SERVER: false
                federation:
                    ENABLED: true
                mailer:
                    ENABLED: true
                    FROM: ops@nordgedanken.dev
                    SMTP_ADDR: mail.nordgedanken.dev
                    SMTP_PORT: 465
                    PROTOCOL: smtps
                    USER: ops@nordgedanken.dev
                    PASSWD: ENC[AES256_GCM,data:3j8TAX5lgWeC,iv:QSN/lAiuGr3How5Hsh8obuWgLXyb9kmzcRe1dOzK9wE=,tag:WzRZOYihRvWHzrEk/qr5VQ==,type:str]
        postgresql:
            image:
                registry: docker.io
                repository: bitnami/postgresql
                tag: 11.11.0-debian-10-r62
            enabled: true
            auth:
                database: gitea
                username: gitea
                postgresPassword: ENC[AES256_GCM,data:96FZrXVScb0DKGPevp8CnJcb7iB6l8VxuSsMjUTU9inOphyb9vvwiimJ06xT2Nw1bnHcXUNqXgO0Go1VzjZNOg==,iv:vFlNmf/9Ly4XwqCY1sjyLln0lvkojJPQdD7OZBKszNE=,tag:2sdVaF0xyiGwRyd9H9GwiQ==,type:str]
                password: ENC[AES256_GCM,data:8w65t3acEinsxrByTrdkJPu1Y7/JWf2INyyN5DgbqlUaH4NZ/SAJLFoegoLwh7h0cydGBWTfSEJgXuAhhf7lKg==,iv:mKNt4wJOp/jvnGyHmqGYgevdy0cbz1KbEVSfep0GlgU=,tag:YTxaBXxoMaPoRw5QT5ffXQ==,type:str]
                servicePort: 5432
            persistence:
                enabled: true
                size: 25Gi
sops:
    kms: []
    gcp_kms: []
    azure_kv: []
    hc_vault: []
    age:
        - recipient: age1esjyg2qfy49awv0ptkzvpk425adczjr38m37w2mmcahzc4p8n54sll2nzh
          enc: |
            -----BEGIN AGE ENCRYPTED FILE-----
            YWdlLWVuY3J5cHRpb24ub3JnL3YxCi0+IFgyNTUxOSBuT3I5TTlKVGZZeURZRkxa
            Qy9iRkFadWxTeUJIL3VEVEtmNkcrRkxpdkZJCko0UmYxUGFLTGNKSUkwRDNLS3JN
            d3VvNzc5UHphREFSYVJMK2dQVlpFTGMKLS0tIDNhd0FUbUtEUktrMktUTVNiUkwz
            SzA1K0hNYlJLaVZGNjRCb0pvVG1wREEKvfLynnidsI0IsoxRsbI7KudGjgtE3Vlx
            HIoAdNaPKYF9cy4ptRt6qa6W93yfZKm9yIyAWq1KiGThCSnCpg64cg==
            -----END AGE ENCRYPTED FILE-----
    lastmodified: "2023-08-10T20:41:06Z"
    mac: ENC[AES256_GCM,data:vjyV3g5xDtwxGyNy32DqmUQwm7GLXqXRKkEqdIs2veZrLC0+bIzEUpJfI+6sGo1EpPIVhtNT/P0uPX+m3WJ+AmBgwS26rjf2uV+LqIM6NO39Ci/cCWUnWP+OyNwjOrA8OV+7Je3q+ihBmiDv01ah9YLHDXiLP6CyeAhy+turzUQ=,iv:2lNb+ruk6M3S+WuBlD8dJ1elhtLmRo60VOnm8rkWpIU=,tag:aPrzxmi26jK8n9xPld/qHg==,type:str]
    pgp: []
    encrypted_regex: ^(privateKey|data|stringData|PASSWD|password|pass|postgresPassword|postgresqlPassword|redminePassword|smtpPassword|registration_shared_secret|shared_secret|secret)$
    version: 3.7.3
