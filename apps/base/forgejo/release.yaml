apiVersion: helm.toolkit.fluxcd.io/v2beta1
kind: HelmRelease
metadata:
    name: forgejo
    namespace: forgejo
spec:
    releaseName: forgejo
    chart:
        spec:
            #chart: forgejo
            chart: ./
            sourceRef:
                #kind: HelmRepository
                kind: GitRepository
                name: forgejo-git
    interval: 50m
    timeout: 25m
    install:
        timeout: 25m
        remediation:
            retries: 3
    values:
        image:
            # Codeberg.org was down.
            registry: docker.io
            repository: mtrnord/forgejo
            # Overrides the image tag whose default is the chart appVersion.
            tag: "1.20"
        containerSecurityContext:
            capabilities:
                add:
                    - SYS_CHROOT
        signing:
            enabled: true
            privateKey: ENC[AES256_GCM,data:GRdxpBn3t508KFHXgjdq353t6jtSnf5/GXDQfGi3ZV8H1F9FoxjMC66y535F3iQizAAOvrVTAh8c7q7eVdVIptoUjbNbDeqtuv2jgVxi+SCkTZLrSe3cwVG4V+aBI+IGaOWF/vo6+9/TokhXYmxZPZyeyH395lKSVILbX9N7oAm37v2IM4Al/nP10J99GTcfRwFwHdDDgzRkd/PAZEiI1qypeOENYgmTVvB5maiticmAr2Sd5ewYOHTUYrxY0mYfI7zIq3uXIt5Cd85xvPN1fTuDU1Edit2olekXDyPankxE5jr7qkmMJtXzJ2z95bQxOPZCIHfqTWjiOTrNb+lmqcFWTg8fLgVvjdsSAcSHFOmsK1jbVc1hQcjlN1V4aYucDkg9I/XvjW90YWZMAan7mK0U5lefnlmOjNAV6VXoa3lcy4PJcxnFJAoJC0KNOaCBilW8ogkPYgMA2ZMLOkHktKLVbhQdsPI1K4E8JL4yKLb19IKAy8AHiI0LV2g1asC8ObioWchCsTBUzBsgJp4frWQQCwQsXRvflUhfqAtivMqoSefaLL6umAccO8FcaZD/OYUeYFa6bxKOXWqOGLlID9oxqhPjg+RZcjRt9uEIZHiZMzyFhyvWw/aYNCjyKPjoorJ7RngFetNTCPEFKSIaHupfULl2mwFWGNYLZ0SRbRouBiJN6NlVR8z9twRcQNrmqhleOde7IaJu0lKz72AgZHaYgk/McfJSk2qYEZLRSFkFJeoCbWURJ5t1JeWW34tRL0UgaPf1nnbgIO64YwEqioRr8kuDM4nw4qpE4PUvQM2KIqmRhzdFhv/HI9MJE1Pt+BelJsjSWqsLoK+oCRxbJ2U5Z8NDcSvWyZlGqNHpepgwxCafMXvIvkVAM8GUfbV+RLsbxDD/j3eWy4BlzkgsPcLF8GZCxKtHfl3/p6VJ04l7hmKgx1hDITB15CnxxsQt2+CmugHWJ1Xoll1SjV7zbyPS/OHunzp6AtiQMWjUwm/gWUlU5szbeg==,iv:8eAVY8ZL7xama8jeB1nMl3c1O1yE0HSooxbqiLyxk+c=,tag:xKQe/xYIZVeiYWNQEvZ7Qw==,type:str]
        memcached:
            enabled: true
        persistence:
            enabled: true
            size: 50Gi
        ingress:
            enabled: true
            annotations:
                cert-manager.io/cluster-issuer: letsencrypt-dns
            hosts:
                - host: git.nordgedanken.dev
                  paths:
                    - path: /
                      pathType: Prefix
            tls:
                - secretName: git.nordgedanken.dev-tls
                  hosts:
                    - git.nordgedanken.dev
        gitea:
            oauth:
                - name: keycloak
                  provider: openidConnect
                  key: gitea
                  secret: ENC[AES256_GCM,data:HUm7fI2sEV6hqeigbHhwTF6bBKiXQXnvLsWlPLZfkao=,iv:A0iqtzGYl3JfpN9gsJLLimWSENVPcgb50y/QBUn/Ens=,tag:4fLLh7Ys7K6zYv48Vj8nNA==,type:str]
                  autoDiscoverUrl: https://keycloak.midnightthoughts.space/realms/Gitea/.well-known/openid-configuration
            admin:
                username: gitea_admin
                password: ENC[AES256_GCM,data:a3dxkQ/Vv1mYoBG+eNYEIAHmqglhrUkoX/buZufAF26rrjIhdVKi0PnnjrkNlojMNC8mATCCVFT5CdTy+qUdhA==,iv:zraan0InKsizsnvAN+/uSVYmFl6kFJ+HgylXH96yg/A=,tag:K9NDi7zvzKvzG0Z9MxVoCw==,type:str]
                email: ops@nordgedanken.dev
            metrics:
                enabled: true
                serviceMonitor:
                    enabled: true
            config:
                actions:
                    ENABLED: true
                    DEFAULT_ACTIONS_URL: https://git.nordgedanken.dev
                indexer:
                    ISSUE_INDEXER_TYPE: bleve
                    REPO_INDEXER_ENABLED: true
                repository:
                    MAX_CREATION_LIMIT: 0
                    DISABLE_HTTP_GIT: false
                service:
                    DISABLE_REGISTRATION: true
                    ALLOW_ONLY_EXTERNAL_REGISTRATION: true
                    DEFAULT_KEEP_EMAIL_PRIVATE: true
                oauth2_client:
                    ENABLE_AUTO_REGISTRATION: true
                server:
                    ROOT_URL: https://git.nordgedanken.dev
                    SSH_PORT: 22
                    LFS_START_SERVER: true
                    START_SSH_SERVER: false
                federation:
                    ENABLED: true
                mailer:
                    ENABLED: true
                    FROM: ops@nordgedanken.dev
                    SMTP_ADDR: mail.nordgedanken.dev
                    SMTP_PORT: 465
                    PROTOCOL: smtps
                    USER: ops@nordgedanken.dev
                    PASSWD: ENC[AES256_GCM,data:b53mdn72ayKn,iv:HTWBMVatnMd2+7BNVbbgutt3m8INheNfG/hgyxktwBw=,tag:aTi3vrTkcnneVGfZdwpxVg==,type:str]
        postgresql:
            image:
                registry: docker.io
                repository: bitnami/postgresql
                tag: 11.11.0-debian-10-r62
            enabled: true
            auth:
                database: gitea
                username: gitea
                postgresPassword: ENC[AES256_GCM,data:mS4aNVuyuFKxhIK+C4Q5hsiG32zcAk7mpUE00ZLUfhWPXvt31cumiHc6BTYv5DFyjwMOctHvA8MR2QjnvbCUOg==,iv:jEDpw8kbC3zkRomjz6uLRyp2Ln53nNpSz1qcqU+Py8Y=,tag:4v3cx7D87s52la6DyX1vew==,type:str]
                password: ENC[AES256_GCM,data:lAdoEt5L3aISqKSUSXDK5OydFF38HFS8jlfoE8UybzPzp18TpcO3DqDSRj5U4KFE8QdI2r0oKWK1LQirh647MA==,iv:abHtlK7dXoJuYBLQJ9YvVIk/1smC7wqFa9agt7fQMGA=,tag:oPqDNx2XnBtyx3QOr4+LEg==,type:str]
                servicePort: 5432
            persistence:
                enabled: true
                size: 25Gi
sops:
    kms: []
    gcp_kms: []
    azure_kv: []
    hc_vault: []
    age:
        - recipient: age1esjyg2qfy49awv0ptkzvpk425adczjr38m37w2mmcahzc4p8n54sll2nzh
          enc: |
            -----BEGIN AGE ENCRYPTED FILE-----
            YWdlLWVuY3J5cHRpb24ub3JnL3YxCi0+IFgyNTUxOSB3cnNnQkNqQWpEdDNMYTZR
            TExXam9YUHJFWmZJRG85eitMNU9WOWRGMlhnCjhTaitOZDVMY3FHVW1pQW1xL3d0
            RERJQVo5OXVmdldYSWNwSGx6Nk5Uc00KLS0tIFJYM3Q5ODhCbE9OM25BUEJvbUJv
            NFAvdjBKekM2V3lxb1JnaWtYNVFGSTAKt6nhiPTh1keskJMb7x+Wk7yLCBqbHGqk
            qlLaaXf3Ls7nw/iuEBGkuF7WyChoJxTe0cOGGeCPqYh5kfbT4TMOog==
            -----END AGE ENCRYPTED FILE-----
    lastmodified: "2023-08-10T20:30:14Z"
    mac: ENC[AES256_GCM,data:di3/T/M7OXJ4gIsj1COULPivS/OUX/d2mEti7SKEjljCt9MQ3bP8KDCWy9OUSCPRbBItwLUrwV17fwrTwL5qX7kkuP3NTC8Mk4GUZOf+K4OLWREQV2nNr+s91oWfZQvZ2wnv5vGJFOmH/wEpStwiZd9ZprMLDBeuCzlywpDByEg=,iv:RE4G/MJEj7tHFUIDu7vaxZq3LGurz7i20sD5o4WSeew=,tag:FkWHyWI4kNCS3k8cHdWfpg==,type:str]
    pgp: []
    encrypted_regex: ^(privateKey|data|stringData|PASSWD|password|pass|postgresPassword|postgresqlPassword|redminePassword|smtpPassword|registration_shared_secret|shared_secret|secret)$
    version: 3.7.3
