apiVersion: helm.toolkit.fluxcd.io/v2beta1
kind: HelmRelease
metadata:
    name: forgejo
    namespace: forgejo
spec:
    releaseName: forgejo
    chart:
        spec:
            #chart: forgejo
            chart: ./
            sourceRef:
                #kind: HelmRepository
                kind: GitRepository
                name: forgejo-git
    interval: 50m
    timeout: 25m
    install:
        timeout: 25m
        remediation:
            retries: 3
    values:
        image:
            # Codeberg.org was down.
            registry: docker.io
            repository: mtrnord/forgejo
            # Overrides the image tag whose default is the chart appVersion.
            tag: "1.20"
        containerSecurityContext:
            capabilities:
                add:
                    - SYS_CHROOT
        signing:
            enabled: true
            privateKey: ENC[AES256_GCM,data:k8bJr1gJyJ9RWhTam9LUXwbfzA3/V9BRfhcoOH8X7edGXB7w10jBIRTyMUm/eJgzBNT0EyLNCOHugBS155BFPbSolnT/m/jxIOsGua1hjCENzt0zzF3fCFeW/D2+Zftu7bSabRu3BX2SBfq5266XNSpxTkk1+3+Ro2ZlXJY8V0r/vLdrfzeX7voYX2Qz+ryTsdRx/W3AABeeJ19R8vekvnBB3O7Cab5ZR6oB6wShtnOttkRJNjgikdkuG67pE3L7NcC0vslnofPgq8qHxPCcgClo/yQYw173sbyO3CJvCPx0ByenOoH9qqGj9WzjSvp3rhqhgdT0Ipn4zaA5hguFFZZEc68ozmVAWB7Q1gpE3EN38AfQuED9ELQc18gghmxVRVGbhUpNvmTKAZKEEzQQcJBgWCET9L1WgBMyW6QcsW3dqDxxqIA21n+yekNa7aVnfY2qN9S+xKadDTfC4ICFN3SW/Kaz0F1IDMyZuO28NmItazv9gQD4aaJ6TD5Pumd4Tcg2ZK7XffGCPBh/q5vB+oP3g6mwEQgiLThBpHA4zc+eZw5yb+Xn3tymrE1KRA6EMj9yQMHft0493TGPimYHNMJW7/+2XDtddAQ+AVClrgcIbw1k4HpbDDuUSvBYnq/GRsfT62dLP0Avq51IKdPLx/8JtJXYldrOnObxfc1tzrt7HtEuq56mdzHLixpWW/h3FmESySo6JZY2mlzrCrkDO5la2iHpfUo8SK1pEYF77CTr9Pth/2v97nEvdwXmiopp1FEJZ+qlX683xeYwYBs7YXWUqfblKOYAWt90U2uOG8+BB0Qw2ooebgsdyuo51qAZ6/vw7OujHSH4yFdyLKinAAiFUzTNt/gUhhUYVOyeoIyWMimmUb11W5dja1cwS1vk3ePAtz2DB2Ww9PhU7A/Di6EHJJ3q2De3I651YBLYiByVBtkmPYLEmdNAX1842sfbkFwnyguB6UH24vfe62oQwscT1lDGfiZzzWZxQzQDDVteTWobFKM=,iv:abSR7hNahGqBXilNKJu3AwG0lTaQylllyagtBreaaH0=,tag:IJwdqwdhXsKvL7/d3qtTGw==,type:str]
        memcached:
            enabled: true
        persistence:
            enabled: true
            size: 50Gi
        ingress:
            enabled: true
            annotations:
                cert-manager.io/cluster-issuer: letsencrypt-dns
            hosts:
                - host: git.nordgedanken.dev
                  paths:
                    - path: /
                      pathType: Prefix
            tls:
                - secretName: git.nordgedanken.dev-tls
                  hosts:
                    - git.nordgedanken.dev
        gitea:
            oauth:
                - name: keycloak
                  provider: openidConnect
                  key: gitea
                  secret: ENC[AES256_GCM,data:GvJGLQMZevCVNfj8cYaBYoeAB/SyQbd/kgrAHfuUmSE=,iv:1KDUp/eZYFpv0Y1FBDJ4R0X7pXyipax6m0tT9xo/ngQ=,tag:F4pYn9dw71VtwfTpvM8Gqw==,type:str]
                  autoDiscoverUrl: https://keycloak.midnightthoughts.space/realms/Gitea/.well-known/openid-configuration
            admin:
                username: gitea_admin
                password: ENC[AES256_GCM,data:2vC944wUmSxuiFWoY0pnDq2EgQrjsml0HE/s564DNgy1x/nwV59iU9tcJ6HAdj6hGwUsRONZQERcYoFIzTOn9Q==,iv:scRHBJWmgICa7A0qNJzeHgEsC0zxFLytO3Ud+4J2nZk=,tag:DF5RChuv25tHs1dnOfQ9yg==,type:str]
                email: ops@nordgedanken.dev
            metrics:
                enabled: true
                serviceMonitor:
                    enabled: true
            config:
                actions:
                    ENABLED: true
                    DEFAULT_ACTIONS_URL: https://git.nordgedanken.dev
                indexer:
                    ISSUE_INDEXER_TYPE: bleve
                    REPO_INDEXER_ENABLED: true
                repository:
                    MAX_CREATION_LIMIT: 0
                    DISABLE_HTTP_GIT: false
                service:
                    DISABLE_REGISTRATION: true
                    ALLOW_ONLY_EXTERNAL_REGISTRATION: true
                    DEFAULT_KEEP_EMAIL_PRIVATE: true
                oauth2_client:
                    ENABLE_AUTO_REGISTRATION: true
                server:
                    ROOT_URL: https://git.nordgedanken.dev
                    SSH_PORT: 22
                    LFS_START_SERVER: true
                    START_SSH_SERVER: false
                federation:
                    ENABLED: true
                mailer:
                    ENABLED: true
                    FROM: ops@nordgedanken.dev
                    SMTP_ADDR: mail.nordgedanken.dev
                    SMTP_PORT: 465
                    PROTOCOL: smtps
                    USER: ops@nordgedanken.dev
                    PASSWD: ENC[AES256_GCM,data:/dmXycGgwe+M,iv:vKiaC3tB1wN+yCj8joD2zQ+wNxpwRu2p+L2rA1rSVY8=,tag:XqnKGGPN8VwTJIzpSEZBUw==,type:str]
        postgresql:
            enabled: true
            global:
                postgresql:
                    postgresqlDatabase: gitea
                    postgresqlUsername: gitea
                    postgresqlPassword: ENC[AES256_GCM,data:P6pu294gd5nOYr8hGgxaJlJiBxKcZqBwwcg7CyCKr1yCKhmrHAEu/BPlsqPg9dKaFy6CDRhOYkOSQxvdHwXYbg==,iv:kuF4tbOIFuELaQ9/FIwK/102Unbp9jtXAellp11bMBE=,tag:p3YpI3OLK2G48DaPIbEbLQ==,type:str]
                    servicePort: 5432
            persistence:
                enabled: true
                size: 25Gi
sops:
    kms: []
    gcp_kms: []
    azure_kv: []
    hc_vault: []
    age:
        - recipient: age1esjyg2qfy49awv0ptkzvpk425adczjr38m37w2mmcahzc4p8n54sll2nzh
          enc: |
            -----BEGIN AGE ENCRYPTED FILE-----
            YWdlLWVuY3J5cHRpb24ub3JnL3YxCi0+IFgyNTUxOSBUcVN0YzBzdzFXTmNsaVZz
            NFM4M2tGZ1dmWXQxT0IrMnFmdUlCOVBISDFnCktKby9kM0tqbHZjY2MrV1RBaE1u
            ckpQTkN4TUJmc29ObWVqYmlVaW9uelUKLS0tIEg4WlRQU0R3dlpOU1EzZWN4UHYw
            ZzVYVzN5TmFlV2tLVnpLd3RBV3hZTTQKwxFpC7WfkiNBbF6NnD5L9Ew941NhGxMa
            hXgLDMUgqyQrafCEBpAjUOcBBHMhGlyicxoQVGDiuEk9o1ZO3D+dvQ==
            -----END AGE ENCRYPTED FILE-----
    lastmodified: "2023-08-10T20:00:43Z"
    mac: ENC[AES256_GCM,data:TTLHrs1ZdRgBqRbvvOeSeN+wSACPhPkWBgFmZQOrkhMdyv4ws3d22D9BgTBRMkuvBfdl7NJqVDH44DQnae/JrUGCHLEbBYGYikOEFTuLlytEUqeX8sJr2XoLh2ugEJuR1zcbCddf1XgdKu8N10m6d4lDQ3vc84YVfXf/7PrWbtk=,iv:ccLN1y+VpxUhVkE9jOLlkyLXFcSPVfrUY5CitVfzHU4=,tag:P3F2nVr5I4r3Y2QZcUFtuw==,type:str]
    pgp: []
    encrypted_regex: ^(privateKey|data|stringData|PASSWD|password|pass|postgresPassword|postgresqlPassword|redminePassword|smtpPassword|registration_shared_secret|shared_secret|secret)$
    version: 3.7.3
