apiVersion: helm.toolkit.fluxcd.io/v2beta1
kind: HelmRelease
metadata:
    name: forgejo
    namespace: forgejo
spec:
    releaseName: forgejo
    chart:
        spec:
            chart: forgejo
            sourceRef:
                kind: HelmRepository
                name: forgejo
    interval: 50m
    timeout: 25m
    install:
        timeout: 25m
        remediation:
            retries: 3
    values:
        # image:
        #     # Codeberg.org was down.
        #     registry: docker.io
        #     repository: mtrnord/forgejo
        #     # Overrides the image tag whose default is the chart appVersion.
        #     tag: "1.20"
        tolerations:
            - key: arch
              operator: Equal
              value: arm64
              effect: NoSchedule
        containerSecurityContext:
            capabilities:
                add:
                    - SYS_CHROOT
        signing:
            enabled: true
            privateKey: ENC[AES256_GCM,data:YPjuaJ02cp/MWMdYJ8zxjXkCHKdwfmbbWYcZCYRC5S8s1xlGqL3lLvEHwk71YBWF2V9i0oP/CPz4Sx6Ml+6bEhtK7VArsnjYUIiVzz0JrD0rMTkabT+Ym2uTuM5FPLLCQ13mDJ6mCn+E2ZTsNWA5Gagxk/XC0GTIgUS9b7/yGTIqC/+3PrTytwxh+px3nY8pOq8VsOMU0Ar/ppcxHNLKZiUtFAJjq1TDUccCMpiZsMB3HHjw5mrLTDW3Uu7YP7cYvHbTPgXFuNTewKPRVtW1p7O2WCi2Bl5+KIDFdrBjFHIRcLlQaD3aObCJYF5EduOcoR4YiGEMyQG2HCxHlJhx4ykChWjsDOuHaNyGKa9+6a19zCWzkLPkZN68g0fZrqKpf2ptAsqZjMlLjOhRZXg/A09htlk2S3lVLPbkOkYpHht+ZbCBoYfKi0qxoDqLzyzfg5sC24OyEoTeLSUeF7VoEF+L6RkFqxq/ILvQXK72QmA2hgBHoQHTCb2LH8CI2/7FX1mnUN18RRnbE4kDtBBaNu5/F/1AcvweNa74/VRiHbwsZpkdkqkmhbhPbIcOsfM/Y5prU3GmVZxXu4DcYOr1Xg68SYYi7h+Sb8P4Xbzqd/DVDJUmvQtRBWwt0syf20FXMcWbHjjB5bUcRNRwYqMsurzz9JNzyjV+LGZkK1XHLyn0jbrRRPhreQM8UUoNtY+iXRUNsOhFEvkugk4mnLN7V1lClNCdUbVmsEEc+eq2xrmpUAs7gS1Jm0feIUbi/IlcC+rBa99kBUNPjgBy7HJQG3qgQVaftlh1ibr9IB7RaNXJ1E1ESXm23rtbnrKW68MD/6jOFkT+9TSOpM7teGBYI4TfloXL3mjL1Y9/DUTotGXBzZWFbsu5SJDO/mXSoAot3eLJn7ATmN5crwMPztyjRw22kI3ynFPqgbI5LgW/kBQis56+IypWHlGHiLUz/Kqw/uWIUY2vgJXftg03K8cbomNYOzqvDyj/8RUjR2T6zjEClz+a2IF2AQ==,iv:KBmnusb1FD2UzyGmjRalFxZAijDpvxt3KOvQiTeSJp0=,tag:oqlP1kUSQtT+FTX9lazd7A==,type:str]
        persistence:
            enabled: true
            create: false
            size: 50Gi
            claimName: data-forgejo-0
        ingress:
            enabled: true
            annotations:
                cert-manager.io/cluster-issuer: letsencrypt-http
            hosts:
                - host: git.nordgedanken.dev
                  paths:
                    - path: /
                      pathType: Prefix
            tls:
                - secretName: git.nordgedanken.dev-tls
                  hosts:
                    - git.nordgedanken.dev
        gitea:
            oauth:
                - name: keycloak
                  provider: openidConnect
                  key: gitea
                  secret: ENC[AES256_GCM,data:xJlSKvZdun0jy+V+6Aii6LOvqVF0/y22GdUQ7NFa1no=,iv:Sm4tpp89LdnhNftb10Hy0jGlxFmt4Rp6bqfsdN0w5S8=,tag:6IpBsKS9KBe2GKxKeB9u/Q==,type:str]
                  autoDiscoverUrl: https://keycloak.midnightthoughts.space/realms/Gitea/.well-known/openid-configuration
            admin:
                username: gitea_admin
                password: ENC[AES256_GCM,data:cXzrmTFmyNh0KjPearBRkVx5VaodcgpoA+CETn1c+p+BO8CY+8CtuX2G1cysYmzP+BV31TYIIB60ru9f2oTflw==,iv:E36NkUzIoccKIXG83OvETSNk38lM+yddssDW5PotYtI=,tag:sdKyuYp0zuGKTlnseHY+qQ==,type:str]
                email: ops@nordgedanken.dev
            metrics:
                enabled: true
                serviceMonitor:
                    enabled: true
            config:
                metrics:
                    ENABLED: true
                    ENABLED_ISSUE_BY_REPOSITORY: true
                    ENABLED_ISSUE_BY_LABEL: true
                actions:
                    ENABLED: true
                    DEFAULT_ACTIONS_URL: https://git.nordgedanken.dev
                indexer:
                    ISSUE_INDEXER_TYPE: bleve
                    REPO_INDEXER_ENABLED: true
                repository:
                    MAX_CREATION_LIMIT: 0
                    DISABLE_HTTP_GIT: false
                service:
                    DISABLE_REGISTRATION: true
                    ALLOW_ONLY_EXTERNAL_REGISTRATION: true
                    DEFAULT_KEEP_EMAIL_PRIVATE: true
                oauth2_client:
                    ENABLE_AUTO_REGISTRATION: true
                server:
                    ROOT_URL: https://git.nordgedanken.dev
                    SSH_PORT: 2222
                    LFS_START_SERVER: true
                    START_SSH_SERVER: true
                federation:
                    ENABLED: true
                mailer:
                    ENABLED: true
                    FROM: ops@nordgedanken.dev
                    SMTP_ADDR: mail.nordgedanken.dev
                    SMTP_PORT: 465
                    PROTOCOL: smtps
                    USER: ops@nordgedanken.dev
                    PASSWD: ENC[AES256_GCM,data:HnKkGw06eIyq,iv:OJwLNqfI90kYb+sIawBRq7A01vXaZHGR1bOnSrWGxRc=,tag:O/55TFCmDXQNM+FbmUg5VA==,type:str]
                session:
                    #PROVIDER: redis-cluster
                    PROVIDER: redis
                    PROVIDER_CONFIG: redis://:@forgejo-keydb.forgejo.svc.cluster.local:6379/0
                    #PROVIDER_CONFIG: redis+cluster://:@forgejo-redis-cluster-headless.forgejo.svc.cluster.local:6379/0?pool_size=100&idle_timeout=180s&
                cache:
                    ENABLED: true
                    ADAPTER: redis
                    #ADAPTER: redis-cluster
                    #HOST: redis+cluster://:@forgejo-redis-cluster-headless.forgejo.svc.cluster.local:6379/0?pool_size=100&idle_timeout=180s&
                    HOST: redis://:@forgejo-keydb.forgejo.svc.cluster.local:6379/0?pool_size=100&idle_timeout=180s
                queue:
                    TYPE: redis
                    #CONN_STR: redis+cluster://:@forgejo-redis-cluster-headless.forgejo.svc.cluster.local:6379/0?pool_size=100&idle_timeout=180s&
                    CONN_STR: redis://:@forgejo-keydb.forgejo.svc.cluster.local:6379/0
                database:
                    DB_TYPE: postgres
                    HOST: matrix-postgres-cluster.matrix-postgres-cluster.svc.cluster.local:5432
                    NAME: forgejo
                    USER: forgejo
                    PASSWD: ENC[AES256_GCM,data:Ba4k7893dFIBZ77yzmsz+o6/YJERRtpL/vGTa4UsyNUo0tQrAbREzd1WxwoMJYvha78eaVTSKK53L9QLohaR+Q==,iv:wXZaqe9DOItmw0hP4BZp6jjMIgFah+p/ekpAE9EiEqY=,tag:ARYQ5IXa8yv0OORVFQ3RlQ==,type:str]
                    SSL_MODE: require
        redis-cluster:
            enabled: false
        postgresql-ha:
            enabled: false
        postgresql:
            image:
                registry: docker.io
                repository: bitnami/postgresql
                tag: 11.11.0-debian-10-r62
            enabled: false
            global:
                postgresql:
                    service:
                        ports:
                            postgresql: 5432
                    auth:
                        password: ENC[AES256_GCM,data:YO6rRodCmcgVYofE8iy6fvaVLOh2vwRMZTZplvdC92JYlsUaGnU5XuBMZDs8r/UTFVk9QUPyVNDhfJ/kudeoJA==,iv:dHY7R+qOuUwdQrkrHsb8Cp9thIg/P1M2jGBJUt6yzEc=,tag:ZwKB+ihw+PyUkSi0r2iwKw==,type:str]
                        database: gitea
                        username: gitea
            auth:
                database: gitea
                username: gitea
                postgresPassword: ENC[AES256_GCM,data:1JZnYjLTRh+IdA==,iv:ZsbyafabYJHj4edLvZL8gQtBzFwO9T9Bx2mEviasUvk=,tag:JvL6s7UdS8rSNrUZn79UrA==,type:str]
                password: ENC[AES256_GCM,data:UJRBYwXWihilXq2C3698qF4YOdOqo6BaEoZl6MebK1OMQ8VOugmoRSKbJ5+IAHRRLbdJyYzvrNYZHlJ9BnGyXQ==,iv:Mil9qK0BlvvmIkjPc/TYolcC7Tu0T+dWrMypOr95d6s=,tag:yJ1Aa/BrLeE/nwf0R9QcIQ==,type:str]
            persistence:
                enabled: true
                size: 25Gi
            primary:
                networkPolicy:
                    enabled: false
sops:
    kms: []
    gcp_kms: []
    azure_kv: []
    hc_vault: []
    age:
        - recipient: age1esjyg2qfy49awv0ptkzvpk425adczjr38m37w2mmcahzc4p8n54sll2nzh
          enc: |
            -----BEGIN AGE ENCRYPTED FILE-----
            YWdlLWVuY3J5cHRpb24ub3JnL3YxCi0+IFgyNTUxOSBRcnRlclZzQnh4dXhJZmlp
            Tk95R2lTRTJPdTdlTmtXeDIzbFUyaGVNenlvCmRNem9XUzAvTUt0c21VWWVDWEhV
            bVY4aEtVRmhYbzZHd0U3WGpSK3NoR28KLS0tIGp3aG9ZeDN4VGl4UExzc3RBZTNJ
            cXZGNDJEQ2NVN3VvdysraWcrV0wrR0EK3xmV3CHBDNLvBlUuHJbYwsU+eJY9QUIk
            aR9lY+YHO1nWb74CUCUB8yItyq9mS9udZUGrIZk5I6sWm6E3lM2CTA==
            -----END AGE ENCRYPTED FILE-----
    lastmodified: "2024-04-21T12:55:11Z"
    mac: ENC[AES256_GCM,data:yNvWPuev7yvPxLZP/v/6nQ0hDzPnlQ3n+8gfKzexxEAcka34IE+pSr06zD9j+w3/8sVUG6HxzxGDUn3umTK3JjTfQByCEIsBPC6wwEQPDabpRycBSswByY5LP4bqdNinRTyBPZ7z56vlbHVSYcGXgYXIXiwF8S8qGjJn4aRc6Bw=,iv:9i0cu4GLrVVP16+UQhrUMmnACiuh9Z3TQiVsJYVrRD4=,tag:w+rCMZIuTE4ox/LYBxCnqA==,type:str]
    pgp: []
    encrypted_regex: ^(PASSWD|AUTHENTICATION_PASSWORD|ROOM_API_SECRET_KEY|adminPassword|configPassword|adminUser|configUser|APP_KEY|api_key|api_secret|keys|livekit_key|livekit_secret|secret_key|adminPassword|admin_pass|admin_email|mariadbPassword|mariadbRootPassword|privateKey|data|stringData|PASSWD|password|pass|postgresPassword|postgresqlPassword|redminePassword|smtpPassword|registration_shared_secret|shared_secret|secret)$
    version: 3.8.1
