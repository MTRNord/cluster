apiVersion: helm.toolkit.fluxcd.io/v2beta1
kind: HelmRelease
metadata:
    name: forgejo
    namespace: forgejo
spec:
    releaseName: forgejo
    chart:
        spec:
            #chart: forgejo
            chart: ./
            sourceRef:
                #kind: HelmRepository
                kind: GitRepository
                name: forgejo-git
    interval: 50m
    timeout: 25m
    install:
        timeout: 25m
        remediation:
            retries: 3
    values:
        containerSecurityContext:
            capabilities:
                add:
                    - SYS_CHROOT
        signing:
            enabled: true
            privateKey: ENC[AES256_GCM,data:QTqZ9vC3IuUm14FCMKst3YqufnDhZMX+/Ian48SufoyuFty3Cm9IRR4ob+ffslRgbA0/fQF89n0eUQ0xi8Barz8KtIKiE6LGO+JHdPcPjkBjb/ML+XS/BObFsqa/paBdV7KnXQQJi+jzk/QvlgRZHe0xbeZiVrl0TG0h1C9liRnXwGFFFg9xH5Ljf1BrmFM82ff13jGBKeSwaJyPSBng0Q3E45clow0ZxJghjOlK+cy8b5Su2HpQbo79QCHIWJQsBXF3h8qX+vD/suywQQ8R9GSkm9+VaKKEugd2X8huwSq0mVo+ZCZnBTe3O1Qnfqpq4sKpI5AmdUDA7Pel1CXafPalyN7aoXUZ821uIdJpIKATK+cm0D4/tc7IlTmOanezUDFuM+GgSD6lS94ZzJeFfLNVfqMfLFjdfStfij1FbZqERMXKGuObwWrLn48GWBvTrnDKeOWxBMx/TDw7HX+WZoy2ZmF+EwHb2GSjIJmJkzTxSY81tT2hv33zWzEV+PCXFpfuKc6IBcUd0o84DEpCgOlQem4AcvFDw2XilFOalopkrFOLT8fJVatRs+uqHbBKiqO0+Z9fOdkPD6ekunqjiFwYWzayfC7/Pa5VwjqRieXtLyPe+/5h5c/PH8/4bEFxCPadIXXh0WZ44uMtnlmj26YryTxTch9A92Kq00niyPuq71V3T94tQXoCBxjOiAOt15AZ7yhr/U3Rh54xwUOxAsgVv4KfInLdEhh+r4JmJSta4/nnZQHzpr/cRwj3csV2wfMHHD/ox1MWWCb/cTzfzrO4j+dsGiHfc7ZuFNMxOaFOZy8mYOo722i5otNOwejAZyiHJibGSGdvWC/xL1pcJ6M1z9lCn4aEpFXfhXNrAGLDFszUjsUOaabYl/14vp3GLRfSCpq9RlCwKbjkkZYOvdguTow3Gl2rhXyqbFyhF69BMSqRchowvNxOM/lsTwCpfHyqs9FVhWu0Yv1DmTUMkxwYzCe9t1x9KmO4XpXQdSV7MkwO06I=,iv:r7F94eAaxMAnm7IvDKkctTfpdPZv0j0Qc9rMJtOtN80=,tag:3rJ26JQp+UKeEGflt6PP+g==,type:str]
        memcached:
            enabled: true
        persistence:
            enabled: true
            size: 50Gi
        ingress:
            enabled: true
            annotations:
                cert-manager.io/cluster-issuer: letsencrypt-dns
            hosts:
                - host: git.nordgedanken.dev
                  paths:
                    - path: /
                      pathType: Prefix
            tls:
                - secretName: git.nordgedanken.dev-tls
                  hosts:
                    - git.nordgedanken.dev
        gitea:
            oauth:
                - name: keycloak
                  provider: openidConnect
                  key: gitea
                  secret: ENC[AES256_GCM,data:Y+3FM4T15/rvp/zlqyGBfdl8vsOlMr8upbSafijkhlA=,iv:ekjY4DR5kd7uamU1blHp/vkhw9Grgwrg/L8rpznxI9g=,tag:/ZTbEhcLmjC6P573kOeikg==,type:str]
                  autoDiscoverUrl: https://keycloak.midnightthoughts.space/realms/Gitea/.well-known/openid-configuration
            admin:
                username: gitea_admin
                password: ENC[AES256_GCM,data:MwL0JQ4xbdqxTo52H89VlUnU+qK//k8MCTrPVplU7v7E3OyrJHLCf9rrPi8daZuacPkJ+S8eCbJzhCk2Oj8Tmw==,iv:4a1czi4cr7O4EF6aSpkZFuUy2eJSDQeb91c+HfUPSNo=,tag:+XPeHHL3YdjMZPjSzUNftA==,type:str]
                email: ops@nordgedanken.dev
            metrics:
                enabled: true
                serviceMonitor:
                    enabled: true
            config:
                actions:
                    ENABLED: true
                    DEFAULT_ACTIONS_URL: https://git.nordgedanken.dev
                indexer:
                    ISSUE_INDEXER_TYPE: bleve
                    REPO_INDEXER_ENABLED: true
                repository:
                    MAX_CREATION_LIMIT: 0
                    DISABLE_HTTP_GIT: false
                service:
                    DISABLE_REGISTRATION: true
                    ALLOW_ONLY_EXTERNAL_REGISTRATION: true
                    DEFAULT_KEEP_EMAIL_PRIVATE: true
                oauth2_client:
                    ENABLE_AUTO_REGISTRATION: true
                server:
                    ROOT_URL: https://git.nordgedanken.dev
                    SSH_PORT: 22
                    LFS_START_SERVER: true
                    START_SSH_SERVER: false
                federation:
                    ENABLED: true
                mailer:
                    ENABLED: true
                    FROM: ops@nordgedanken.dev
                    SMTP_ADDR: mail.nordgedanken.dev
                    SMTP_PORT: 465
                    PROTOCOL: smtps
                    USER: ops@nordgedanken.dev
                    PASSWD: ENC[AES256_GCM,data:emPMb5M/sV4Y,iv:Xbtsn2e7kxiijeR9GLS66JUsw4WBBEo5hOmziS80ZFE=,tag:7XUj598l8MR/GZkLaPU7Dw==,type:str]
        postgresql:
            enabled: true
            global:
                postgresql:
                    postgresqlDatabase: gitea
                    postgresqlUsername: gitea
                    postgresqlPassword: ENC[AES256_GCM,data:b+dyJZQJcWCNQprxY6m0CQaPPkasj5NwFpsWoeMkPlqndf1X6nIefG89K2tTym4vSq+8R5G01KObIYpp7139wQ==,iv:qXNhzw1KZ2ocvvfmw5SV7V5JRvYIt5FwDkbPeRlSRik=,tag:/GBdZ+1gNEMcVIiJKNsK3w==,type:str]
                    servicePort: 5432
            persistence:
                enabled: true
                size: 25Gi
sops:
    kms: []
    gcp_kms: []
    azure_kv: []
    hc_vault: []
    age:
        - recipient: age1esjyg2qfy49awv0ptkzvpk425adczjr38m37w2mmcahzc4p8n54sll2nzh
          enc: |
            -----BEGIN AGE ENCRYPTED FILE-----
            YWdlLWVuY3J5cHRpb24ub3JnL3YxCi0+IFgyNTUxOSBBeDVqaWFLVVdpcTNNZE1r
            bUVKZEowREVDNEh3OTl0c2hTWkdtajMrSEh3CnNxTTFCaWhRakI0aG9SME9TczI2
            UDNRaWNGVmRxb2o5YittSUE4STV5cG8KLS0tIElFWW9QNlNMVTg5Q3NXVnhtbHZD
            SG5vc1o0VDVWb0EvRWdTSUFZQ3RWSGsKR45OSWkxDC29vEf/OTMqYARXYeV+OrSX
            SQkR7zUzRPl1Goczea1U5hzcdc38T1ac/G6lyzD3hme0anu0QBrKvA==
            -----END AGE ENCRYPTED FILE-----
    lastmodified: "2023-08-10T19:10:14Z"
    mac: ENC[AES256_GCM,data:TxSpg8P33I6SObPEXT6zosaQTrwaWXCh7g/57deKPBq3zxrqDAWd0/Ghw2kKaVNnPh3glx1RqtLPhhIzD1F/IyQLD8897yX+b9WDI83mvAG6HFr9wW8EzSFDDbDgRubn88tqUgI2HjobhMsVzoxtp6P+BKk99OLO93cg9B5GqwA=,iv:X73z4DUcBDfP1x+VU7j/VLgFwzv9yIsjWSprGq8gy8c=,tag:F4W+B19/HmXEX0ipxNsiTQ==,type:str]
    pgp: []
    encrypted_regex: ^(privateKey|data|stringData|PASSWD|password|pass|postgresPassword|postgresqlPassword|redminePassword|smtpPassword|registration_shared_secret|shared_secret|secret)$
    version: 3.7.3
