apiVersion: helm.toolkit.fluxcd.io/v2beta1
kind: HelmRelease
metadata:
    name: radicale
    namespace: calendar
spec:
    interval: 5m
    chart:
        spec:
            chart: radicale
            sourceRef:
                kind: HelmRepository
                name: radicale
            interval: 60m
    install:
        crds: Create
    upgrade:
        crds: CreateReplace
        # Force recreation due to Helm not properly patching Deployment with e.g. added port,
        # causing spurious drift detection
        force: true
    values:
        env:
            # -- Set the container timezone
            TZ: Europe/Berlin
            # -- Set the location of the configuration file
            RADICALE_CONFIG: /config/config
        ingress:
            main:
                annotations:
                    cert-manager.io/cluster-issuer: letsencrypt-http
                enabled: true
                hosts:
                    - host: midnightthoughts.space
                      paths:
                        - path: /dav
                          pathType: Prefix
                          service:
                            port: 5232
                      tls:
                        - secretName: midnightthoughts.space-tls
                          hosts:
                            - midnightthoughts.space
        configmap:
            config:
                # -- Define inline radicale configuration as a ConfigMap.
                enabled: true
                # -- Radicale configuration. See [image documentation](https://github.com/tomsquest/docker-radicale#custom-configuration) for more information.
                # @default -- See values.yaml
                data:
                    config.cfg: ENC[AES256_GCM,data:kPikW4NjjmQgj5CP3UPKTRa79V2LNbw4ubkAsoaPc8DKnAyL12fE5EmRGthj14uypW7b6biI86Db9lp/1TH0Xi8yxrYufv+e+xjgTrfhxhjTL0DcOrzdnTvHJlTUDQ1L36+oQt+sFZi+dc+wY8zJidqd5crGomWMltB9GpsolAj85+4eGiu//zK7HtNNJ5o5tw9QvqSwHNqQA8fCsu1YbsBtdg0FO4mCniPM1dY5PTfcZrHWczytPZYAP8ofE0LBmupkdTqpWzKxr3Dbkm2YS68H2wQMJ3V4wz12Zrx2LVnFeiE5zGVYRmUL6NrjnDJd5er88LiUplGY+azV2eTSHCefiXI2SftPW4srQ4dx,iv:xN+5ZEDCy11nzsmrotzkN22FrF/JLLAy2m+ih4I/VxU=,tag:fVYcX5lyscQhpiz0ay+p2A==,type:str]
                    htpasswd: ENC[AES256_GCM,data:laswdl24rBwQMn1+OAdow0Z6xi+vBsR3onAQAWEJ+UTuTbyVGTcIP+Rd8/xZ0kVvN6ptEGMCj2qul9lbnNPVx3BZhpXu,iv:Nqi9lyuFcrbJJyHrcwUmZnSwNcIllX8H9S1pRPTAwmY=,tag:0r6uXhnFTPEGM4gR9TbVrA==,type:str]
        persistence:
            data:
                enabled: ENC[AES256_GCM,data:2sN/cg==,iv:ENMps9RmqsMxE8lVAOMBi4JM8OHbVrnhIHmlCYH0wXs=,tag:LZeC2xrtNccXqMqdog6t6Q==,type:bool]
                storageClass: ENC[AES256_GCM,data:U/ns9UO3QPBnBQ==,iv:CDgaREDyZbFyzreBJp7Z7CgJ7Qejg8ylBsSx8vM1H08=,tag:fONmhWSPaUdYbC3iFLzstg==,type:str]
                accessMode: ENC[AES256_GCM,data:7S4iOx59YkRf7NmwVQ==,iv:HxQYLWcuXdymi3k23oQl2IA6ByxRxeoSrHy4GyYl/Lc=,tag:oUPGjxzI85UwJHZCzc/gfQ==,type:str]
                size: ENC[AES256_GCM,data:Kfba,iv:JhtAzqFkW3O2s0HenpeSkUl+C1jAWdBHkP2XyEXIjL8=,tag:VUoYfomeskK5me+lMARFSg==,type:str]
            htpasswd:
                enabled: true
                type: configMap
                name: '{{ printf "%v-config" (include "common.names.fullname" .) }}'
                subPath: htpasswd
                mountPath: /config/htpasswd
                readOnly: true
sops:
    kms: []
    gcp_kms: []
    azure_kv: []
    hc_vault: []
    age:
        - recipient: age1esjyg2qfy49awv0ptkzvpk425adczjr38m37w2mmcahzc4p8n54sll2nzh
          enc: |
            -----BEGIN AGE ENCRYPTED FILE-----
            YWdlLWVuY3J5cHRpb24ub3JnL3YxCi0+IFgyNTUxOSA3U0NXb2F2OTdKQ1pMOE1l
            akI3bUZTdXZFVDUvV2JDVTV6cmtxN09rM1VJCm1aRE5POTl5RGZKVFNiSldZSE9H
            SnJzemZNd2dQRWY0Z1BRdmN3Z3J5a0EKLS0tIDRMS0xhZ2J3bFBlSjRDZ1FySmQw
            cGE0Zmk3MWt3akZwVmd4YlhCb0R6bVkKxLaKKB5W11Jj4BY+T9rSecQtRqDfYekD
            X8SRsmNYuari63xGXpmYvaGvaLHfR1BdGZuXYh2s1QLoHZ09stC4og==
            -----END AGE ENCRYPTED FILE-----
    lastmodified: "2024-02-19T13:54:59Z"
    mac: ENC[AES256_GCM,data:88TDyYQomJiyed1hszGzx+lFTdI6Obq3JRJdp1BFpX/pKJ69fK6UKcKeI3HDXSoYODVeVYy/WWq3SIcyWfSskZYnG7UQu/jl2wQWjeDzSLNHdZPpqiiwUNFCR0Y8UoGWQRqUD4KAu9EcpYRD6Vx6JqPUWTiLc+gwke2f+f4niTQ=,iv:kdR5qSlANUWFSDA0/J7CPYnR8R8Te2cuw41Pp2j5rzw=,tag:kSeGFU/JPsdZv42jv/NWeQ==,type:str]
    pgp: []
    encrypted_regex: ^(secret_key|adminPassword|admin_pass|admin_email|mariadbPassword|mariadbRootPassword|privateKey|data|stringData|PASSWD|password|pass|postgresPassword|postgresqlPassword|redminePassword|smtpPassword|registration_shared_secret|shared_secret|secret)$
    version: 3.8.1
