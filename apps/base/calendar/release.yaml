apiVersion: helm.toolkit.fluxcd.io/v2beta1
kind: HelmRelease
metadata:
    name: radicale
    namespace: calendar
spec:
    interval: 5m
    chart:
        spec:
            chart: radicale
            sourceRef:
                kind: HelmRepository
                name: radicale
            interval: 60m
    install:
        crds: Create
    upgrade:
        crds: CreateReplace
        # Force recreation due to Helm not properly patching Deployment with e.g. added port,
        # causing spurious drift detection
        force: true
    values:
        env:
            # -- Set the container timezone
            TZ: Europe/Berlin
            # -- Set the location of the configuration file
            RADICALE_CONFIG: /config/config
        ingress:
            main:
                annotations:
                    cert-manager.io/cluster-issuer: letsencrypt-http
                enabled: true
                hosts:
                    - host: midnightthoughts.space
                      paths:
                        - path: /dav
                          pathType: Prefix
                          service:
                            port: 5232
                      tls:
                        - secretName: midnightthoughts.space-tls
                          hosts:
                            - midnightthoughts.space
        configmap:
            config:
                # -- Define inline radicale configuration as a ConfigMap.
                enabled: true
                # -- Radicale configuration. See [image documentation](https://github.com/tomsquest/docker-radicale#custom-configuration) for more information.
                # @default -- See values.yaml
                data:
                    config.cfg: ENC[AES256_GCM,data:hl2JxXtyMuc6AGUuPAQtRll8PLNCSkhEzpR6UHiJNMwEpfeCTIbTwazI1NsJ2mM+mIvMjs/o1zaaLGSdOxlemljMAX3zYLEPJc4yxNyHZINcxMyu2cmgCrgF6zwoU5e+ht8JBIgpQAun8dbnXTwXdq5K81yuZRU+nTx36u01e6vpEjvge8DbIjjNUlFp6WV9053cHwJBcp4EmyxnTsrgswKOMOeb5+MtePioiSMkqoVP4JhNN/eURfv3EqpCzCsKZAnJC1odjwM4esqJ1et6yrXt0Vm7TL9Miq/VJukJ85Amxg+iwF5vESxBI7hKKUQTydxhIhmZ23sfahSs8b5eyBuhXbh+ySa7WF0G25/v,iv:zlpN07W5auNioTOWfVEQJn8Fao7lfYZK2iB5ag9+DaM=,tag:st5yvOj1ijvcVQkPwBKtdA==,type:str]
                    htpasswd: ENC[AES256_GCM,data:c3Dfdiq1xXp54KW0BuQOab2zKc3E3itkxN5R5TQxOt5wOZKDaVONcuQI80w6FF4f0EhJb8Jbd+CmVNTT+H5q2lwKfspx,iv:t76NlvvKM1/w0cONbujHq2m/9ecxntWRGNfVTy6L6K4=,tag:YhmG5IDYJIxclvsO6N7QPw==,type:str]
        persistence:
            data:
                enabled: ENC[AES256_GCM,data:8zQdXw==,iv:CQitDkOL2ndm1JYR1V/JflFL9e1Anh8Yuhb1OEIMKuA=,tag:bwcALSlDwd10ttHLXEVLkw==,type:bool]
                storageClass: ENC[AES256_GCM,data:YpuNTA1Dy4E4qw==,iv:S19xVP74oQfIXiWd0cpL5mUHTMxkYbTSFfaoUPDS2ec=,tag:+3wutZ+HxEJf3hPtO/FOhQ==,type:str]
                accessMode: ENC[AES256_GCM,data:iSWll9yL5ve+actmDg==,iv:ccXaQVFa9hWhjEPfR+EisKMgnp1FsAu/USsdwvVDPWg=,tag:jHE45Lp4FPrnfap/nuIASg==,type:str]
            htpasswd:
                enabled: true
                type: configMap
                name: '{{ printf "%v-config" (include "common.names.fullname" .) }}'
                subPath: htpasswd
                mountPath: /config/htpasswd
                readOnly: true
sops:
    kms: []
    gcp_kms: []
    azure_kv: []
    hc_vault: []
    age:
        - recipient: age1esjyg2qfy49awv0ptkzvpk425adczjr38m37w2mmcahzc4p8n54sll2nzh
          enc: |
            -----BEGIN AGE ENCRYPTED FILE-----
            YWdlLWVuY3J5cHRpb24ub3JnL3YxCi0+IFgyNTUxOSBYQzVNR0s0WEkrNE5MZnkz
            bnBqK0luakNvaXBWWWxpN0gyTGQxUlRsa0dVClBPUFBDd0dFckFwQW9mM2ZPWVgz
            bDMrNEdXYzJaMU5IajU3VEdtWjMxYWcKLS0tIFVzV2xrY3NSTkZUTWVrQWZzL05a
            eVJ6UXVJU0NCVURldWJDQlhhRk8rNHMKIKDQ7cuQbUnqR7b++BE2K72tvNhQdVe6
            reO0C7J/mtG0/H16fV6ZRpl0kDMvxffD2n5fLlXiwWxn3GRXfaaNEg==
            -----END AGE ENCRYPTED FILE-----
    lastmodified: "2024-02-19T13:35:20Z"
    mac: ENC[AES256_GCM,data:NhkDIggfVxz4V3L6+uaSUwctQd8bxLdcIfNxhpjmJOS2mWB/9lNQu4tzWq1bslbXzuAHb1J5Ot2XP2+ZTgLbmcSaiMgMxQUqRi+rR3ebSvuLGmDRr3UMzS5YrrpAT69hkcDvSf1iZjOn8AjXqp2u8NQ2aQ7NPS7n5S2ZC1iiXjo=,iv:sbI8CRGszO2nvjiknbGtozasoNfKTMDWju1T5V86rog=,tag:78tWPkGq2qeKs9gGbkGqNg==,type:str]
    pgp: []
    encrypted_regex: ^(secret_key|adminPassword|admin_pass|admin_email|mariadbPassword|mariadbRootPassword|privateKey|data|stringData|PASSWD|password|pass|postgresPassword|postgresqlPassword|redminePassword|smtpPassword|registration_shared_secret|shared_secret|secret)$
    version: 3.8.1
