apiVersion: helm.toolkit.fluxcd.io/v2beta1
kind: HelmRelease
metadata:
    name: radicale
    namespace: calendar
spec:
    interval: 5m
    chart:
        spec:
            chart: radicale
            sourceRef:
                kind: HelmRepository
                name: radicale
            interval: 60m
    install:
        crds: Create
    upgrade:
        crds: CreateReplace
        # Force recreation due to Helm not properly patching Deployment with e.g. added port,
        # causing spurious drift detection
        force: true
    values:
        env:
            # -- Set the container timezone
            TZ: Europe/Berlin
            # -- Set the location of the configuration file
            RADICALE_CONFIG: /config/config
        ingress:
            main:
                annotations:
                    cert-manager.io/cluster-issuer: letsencrypt-http
                enabled: true
                hosts:
                    - host: midnightthoughts.space
                      paths:
                        - path: /dav
                          pathType: Prefix
                          service:
                            port: 5232
                      tls:
                        - secretName: midnightthoughts.space-tls
                          hosts:
                            - midnightthoughts.space
        configmap:
            config:
                # -- Define inline radicale configuration as a ConfigMap.
                enabled: true
                # -- Radicale configuration. See [image documentation](https://github.com/tomsquest/docker-radicale#custom-configuration) for more information.
                # @default -- See values.yaml
                data:
                    config.cfg: ENC[AES256_GCM,data:okL5X+Jnw872rBHKbIwwwb+Bi33XAAU77vxxbQmnONEnfaWCdVL789RebIX3MW5/PpLjwQ7eFmVmnStArWKCBr3fqCbMwpyJZs0DDPBfY8gRgvkla4JYHtXHMmcyxZv9reua4FHIYvAn0ds6p3L26+xHhzdcdG4/sXwIVylmoN1mhztrbqK2Hsfai1bBhYIbNN6Hm0OA1NCBY7ItbUEQeWuogxUBj3WooK+ut+gFacy+1RXobUgGnnoIveG6SSELTCPLV+PDd24lbCvwbhZAAJ/q3SNDcR1sakijom9EhP3I9dAY26KhhHs4zEOrTuVhkpPbinMmNf8dXb6VSCa73dS0Lr4FsysOfgZn2UFH1UadLYibFD4rcVztyyPYAXERwtDH42LT,iv:X2Y86YHXztH+JwS9mIYPPmjmR0HpKWWK9S6g6jCNS60=,tag:NBqXQDicGAav+Bj2OF1K1A==,type:str]
                    htpasswd: ENC[AES256_GCM,data:W+abCms8fDuCyiZDMBnShgtbReS+9nkdcovKl6PEaW8wFbiMSewfL2UAynAx2AWpadWVbSZxeYyFqvga9SE4vDrcsjLT,iv:Jz9zIZGZFzRNl/5Zyw3o72inOywmONtqR1ZllLXuvEk=,tag:0RuuZgHF2uAoS2t2HYp5Vg==,type:str]
        persistence:
            data:
                enabled: ENC[AES256_GCM,data:NMZqDw==,iv:+AvSNr0RZWsaioLCH7XyuIBSacKCmrw9VCNOU0OCCso=,tag:qeB1bNO3Rufu7MM5OD2/7g==,type:bool]
                storageClass: ENC[AES256_GCM,data:dr/sNfL52Qq6Hg==,iv:/aplFIxBzocdn57uxmPasC0NtNaI6RrldboGUpSUnKg=,tag:Bgq4Q4dFv5MqBzDTlTkiUA==,type:str]
                accessMode: ENC[AES256_GCM,data:G2kWjKwSinL18s/C6A==,iv:SzeUeugFxs4JLrMxlu28VpD2oAaCjxBxn2g/DCyV0Vo=,tag:UokJN9xdnwe9ZyGQl1A+mw==,type:str]
                size: ENC[AES256_GCM,data:l6mZ,iv:xONTQCZzrZBvQ4zeL4OWK4lyhvqjwamlvObzoXnyGzs=,tag:wbeAnYnbOfFJ9aSUhj5UyA==,type:str]
            htpasswd:
                enabled: true
                type: configMap
                name: '{{ printf "%v-config" (include "common.names.fullname" .) }}'
                subPath: htpasswd
                mountPath: /config/htpasswd
                readOnly: true
sops:
    kms: []
    gcp_kms: []
    azure_kv: []
    hc_vault: []
    age:
        - recipient: age1esjyg2qfy49awv0ptkzvpk425adczjr38m37w2mmcahzc4p8n54sll2nzh
          enc: |
            -----BEGIN AGE ENCRYPTED FILE-----
            YWdlLWVuY3J5cHRpb24ub3JnL3YxCi0+IFgyNTUxOSAzamZ5emhnK1h6VGpZS0xm
            VkFIVVNiTUtBR3RYR0xQdU5nTDlnUTgxd0JnCkN1WXpmRWI5bFRQWjZ5UE45Mjdn
            cVlDOGkrNXkvTmhYQnhwWFpXSCsxYXMKLS0tIHMzMnd1YXIxVkZraC9MVXhNMUpz
            UW1QU3JVSThsZitGd3J4RkRzNVlraHMK9NlvtsTyrmSjhdnfADiGpfKQfxTXTdQJ
            6B1C+iFjDOI6Fuq6FFxR2Us1SCQMiAYWOK7GQZKGDA0AstyQwoQc3w==
            -----END AGE ENCRYPTED FILE-----
    lastmodified: "2024-02-19T13:59:57Z"
    mac: ENC[AES256_GCM,data:qFy3jMYVl+4pV33OIn9mhWleaPdUqC5s2HVZZ0cbYPOAcG6TzMRmCUJAMeLbG1PJvMKIH7sodbA4kUKhwbfER2VuIVGekToD6eUZNcaUaFRLT+ca+lrO9HL77Fw7s+zVKKl/eeUTW7jbvmiKqOfbpmJhtvrUrHZm8VSPI0SDdCM=,iv:09Y3eH2n5pRAsZrP8Z8dplZSwd3g0GDC7ENLFdqIa08=,tag:eUpkBnYZhDTlti8BnWTa7g==,type:str]
    pgp: []
    encrypted_regex: ^(secret_key|adminPassword|admin_pass|admin_email|mariadbPassword|mariadbRootPassword|privateKey|data|stringData|PASSWD|password|pass|postgresPassword|postgresqlPassword|redminePassword|smtpPassword|registration_shared_secret|shared_secret|secret)$
    version: 3.8.1
