apiVersion: helm.toolkit.fluxcd.io/v2beta1
kind: HelmRelease
metadata:
    name: radicale
    namespace: calendar
spec:
    interval: 5m
    chart:
        spec:
            chart: radicale
            sourceRef:
                kind: HelmRepository
                name: radicale
            interval: 60m
    install:
        crds: Create
    upgrade:
        crds: CreateReplace
        # Force recreation due to Helm not properly patching Deployment with e.g. added port,
        # causing spurious drift detection
        force: true
    values:
        env:
            # -- Set the container timezone
            TZ: Europe/Berlin
            # -- Set the location of the configuration file
            RADICALE_CONFIG: /config/config
        ingress:
            main:
                annotations:
                    cert-manager.io/cluster-issuer: letsencrypt-http
                enabled: true
                hosts:
                    - host: midnightthoughts.space
                      paths:
                        - path: /dav
                          pathType: Prefix
                          service:
                            port: 5232
                      tls:
                        - secretName: midnightthoughts.space-tls
                          hosts:
                            - midnightthoughts.space
        configmap:
            config:
                # -- Define inline radicale configuration as a ConfigMap.
                enabled: true
                # -- Radicale configuration. See [image documentation](https://github.com/tomsquest/docker-radicale#custom-configuration) for more information.
                # @default -- See values.yaml
                data:
                    config.cfg: ENC[AES256_GCM,data:ADjA6z3kDCK2mFyTzn7E4GzdHvWrZ/8DxADxAibIg0lrIPg4EKJURqHabWk8mTudx3xciLih3xXdsMYBq39BYKZnZqeQjyyDeCn+aUvuq5yV6sVaGMyNTzMI6Ut4Myd1G3Sh2gi76IjAcEiZAkT1sL+dpVKGSRuMbDX/ZMROSlpQ8LBbQSDm95LLHX9ejk4YvK1BNLIEb5buag0Hi08zFKxqZE+MOYc2hj9572DDwcGUb4w+HentimaV3LNR9hcaF4TIZXP8PGZNmoHBeOR6b6j+dE6xoqKOyUiGJwUPCiaIj48fVAsoAWjLrNc+dr/m9eq/anKDj/5utKJyiO3N3c5v1Iex652evphgJr4y,iv:NVe0YQAdgyVJq2v8zD09xMSd88wNNP2y29FrO0c8SbQ=,tag:9PUqbG8B1zge6K+uvKiWSw==,type:str]
                    htpasswd: ENC[AES256_GCM,data:Qcdwwv4VIfbDaAvDIJFxz9hYZ2mT/MeYFqRXDx8vHhSfJ+tiE07zN/l8QxDZ2NLzC8Gv3Fjg1qCgmNiO5/OvZJtwQ3Qz,iv:Ig31h2fvG5j5zJIBY9HZpSSnw0YhErnl/QTNQ9wdgqc=,tag:/WOBD33ikmh86xLEHe4JSw==,type:str]
        persistence:
            data:
                enabled: ENC[AES256_GCM,data:MZXYgA==,iv:NHLBBAOG4PTCgN+cKZeKzkaOUlNSkTspQf4N025hO2M=,tag:ffJ1S9PGTy17DrhdKaXovg==,type:bool]
                storageClass: ENC[AES256_GCM,data:vXXhYuFExX3L3g==,iv:dFclA28kOhAPi9ljIqqTDaTmHSCJ3ricoDSiPSzdJHM=,tag:29l2CwiRgdaSD317ymDn+Q==,type:str]
                accessMode: ENC[AES256_GCM,data:SqUCDlri5pZhtapxCA==,iv:HZOfiugdXi29tYk77dXx048BrLjEbIxzSkUu2rcRcJE=,tag:dv/mJEh8LJ80Ay2EnFDCtw==,type:str]
                size: ENC[AES256_GCM,data:vc2b,iv:BkEqGjvx3BmzohNaXioU4vobEP2UmajTJ8aeeLUeinw=,tag:GG7+kx+iV4On+F0uLguFxg==,type:str]
            htpasswd:
                enabled: true
                type: configMap
                name: '{{ printf "%v-config" (include "common.names.fullname" .) }}'
                subPath: htpasswd
                mountPath: /config/htpasswd
                readOnly: true
sops:
    kms: []
    gcp_kms: []
    azure_kv: []
    hc_vault: []
    age:
        - recipient: age1esjyg2qfy49awv0ptkzvpk425adczjr38m37w2mmcahzc4p8n54sll2nzh
          enc: |
            -----BEGIN AGE ENCRYPTED FILE-----
            YWdlLWVuY3J5cHRpb24ub3JnL3YxCi0+IFgyNTUxOSBOUFVMM1poYThiZnI3Qll1
            NUNzUzJ3MHpseDZqVURmT0tLU0FpVE1meHlBClZvdDZnbklZbWFaOE84R01XR3Ny
            NFFqd25mS0NoMVovL3VKa3BubHlXOFUKLS0tIGFhK29kNjA4V20rdnUzUlRRSlE0
            dEZwT3lVeEE4MkdoMlFXL2FnclBoaUkK87i690npjukFA0Juiuzf+dXg/OlMpKxh
            MoG2dSIKPzKE6l8hyOCc/C2Ta3BohyLMcbn1FRCqF0Gm9t+VzdUFBQ==
            -----END AGE ENCRYPTED FILE-----
    lastmodified: "2024-02-19T13:47:55Z"
    mac: ENC[AES256_GCM,data:Nl9wTtQTuUKDF7LJUK/4CPCQNS9GKOTN8Q6L/0sIh4DIAKeuGUhD/lPRb8hnGK1H/eg/9USoFcG9xBp2EeZUAkLAvscgyeblfqRQmOB77KxadpYTdtIQgkDD7hayYl9tL+vWDozidg75XknopaAkDtW65DfMlkXfofQecoWx09g=,iv:BHqM+rAkltmyN4Y8QMz35GyBgD8zqVWs3l8w5jksVpQ=,tag:mhTfDyOBERIuwhszCV9utw==,type:str]
    pgp: []
    encrypted_regex: ^(secret_key|adminPassword|admin_pass|admin_email|mariadbPassword|mariadbRootPassword|privateKey|data|stringData|PASSWD|password|pass|postgresPassword|postgresqlPassword|redminePassword|smtpPassword|registration_shared_secret|shared_secret|secret)$
    version: 3.8.1
