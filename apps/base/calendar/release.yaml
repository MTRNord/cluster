apiVersion: helm.toolkit.fluxcd.io/v2beta1
kind: HelmRelease
metadata:
    name: radicale
    namespace: calendar
spec:
    interval: 5m
    chart:
        spec:
            chart: radicale
            sourceRef:
                kind: HelmRepository
                name: radicale
            interval: 60m
    install:
        crds: Create
    upgrade:
        crds: CreateReplace
        # Force recreation due to Helm not properly patching Deployment with e.g. added port,
        # causing spurious drift detection
        force: true
    values:
        env:
            # -- Set the container timezone
            TZ: Europe/Berlin
            # -- Set the location of the configuration file
            RADICALE_CONFIG: /config/config
        ingress:
            main:
                annotations:
                    cert-manager.io/cluster-issuer: letsencrypt-http
                enabled: true
                hosts:
                    - host: midnightthoughts.space
                      paths:
                        - path: /dav
                          pathType: Prefix
                          service:
                            port: 5232
                      tls:
                        - secretName: midnightthoughts.space-tls
                          hosts:
                            - midnightthoughts.space
        configmap:
            config:
                # -- Define inline radicale configuration as a ConfigMap.
                enabled: true
                # -- Radicale configuration. See [image documentation](https://github.com/tomsquest/docker-radicale#custom-configuration) for more information.
                # @default -- See values.yaml
                data:
                    config.cfg: ENC[AES256_GCM,data:3w141ztaU+4VpT9Htq9xp221GIMLDmdzC6xfcoquKAhsdH26XBkfJtu27VIk5PhVLBY7qkKFSbfAXSKHZbWSBvLevMasv0V1WTy5rOMIKpIH9UGiWh2K29G070e7n0/tAkke4abSyMgQf/1sN5Hqty05BSOXpQJMbP5lkB5ce5kFPLFODX/XvHmU4EdWsctY29wVWo0Ljd1bso0ZgtBy3F+3M/btcvD/loGnplqTkxZy5kdTpp9x9NPiltwxKfh2FUvBDjoccuw6h8ZAzHMyOvM/MiT+bYI3rISxfj47uNK+64aOO9fR+NJPglUUoB1V2Ps5nfDtpq/SRlUos1MmLad3wYrlT9VJ1PkCqUKT,iv:CcKleTuW9zQhB7cnGHvp3HYZAJ/oeR2jnhpiFSf2gjs=,tag:YsHNkMr3IOenmyeBli1HyQ==,type:str]
                    htpasswd: ENC[AES256_GCM,data:RtaRUIkeVrURmxdN5L7aSfXsZuLANDBSavjRD9r4X0cNsySKHDaknf5XuOfLtaI/vqFt7pkIyUmNBjlWllCm9/cs7WMD,iv:rJkon3ckG3Qfbk0Ogp2b80AKIK2pN/ZjyTBEXgrbIBA=,tag:Z82ZKkOL4viXPuTYAJi1fw==,type:str]
        persistence:
            data:
                enabled: ENC[AES256_GCM,data:soyJuQ==,iv:aCtQ7IOf0j670vcNWW1OVqCjoI8wai8OJOQvAIL2tFo=,tag:141GsxqW9lCtGABE2CCl7Q==,type:bool]
                storageClass: ENC[AES256_GCM,data:OLHksqLZi8D2ng==,iv:sgVPDKdB4ZLevQCOYEhEF96q+1NlfKeYKh+2ayWt8Zs=,tag:61Yrr684yqPJvqB67VvAYQ==,type:str]
                accessMode: ENC[AES256_GCM,data:5calokJIHcrzhevqhA==,iv:fGh4ajsNPL+3gfU5UBBctHsdJ70WAsL0qxIE95KNkr4=,tag:2cyPq1O8q0Y1I6Bb+eS1iA==,type:str]
                size: ENC[AES256_GCM,data:R1Od,iv:c6nMQ6JOzg6RaPjRd4DZJqwRZa7oYiGYZrG6Qhq4zY4=,tag:bL1DEv7pMHmRHcM4eTJz1w==,type:str]
            htpasswd:
                enabled: true
                type: configMap
                name: '{{ printf "%v-config" (include "common.names.fullname" .) }}'
                subPath: htpasswd
                mountPath: /config/htpasswd
                readOnly: true
sops:
    kms: []
    gcp_kms: []
    azure_kv: []
    hc_vault: []
    age:
        - recipient: age1esjyg2qfy49awv0ptkzvpk425adczjr38m37w2mmcahzc4p8n54sll2nzh
          enc: |
            -----BEGIN AGE ENCRYPTED FILE-----
            YWdlLWVuY3J5cHRpb24ub3JnL3YxCi0+IFgyNTUxOSBEVklLeWtZazdqQis1OHdh
            S1ZZVDAzZldwdWczUkg4VC9UcHNJVzIwZmtVCkdVcy9QN1F3WTJzbzJrUDJTeFE0
            Sk1qTWlmS3cxUUdzaldVeEMyU3ZoZEEKLS0tIHh3THVMYVZSV0p5c0xDTmY0bDVk
            S3RJOTFTYXAxU3RPTnhMeDBvdG83eU0KZqrjl7kuwO+fZM2P4oDLoInN6RBfdlgN
            v+LH2JyjUF2s03tSt9hO+dWKOhoypjDu6oKlLK4xvc3e3AKexHq9yA==
            -----END AGE ENCRYPTED FILE-----
    lastmodified: "2024-02-19T13:41:03Z"
    mac: ENC[AES256_GCM,data:uGIcdqb/OtpI4cGqQKOMznykueOTrqDzFTfx7O7J2kRX//AbQDq6StRqdhFm3/KyZTCwCnFxjINpsoxYg2jDxjtcPACckA5qOyAQF17uGW+V80wpP+ZVmcU8iFOrQpqfwEh/XG24jd/WdrXqwEQWzrWUZVp3QiNjsCFs4JprBZI=,iv:Oy+zMAM2g8p51Aofneqvx5rftUVi6L4c6I7TPUvdkPo=,tag:lR/i/sx0fE3Jz9ccjMExsQ==,type:str]
    pgp: []
    encrypted_regex: ^(secret_key|adminPassword|admin_pass|admin_email|mariadbPassword|mariadbRootPassword|privateKey|data|stringData|PASSWD|password|pass|postgresPassword|postgresqlPassword|redminePassword|smtpPassword|registration_shared_secret|shared_secret|secret)$
    version: 3.8.1
