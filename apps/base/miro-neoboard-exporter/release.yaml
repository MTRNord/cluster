apiVersion: v1
kind: Secret
metadata:
    name: miro-neoboard-exporter-secret
    namespace: neoboard
type: Opaque
stringData:
    MIRO_CLIENT_ID: ENC[AES256_GCM,data:6nx8PYImHxPmZw+B2qdN0Hblbw==,iv:ehLuwtDu6QA/fkMPvOVCMSP92ogkyBBilx7MSiu/GWQ=,tag:gkzyNShRqHy/BM4KpbrWMw==,type:str]
    MIRO_CLIENT_SECRET: ENC[AES256_GCM,data:wAHwJ2WkoObCHIdq4wJS94nFUDpC4w1ym4MexvtwEeI=,iv:b+wouTeSm6ViKSMUgfLtLIziNm9wQyHRuaJMAHkMHNk=,tag:fKQ5Sfqyl4YmSr5ekHcVJQ==,type:str]
    MIRO_REDIRECT_URL: ENC[AES256_GCM,data:WZ+7RnwRbaVEyFs6OcajF3LueVOKOcc2e9V1OIDGGVKVSeYY6FzNaesXO7Q4gQiJZHcTgPV+Fcc61DTmfO8MFg==,iv:OwUTV3OLDnL/f5kuzwS6swh8juakvYhCGOKZIPmcPSQ=,tag:uNv1Na0m9leMh/XHb804PA==,type:str]
sops:
    kms: []
    gcp_kms: []
    azure_kv: []
    hc_vault: []
    age:
        - recipient: age1esjyg2qfy49awv0ptkzvpk425adczjr38m37w2mmcahzc4p8n54sll2nzh
          enc: |
            -----BEGIN AGE ENCRYPTED FILE-----
            YWdlLWVuY3J5cHRpb24ub3JnL3YxCi0+IFgyNTUxOSAvR3B6Q3VtcHUvV1U1RWhF
            cExaV0JJc0Yrem5iRXZOeUNBNVBUTzBHQkI0CitNeTc5R3hRdVVSeXRpTUhUMFRQ
            K2dTbTlCWEk1SDNaSUJ6VFFITm15WU0KLS0tIDNyaVVHUnNialNWOERrMDNCbCt4
            QVRDN1hwaGdUZzlzOFNFTlR0L2xJUW8K/QvSlpDo3ZnUERMOoJD3rD0fM5Oi+ko/
            X3Oz4wFpPPbMtFA/7ASOW5XB9n6WRyAtZN1NuMt5o4qsKmP4FQ/kQQ==
            -----END AGE ENCRYPTED FILE-----
    lastmodified: "2025-01-13T14:40:08Z"
    mac: ENC[AES256_GCM,data:QAtMQPpf3bvs+qdsMchXbowwtyRTnkLjBohV95SBI6oqJ9xMEmtqASKD64NSPoNeJaXmCyhvUAwFfodCE3fZNJf9ARynvy4hdT5YVuLtDQ+PFwArYBhXljnNyxk71/OsVpMYNg3cBtHzlpJZjeUMU2H3GHuAcbvbQLHi6C00v4M=,iv:mru17UYWxq2/16fpvB1Fy/RlaIy2XwzDg/+WE9VKDfE=,tag:eZ9LjnauzH1tA4gE0dQblQ==,type:str]
    pgp: []
    encrypted_regex: ^(adminPassword|adminEmail|jenkinsAdminEmail|securityRealm|gerrit.config|routing_key|DATABASE_URL|SMTP_PASSWORD|SECRET_KEY_BASE|admin_password|extraCommands|key|clickhouseDatabaseURL|databaseURL|client_id|client_secret|secret_key_base|otp_secret|private_key|public_key|primaryKey|deterministicKey|keyDerivationSalt|token|clientId|secretKey|installationId|installationKey|uriOverride|adminToken.value|password.value|sql_password|erlangCookie|AUTHENTICATION_PASSWORD|ROOM_API_SECRET_KEY|adminPassword|configPassword|adminUser|configUser|MAIL_PASSWORD|APP_KEY|api_key|api_secret|keys|livekit_key|livekit_secret|secret_key|admin_pass|admin_email|mariadbPassword|mariadbRootPassword|privateKey|data|stringData|PASSWD|password|pass|postgresPassword|postgresqlPassword|redminePassword|smtpPassword|registration_shared_secret|shared_secret|secret|admin_token|integrationKey|rootPassword)$
    version: 3.9.1
---
apiVersion: apps/v1
kind: Deployment
metadata:
    name: miro-neoboard-exporter
    namespace: neoboard
spec:
    replicas: 1
    selector:
        matchLabels:
            app: miro-neoboard-exporter
    template:
        metadata:
            labels:
                app: miro-neoboard-exporter
        spec:
            containers:
                - name: miro-neoboard-exporter
                  image: ghcr.io/mtrnord/neoboard-exporter:latest
                  imagePullPolicy: Always
                  ports:
                    - containerPort: 3000
                  envFrom:
                    - secretRef:
                        name: miro-neoboard-exporter-secret
                  volumeMounts:
                    - name: env-file
                      mountPath: /app/.env
                      subPath: .env
                  livenessProbe:
                    httpGet:
                        path: /
                        port: 3000
                    initialDelaySeconds: 30
                    periodSeconds: 10
                    timeoutSeconds: 5
                    successThreshold: 1
                    failureThreshold: 3
                  readinessProbe:
                    httpGet:
                        path: /
                        port: 3000
                    initialDelaySeconds: 30
                    periodSeconds: 10
                    timeoutSeconds: 5
                    successThreshold: 1
                    failureThreshold: 3
            volumes:
                - name: env-file
                  secret:
                    secretName: ENC[AES256_GCM,data:07EjhD/4XnTcHPWNel4Snhg2TTMTXM30W3FbKNM=,iv:eM8Dx9gZL3XkN3SUgHiT814s0gj9gDYZdn+RG/hERYU=,tag:WIKttokZnBt8JG0Wp2VF8w==,type:str]
                    items:
                        - key: ENC[AES256_GCM,data:ZpyoeQ5d+FdCexaP8aY=,iv:o2CPC4VByu72al2p4rkkSzhdA+VDv4/YEof0GWJaAtE=,tag:w6YQqOO4QnDhr1qSOzsXwQ==,type:str]
                          path: ENC[AES256_GCM,data:xMuylQ==,iv:pOsJDF8O6I9TmlToY6rBVPJYBsWAGmLLr1IuG0QOH0A=,tag:30a3gomdK5Uf3eHxYZmyDA==,type:str]
                        - key: ENC[AES256_GCM,data:66OW/9mdYDiWK+VNJNloYvkF,iv:4W+3l4VNQAL1DADwihHxS1W4Yyky6yNYNwoRmQMJsEI=,tag:E/3P29QEdms2qBZQSi/BdQ==,type:str]
                          path: ENC[AES256_GCM,data:JDtLNw==,iv:/Tw1i/AVpSCnL0Sk/o07Ufgqlnc2AuUkesPbE2q0BR4=,tag:U5uOXIqpPZBg9NSuRZBlew==,type:str]
                        - key: ENC[AES256_GCM,data:iN914rikXK6hY/swTMmNHN4=,iv:LWv6SV4Jiu5gMHGi4nKwVi9sZDi4wWAUfAoChnN7jyo=,tag:mRtseVpjj9Z/kQqHzc6TTw==,type:str]
                          path: ENC[AES256_GCM,data:Q3phuQ==,iv:C60jWsN2aOMcqmbSADaUxqoGiDEx8ZCverF9VNQwzt0=,tag:bSIspqM/RomcDu1W9JXqgw==,type:str]
sops:
    kms: []
    gcp_kms: []
    azure_kv: []
    hc_vault: []
    age:
        - recipient: age1esjyg2qfy49awv0ptkzvpk425adczjr38m37w2mmcahzc4p8n54sll2nzh
          enc: |
            -----BEGIN AGE ENCRYPTED FILE-----
            YWdlLWVuY3J5cHRpb24ub3JnL3YxCi0+IFgyNTUxOSAvR3B6Q3VtcHUvV1U1RWhF
            cExaV0JJc0Yrem5iRXZOeUNBNVBUTzBHQkI0CitNeTc5R3hRdVVSeXRpTUhUMFRQ
            K2dTbTlCWEk1SDNaSUJ6VFFITm15WU0KLS0tIDNyaVVHUnNialNWOERrMDNCbCt4
            QVRDN1hwaGdUZzlzOFNFTlR0L2xJUW8K/QvSlpDo3ZnUERMOoJD3rD0fM5Oi+ko/
            X3Oz4wFpPPbMtFA/7ASOW5XB9n6WRyAtZN1NuMt5o4qsKmP4FQ/kQQ==
            -----END AGE ENCRYPTED FILE-----
    lastmodified: "2025-01-13T14:40:08Z"
    mac: ENC[AES256_GCM,data:QAtMQPpf3bvs+qdsMchXbowwtyRTnkLjBohV95SBI6oqJ9xMEmtqASKD64NSPoNeJaXmCyhvUAwFfodCE3fZNJf9ARynvy4hdT5YVuLtDQ+PFwArYBhXljnNyxk71/OsVpMYNg3cBtHzlpJZjeUMU2H3GHuAcbvbQLHi6C00v4M=,iv:mru17UYWxq2/16fpvB1Fy/RlaIy2XwzDg/+WE9VKDfE=,tag:eZ9LjnauzH1tA4gE0dQblQ==,type:str]
    pgp: []
    encrypted_regex: ^(adminPassword|adminEmail|jenkinsAdminEmail|securityRealm|gerrit.config|routing_key|DATABASE_URL|SMTP_PASSWORD|SECRET_KEY_BASE|admin_password|extraCommands|key|clickhouseDatabaseURL|databaseURL|client_id|client_secret|secret_key_base|otp_secret|private_key|public_key|primaryKey|deterministicKey|keyDerivationSalt|token|clientId|secretKey|installationId|installationKey|uriOverride|adminToken.value|password.value|sql_password|erlangCookie|AUTHENTICATION_PASSWORD|ROOM_API_SECRET_KEY|adminPassword|configPassword|adminUser|configUser|MAIL_PASSWORD|APP_KEY|api_key|api_secret|keys|livekit_key|livekit_secret|secret_key|admin_pass|admin_email|mariadbPassword|mariadbRootPassword|privateKey|data|stringData|PASSWD|password|pass|postgresPassword|postgresqlPassword|redminePassword|smtpPassword|registration_shared_secret|shared_secret|secret|admin_token|integrationKey|rootPassword)$
    version: 3.9.1
---
apiVersion: v1
kind: Service
metadata:
    name: miro-neoboard-exporter-service
spec:
    selector:
        app: miro-neoboard-exporter
    ports:
        - protocol: TCP
          port: 80
          targetPort: 3000
sops:
    kms: []
    gcp_kms: []
    azure_kv: []
    hc_vault: []
    age:
        - recipient: age1esjyg2qfy49awv0ptkzvpk425adczjr38m37w2mmcahzc4p8n54sll2nzh
          enc: |
            -----BEGIN AGE ENCRYPTED FILE-----
            YWdlLWVuY3J5cHRpb24ub3JnL3YxCi0+IFgyNTUxOSAvR3B6Q3VtcHUvV1U1RWhF
            cExaV0JJc0Yrem5iRXZOeUNBNVBUTzBHQkI0CitNeTc5R3hRdVVSeXRpTUhUMFRQ
            K2dTbTlCWEk1SDNaSUJ6VFFITm15WU0KLS0tIDNyaVVHUnNialNWOERrMDNCbCt4
            QVRDN1hwaGdUZzlzOFNFTlR0L2xJUW8K/QvSlpDo3ZnUERMOoJD3rD0fM5Oi+ko/
            X3Oz4wFpPPbMtFA/7ASOW5XB9n6WRyAtZN1NuMt5o4qsKmP4FQ/kQQ==
            -----END AGE ENCRYPTED FILE-----
    lastmodified: "2025-01-13T14:40:08Z"
    mac: ENC[AES256_GCM,data:QAtMQPpf3bvs+qdsMchXbowwtyRTnkLjBohV95SBI6oqJ9xMEmtqASKD64NSPoNeJaXmCyhvUAwFfodCE3fZNJf9ARynvy4hdT5YVuLtDQ+PFwArYBhXljnNyxk71/OsVpMYNg3cBtHzlpJZjeUMU2H3GHuAcbvbQLHi6C00v4M=,iv:mru17UYWxq2/16fpvB1Fy/RlaIy2XwzDg/+WE9VKDfE=,tag:eZ9LjnauzH1tA4gE0dQblQ==,type:str]
    pgp: []
    encrypted_regex: ^(adminPassword|adminEmail|jenkinsAdminEmail|securityRealm|gerrit.config|routing_key|DATABASE_URL|SMTP_PASSWORD|SECRET_KEY_BASE|admin_password|extraCommands|key|clickhouseDatabaseURL|databaseURL|client_id|client_secret|secret_key_base|otp_secret|private_key|public_key|primaryKey|deterministicKey|keyDerivationSalt|token|clientId|secretKey|installationId|installationKey|uriOverride|adminToken.value|password.value|sql_password|erlangCookie|AUTHENTICATION_PASSWORD|ROOM_API_SECRET_KEY|adminPassword|configPassword|adminUser|configUser|MAIL_PASSWORD|APP_KEY|api_key|api_secret|keys|livekit_key|livekit_secret|secret_key|admin_pass|admin_email|mariadbPassword|mariadbRootPassword|privateKey|data|stringData|PASSWD|password|pass|postgresPassword|postgresqlPassword|redminePassword|smtpPassword|registration_shared_secret|shared_secret|secret|admin_token|integrationKey|rootPassword)$
    version: 3.9.1
---
apiVersion: networking.k8s.io/v1
kind: Ingress
metadata:
    name: miro-neoboard-exporter-ingress
    annotations:
        cert-manager.io/cluster-issuer: letsencrypt-dns
        external-dns.alpha.kubernetes.io/hostname: midnightthoughts.space
spec:
    rules:
        - host: miro-export.neoboard.midnightthoughts.space
          http:
            paths:
                - path: /
                  pathType: Prefix
                  backend:
                    service:
                        name: miro-neoboard-exporter-service
                        port:
                            number: 80
    tls:
        - hosts:
            - miro-export.neoboard.midnightthoughts.space
          secretName: miro-export-neoboard-ingress-tls
sops:
    kms: []
    gcp_kms: []
    azure_kv: []
    hc_vault: []
    age:
        - recipient: age1esjyg2qfy49awv0ptkzvpk425adczjr38m37w2mmcahzc4p8n54sll2nzh
          enc: |
            -----BEGIN AGE ENCRYPTED FILE-----
            YWdlLWVuY3J5cHRpb24ub3JnL3YxCi0+IFgyNTUxOSAvR3B6Q3VtcHUvV1U1RWhF
            cExaV0JJc0Yrem5iRXZOeUNBNVBUTzBHQkI0CitNeTc5R3hRdVVSeXRpTUhUMFRQ
            K2dTbTlCWEk1SDNaSUJ6VFFITm15WU0KLS0tIDNyaVVHUnNialNWOERrMDNCbCt4
            QVRDN1hwaGdUZzlzOFNFTlR0L2xJUW8K/QvSlpDo3ZnUERMOoJD3rD0fM5Oi+ko/
            X3Oz4wFpPPbMtFA/7ASOW5XB9n6WRyAtZN1NuMt5o4qsKmP4FQ/kQQ==
            -----END AGE ENCRYPTED FILE-----
    lastmodified: "2025-01-13T14:40:08Z"
    mac: ENC[AES256_GCM,data:QAtMQPpf3bvs+qdsMchXbowwtyRTnkLjBohV95SBI6oqJ9xMEmtqASKD64NSPoNeJaXmCyhvUAwFfodCE3fZNJf9ARynvy4hdT5YVuLtDQ+PFwArYBhXljnNyxk71/OsVpMYNg3cBtHzlpJZjeUMU2H3GHuAcbvbQLHi6C00v4M=,iv:mru17UYWxq2/16fpvB1Fy/RlaIy2XwzDg/+WE9VKDfE=,tag:eZ9LjnauzH1tA4gE0dQblQ==,type:str]
    pgp: []
    encrypted_regex: ^(adminPassword|adminEmail|jenkinsAdminEmail|securityRealm|gerrit.config|routing_key|DATABASE_URL|SMTP_PASSWORD|SECRET_KEY_BASE|admin_password|extraCommands|key|clickhouseDatabaseURL|databaseURL|client_id|client_secret|secret_key_base|otp_secret|private_key|public_key|primaryKey|deterministicKey|keyDerivationSalt|token|clientId|secretKey|installationId|installationKey|uriOverride|adminToken.value|password.value|sql_password|erlangCookie|AUTHENTICATION_PASSWORD|ROOM_API_SECRET_KEY|adminPassword|configPassword|adminUser|configUser|MAIL_PASSWORD|APP_KEY|api_key|api_secret|keys|livekit_key|livekit_secret|secret_key|admin_pass|admin_email|mariadbPassword|mariadbRootPassword|privateKey|data|stringData|PASSWD|password|pass|postgresPassword|postgresqlPassword|redminePassword|smtpPassword|registration_shared_secret|shared_secret|secret|admin_token|integrationKey|rootPassword)$
    version: 3.9.1
