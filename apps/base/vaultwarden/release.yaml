apiVersion: helm.toolkit.fluxcd.io/v2beta2
kind: HelmRelease
metadata:
    name: vaultwarden
    namespace: vaultwarden
spec:
    releaseName: vaultwarden
    chart:
        spec:
            version: 0.31.8
            chart: vaultwarden
            sourceRef:
                kind: HelmRepository
                name: vaultwarden
    interval: 50m
    install:
        remediation:
            retries: 3
    values:
        pushNotifications:
            installationId:
                value: ENC[AES256_GCM,data:iTZubdJ98swGTmrKOVKLnGAfIlk3FHTPB26h2V7cJQtATIK3,iv:RXboXM5a8umeJLJO9ohljLOXy1/UJ72xh2tRR7dziwk=,tag:iaYTE+4EMcHohYo1MYv36Q==,type:str]
            installationKey:
                value: ENC[AES256_GCM,data:Kl80VSuAfOEoKij5oOFgwiDQgtA=,iv:voe87dofqnpE0h3sIYToqOPvOGNF9gK/nTdv3eqIB0M=,tag:UJ+iL5BfhU8qqK6zSGZmWw==,type:str]
            relayUri: https://push.bitwarden.eu
            identityUri: https://identity.bitwarden.eu
        signupsAllowed: false
        domain: https://vault.midnightthoughts.space
        signupDomains: nordgedanken.dev,gmail.com
        timeZone: Europe/Berlin
        database:
            type: postgresql
            uriOverride: ENC[AES256_GCM,data:9h2zyS+BqqkZ9wnGviTgJZ7btNNsHjXrIlqa5k0oSLAa8BaBhrEv3ksTY0HtYn88Ujws47Vrs1HNqZ1MJvUbmxCro0Gau/wI1pJysdl8djhFR6YPCBuO62grgXSJVBzVNdi7rZHNnswPc57NHpSOq5H9vqc2GenQaUIY3ag0WBmzya70zsyV0DgvfDdGSIJ4mvXNBeAAbuy3MygxLWw=,iv:zLcfOivbzG6oHSzInjaPyP/+Vk26+l4Lc8oFGfQ3zfs=,tag:G61yk2qSY+j5rDUY9BhhiQ==,type:str]
        ingress:
            enabled: false
            additionalAnnotations:
                external-dns.alpha.kubernetes.io/hostname: vault.midnightthoughts.space
                cert-manager.io/cluster-issuer: letsencrypt-dns
            tlsSecret: vault.midnightthoughts.space-crt
            hostname: vault.midnightthoughts.space
            nginxIngressAnnotations: false
            class: traefik
        adminToken:
            value: $argon2id$v=19$m=19456,t=2,p=1$R0VoUlJ2T3I5UDRiL0h0cGgvTzYwbHhIL0poeFNpWmkzZThPUDh3TnNtND0$dm7crNLYaQFcGS7KZ38aKTyrV+E2RdyYKx1wDSjpu4s
        smtp:
            host: mail.midnightthoughts.space
            from: support@midnightthoughts.space
            fromName: Vault Administrator
            username:
                value: support@midnightthoughts.space
            password:
                value: ENC[AES256_GCM,data:dtRtjwzZaXxaGuTOQDIaEyYtkt0y3Ju6+jLdBMQ5lKo56dPxYgDxzaB42zefDgwpiu/CHGsg+mmRJ10c4v+35g==,iv:8yN1NWZxTXTWRpi8OKxZMmgG5wkuXLNwXE7/1jE34xg=,tag:5ARFS/MLHVsidashSwFy8w==,type:str]
            security: force_tls
            port: 465
        data:
            name: ENC[AES256_GCM,data:hl2WjRTRndzsCfABM7hTLA==,iv:4JL9mWDYfRto85lai4daNh5U2TgxtdqBpXm1JErjEbk=,tag:V2X2ZyLdRT/NVm0ju9DNuA==,type:str]
            size: ENC[AES256_GCM,data:0AFo,iv:6HWI1Bs7kKPHqnqxvzziAzcM0B08+NpYn3BhsWASnTo=,tag:MTuF2lZOdS7W0N2EFqaGtA==,type:str]
            accessMode: ENC[AES256_GCM,data:EwH3tSYBVWoo6jAEgg==,iv:EO0lBE4YYBLp1LMlzMEj+0Y3f4aGHGuxolP1K/wbM7k=,tag:xchYk9x5VFVreIsCnW76vA==,type:str]
            keepPvc: ENC[AES256_GCM,data:FkYZyQ==,iv:4MobKpfk0dhrV5cafzq8GJiZyz3bLRNVwMgqmX4WaCo=,tag:ayvd388LmUaLYSUdbL38dw==,type:bool]
        resources:
            requests:
                cpu: 50m
                memory: 256Mi
sops:
    kms: []
    gcp_kms: []
    azure_kv: []
    hc_vault: []
    age:
        - recipient: age1esjyg2qfy49awv0ptkzvpk425adczjr38m37w2mmcahzc4p8n54sll2nzh
          enc: |
            -----BEGIN AGE ENCRYPTED FILE-----
            YWdlLWVuY3J5cHRpb24ub3JnL3YxCi0+IFgyNTUxOSBJbGRaNlRDdTVzRWxqRTJ1
            eTVWcVBoOXU3S09lRFhvZU1DOWYrRStPNUVRCnVlenNsWFJHb09QUjByRExwb29r
            dFhheVlpTExGeDZyM3h2SVFhR28yNGcKLS0tIGlJU2ZnWEZiaWxKT0R3NDFRS3lw
            ZjkwMTU1bmo4bVZSLzNoMTB5aEJJWncKlIMi5RLZuT4lMXKhGNGwTCgYpPHFHVHt
            +JHucGxVBTjq5cQUgfz35lRl80y2j5yXgCYtvZdMiHhbZMld8BWDGw==
            -----END AGE ENCRYPTED FILE-----
    lastmodified: "2025-03-19T13:15:36Z"
    mac: ENC[AES256_GCM,data:QhaK4v48I0IHScwOg0F1PUq+cM0wxoVGDrmnLSG8bgxWgqik/QileLykDFMHk4vpOl+BkobF1iCK5RAr/YRCGp3un0rjybXCUEx728x8zW5GX9cvAzpPMVWoNdPlI8w4w5RBPC5/rDkyn5Z4v4xgZ4vuY/cUuOhXIG80Ayq4Fgw=,iv:cTNUqdmGzSv2OO22zXTsVRrp56tfj9P6BqbYMMuJNt4=,tag:FUXROknb9UXNjSQxAKKtPA==,type:str]
    pgp: []
    encrypted_regex: ^(adminPassword|adminEmail|jenkinsAdminEmail|securityRealm|gerrit.config|routing_key|DATABASE_URL|SMTP_PASSWORD|SECRET_KEY_BASE|admin_password|extraCommands|key|clickhouseDatabaseURL|databaseURL|client_id|client_secret|secret_key_base|otp_secret|private_key|public_key|primaryKey|deterministicKey|keyDerivationSalt|token|clientId|secretKey|installationId|installationKey|uriOverride|adminToken.value|password.value|sql_password|erlangCookie|AUTHENTICATION_PASSWORD|ROOM_API_SECRET_KEY|adminPassword|configPassword|adminUser|configUser|MAIL_PASSWORD|APP_KEY|api_key|api_secret|keys|livekit_key|livekit_secret|secret_key|admin_pass|admin_email|mariadbPassword|mariadbRootPassword|privateKey|data|stringData|PASSWD|password|pass|postgresPassword|postgresqlPassword|redminePassword|smtpPassword|registration_shared_secret|shared_secret|secret|admin_token|integrationKey|rootPassword)$
    version: 3.9.1
---
apiVersion: gateway.networking.k8s.io/v1
kind: HTTPRoute
metadata:
    name: vaultwarden
    namespace: vaultwarden
spec:
    parentRefs:
        - name: envoy-gateway
          namespace: envoy-gateway
    hostnames:
        - vault.midnightthoughts.space
    rules:
        - backendRefs:
            - name: vaultwarden
              port: 80
          timeouts:
            request: 240s
            backendRequest: 0s
sops:
    kms: []
    gcp_kms: []
    azure_kv: []
    hc_vault: []
    age:
        - recipient: age1esjyg2qfy49awv0ptkzvpk425adczjr38m37w2mmcahzc4p8n54sll2nzh
          enc: |
            -----BEGIN AGE ENCRYPTED FILE-----
            YWdlLWVuY3J5cHRpb24ub3JnL3YxCi0+IFgyNTUxOSBJbGRaNlRDdTVzRWxqRTJ1
            eTVWcVBoOXU3S09lRFhvZU1DOWYrRStPNUVRCnVlenNsWFJHb09QUjByRExwb29r
            dFhheVlpTExGeDZyM3h2SVFhR28yNGcKLS0tIGlJU2ZnWEZiaWxKT0R3NDFRS3lw
            ZjkwMTU1bmo4bVZSLzNoMTB5aEJJWncKlIMi5RLZuT4lMXKhGNGwTCgYpPHFHVHt
            +JHucGxVBTjq5cQUgfz35lRl80y2j5yXgCYtvZdMiHhbZMld8BWDGw==
            -----END AGE ENCRYPTED FILE-----
    lastmodified: "2025-03-19T13:15:36Z"
    mac: ENC[AES256_GCM,data:QhaK4v48I0IHScwOg0F1PUq+cM0wxoVGDrmnLSG8bgxWgqik/QileLykDFMHk4vpOl+BkobF1iCK5RAr/YRCGp3un0rjybXCUEx728x8zW5GX9cvAzpPMVWoNdPlI8w4w5RBPC5/rDkyn5Z4v4xgZ4vuY/cUuOhXIG80Ayq4Fgw=,iv:cTNUqdmGzSv2OO22zXTsVRrp56tfj9P6BqbYMMuJNt4=,tag:FUXROknb9UXNjSQxAKKtPA==,type:str]
    pgp: []
    encrypted_regex: ^(adminPassword|adminEmail|jenkinsAdminEmail|securityRealm|gerrit.config|routing_key|DATABASE_URL|SMTP_PASSWORD|SECRET_KEY_BASE|admin_password|extraCommands|key|clickhouseDatabaseURL|databaseURL|client_id|client_secret|secret_key_base|otp_secret|private_key|public_key|primaryKey|deterministicKey|keyDerivationSalt|token|clientId|secretKey|installationId|installationKey|uriOverride|adminToken.value|password.value|sql_password|erlangCookie|AUTHENTICATION_PASSWORD|ROOM_API_SECRET_KEY|adminPassword|configPassword|adminUser|configUser|MAIL_PASSWORD|APP_KEY|api_key|api_secret|keys|livekit_key|livekit_secret|secret_key|admin_pass|admin_email|mariadbPassword|mariadbRootPassword|privateKey|data|stringData|PASSWD|password|pass|postgresPassword|postgresqlPassword|redminePassword|smtpPassword|registration_shared_secret|shared_secret|secret|admin_token|integrationKey|rootPassword)$
    version: 3.9.1
