apiVersion: helm.toolkit.fluxcd.io/v2beta1
kind: HelmRelease
metadata:
    name: openldap
    namespace: openldap
spec:
    releaseName: openldap
    chart:
        spec:
            chart: openldap-stack-ha
            sourceRef:
                kind: HelmRepository
                name: openldap
    interval: 50m
    timeout: 25m
    install:
        timeout: 25m
        remediation:
            retries: 3
    values:
        # See https://github.com/jp-gouin/helm-openldap/blob/a42826ff5969e52f32fe65d39d9d5547f4e64a75/README.md#scaling-your-cluster for upping it
        replicaCount: 1
        #image:
        #    repository: bitnami/openldap
        #    tag: 2.6.7
        global:
            ldapDomain: users.midnightthoughts.space
            adminUser: ENC[AES256_GCM,data:JWpqx3I2tg==,iv:McM7pnMp7nCJ774d0Hc/915P2vTEm+uj5BWqf1oKWkk=,tag:PoTU3cdkxA7iN+85E9AKuQ==,type:str]
            adminPassword: ENC[AES256_GCM,data:D6gZ8J0iTaMmEYVPrihY/ATxY3DKE4PrOoQPFLHcCUmJhr3akzhP/+2BIBf1WFmKGVHTrz6Kt+CIH+eESSbREg==,iv:8SqgO8xB+HElimNB5Xm0MZYyU3GmyCUAbenHzA3e5zs=,tag:8bzIQbzlGQBPsYMf7FJvMg==,type:str]
            configUser: ENC[AES256_GCM,data:XZj5fxDICw==,iv:8TOcULQAN3fNU294iivQ8Ho6CljCMjgQ5/Apxme1D88=,tag:7xaEtyZkQf5WH3UMRiWraA==,type:str]
            configPassword: ENC[AES256_GCM,data:7g8JyfJyq/+msadtQMx/v/SGYjB3gkqsN3RmRJtvIpBLCb6itHjGQWgUv7bEhz/TPiIxb45P2KBruiQ0Y0SHEA==,iv:vsC6WpC8NU+mDD+WkwO+b8mLCPdKbtx5LRMKGVsoc6Q=,tag:4TvNrjajDg/+iv27btlBNQ==,type:str]
        pdb:
            enabled: false
        persistence:
            storageClass: nfs-csi
        #tolerations:
        #    - key: arch
        #      operator: Equal
        #      value: arm64
        #      effect: NoSchedule
        initTLSSecret:
            tls_enabled: true
            secret: ENC[AES256_GCM,data:u3izjkFjumJobsDqiDEBxcSN+htoxfgBU3sYX1nEPN0=,iv:Ho8zWj56fq4ciqls6QZalxANTv+V9bkIlaqFyhLGcAk=,tag:QQ+e6d5RLdYBi4+DH+8N/A==,type:str]
        ltb-passwd:
            enabled: false
        env:
            LDAP_ALLOW_ANON_BINDING: "false"
            LDAP_LOGLEVEL: "64"
        phpldapadmin:
            image:
                repository: leenooks/phpldapadmin
                tag: 2.0.0-dev
            env:
                APP_KEY: ENC[AES256_GCM,data:BBaMql325Pq+rtdaKE6gbb2ZlV2KsSmjFYKHw9rBKfrlJX0fLIcdmrSbb6rpupzpPzpi,iv:6uoazkfhf/7wpJyIWqw9aL/LSC3zav9ZPEbYiFwitWM=,tag:BTT8IL15uP826zhBI50gqg==,type:str]
                APP_URL: https://admin.users.midnightthoughts.space
                LDAP_HOST: users.midnightthoughts.space
            enabled: true
            ingress:
                enabled: true
                annotations:
                    cert-manager.io/cluster-issuer: letsencrypt-http
                path: /
                pathType: Prefix
                ## Ingress Host
                hosts:
                    - admin.users.midnightthoughts.space
                ## Ingress cert
                tls:
                    - secretName: users.midnightthoughts.space-tls
                      hosts:
                        - users.midnightthoughts.space
                        - admin.users.midnightthoughts.space
sops:
    kms: []
    gcp_kms: []
    azure_kv: []
    hc_vault: []
    age:
        - recipient: age1esjyg2qfy49awv0ptkzvpk425adczjr38m37w2mmcahzc4p8n54sll2nzh
          enc: |
            -----BEGIN AGE ENCRYPTED FILE-----
            YWdlLWVuY3J5cHRpb24ub3JnL3YxCi0+IFgyNTUxOSBrUlRuVVI1SlE5aENlb0NP
            MlRScGZpeS82Tnppem42VHdRNTJFU0dZRlVJCkVkV2xIcC81ZUlYYk9qREQ0RjBm
            Y3A1a2ZqaFVEVTRmNVpYM3pENnhEOU0KLS0tIEdxZVJCSW8wMlZNeVB3K2Z6Wk5I
            b0ZFV2kyc2NPTnh4SHBVaG1SdmFpMEEKo0ve4eahGoKVBQFr/bX/ifOM1ppl4CTB
            yp3UbtvFnphHH/ic7zoVcyyu/GJmpU80UaJqKgQGKpMEZazPcsAlHQ==
            -----END AGE ENCRYPTED FILE-----
    lastmodified: "2024-03-19T22:05:24Z"
    mac: ENC[AES256_GCM,data:xL68eripEKPNjjILb/9VQVAs9lMNgqEBytQo/YjGO0M8x3j1C6O4BET4ugkDeX3XC+GaUMbjIUhECQXBO/Fk10ik+XZD0JBqesXAYrQhnrpIrOcCXtZukmJHPwhg6JnjtDM1bvNhcrnfqtFInt87Cs1+nnohsNjA3Wn4dXRV/ZQ=,iv:4G3QXZfZwMHXYJrZZammhAaKpENoA1DrYdSUIuQQwAE=,tag:VvopUe9DnsBfa2nSam/kAQ==,type:str]
    pgp: []
    encrypted_regex: ^(adminPassword|configPassword|adminUser|configUser|APP_KEY|api_key|api_secret|keys|livekit_key|livekit_secret|secret_key|adminPassword|admin_pass|admin_email|mariadbPassword|mariadbRootPassword|privateKey|data|stringData|PASSWD|password|pass|postgresPassword|postgresqlPassword|redminePassword|smtpPassword|registration_shared_secret|shared_secret|secret)$
    version: 3.8.1
