apiVersion: helm.toolkit.fluxcd.io/v2beta1
kind: HelmRelease
metadata:
    name: openldap
    namespace: openldap
spec:
    releaseName: openldap
    chart:
        spec:
            chart: openldap-stack-ha
            sourceRef:
                kind: HelmRepository
                name: openldap
    interval: 50m
    timeout: 25m
    install:
        timeout: 25m
        remediation:
            retries: 3
    values:
        replicaCount: 3
        image:
            repository: bitnami/openldap
            tag: 2.6.7
        global:
            ldapDomain: users.midnightthoughts.space
            adminUser: ENC[AES256_GCM,data:xHpXdRIXRw==,iv:TieDU2op3Hje9Uv6FO5QSucKUyjuTEkTxl2pkO/1aOI=,tag:blFQ+kzudaXcMd3kdP0NiA==,type:str]
            adminPassword: ENC[AES256_GCM,data:y2swlu4IO+tg,iv:676O6OO7rQqb3KKxE8FdeXGDHvTzojmzfK6J+lTXS9g=,tag:ZdY4v51Ofv+V1VIe/EgxyQ==,type:str]
            configUser: ENC[AES256_GCM,data:T4pFJSxcCA==,iv:AR8VrGRfscIEC89lyp+jhjVDt6UXJilnksc8HZ99mgM=,tag:TJ40YhTCtYPguyjsJpwLNg==,type:str]
            configPassword: ENC[AES256_GCM,data:J6ISHSRtSQXz,iv:9LJdB7e0FQZ8Ikn1EDdD9UywMxhw2qeLpBGWJRCW+2Y=,tag:IkaJ0mi5kKy29Dy9Z6gKgg==,type:str]
        pdb:
            enabled: false
        persistence:
            storageClass: nfs-csi
        tolerations:
            - key: arch
              operator: Equal
              value: arm64
              effect: NoSchedule
        initTLSSecret:
            tls_enabled: false
            secret: ENC[AES256_GCM,data:pz5kiUil2i1O64a1mJfOscyg+GQkcrn3XvuO+X8txN4=,iv:XTd5rinTs8M1W3mS13mzevTclJs1P3EVPaxLGr1wJM0=,tag:XX1RC3Z06I7UfqVk0CNg2A==,type:str]
        ltb-passwd:
            enabled: false
        env:
            LDAP_ALLOW_ANON_BINDING: "false"
            LDAP_ENABLE_TLS: "no"
            #LDAP_LOGLEVEL: "64"
        phpldapadmin:
            enabled: true
            ingress:
                enabled: true
                annotations:
                    cert-manager.io/cluster-issuer: letsencrypt-http
                path: /
                pathType: Prefix
                ## Ingress Host
                hosts:
                    - admin.users.midnightthoughts.space
                ## Ingress cert
                tls:
                    - secretName: users.midnightthoughts.space-tls
                      hosts:
                        - users.midnightthoughts.space
                        - admin.users.midnightthoughts.space
sops:
    kms: []
    gcp_kms: []
    azure_kv: []
    hc_vault: []
    age:
        - recipient: age1esjyg2qfy49awv0ptkzvpk425adczjr38m37w2mmcahzc4p8n54sll2nzh
          enc: |
            -----BEGIN AGE ENCRYPTED FILE-----
            YWdlLWVuY3J5cHRpb24ub3JnL3YxCi0+IFgyNTUxOSBPVE5aVGlrL0FaNDAyMUUr
            TkNhSDlJQlkrS1E2WVQ5WkN6SVZqa2VrTGt3CmpIbEdDVDhneXlNWHBjKzBsTmVP
            UkZ6QXBFTmVBOW96YUVtT2NpMFhEeDAKLS0tIDkyMzdUU1lPQWlpcUI2OEhDYWx3
            Y3FGUWx6Q1czc0s3emFhd3FzRWtTOU0Km0punvT3IlpfAVWXz+ypjIebrl/xYOfe
            E+XTKc4SJG6wh5QH94ad+hOAMP3lhZ7pQyE15B08qmYH/bWgrUyvZA==
            -----END AGE ENCRYPTED FILE-----
    lastmodified: "2024-03-20T00:16:52Z"
    mac: ENC[AES256_GCM,data:TmLau2FtcVoEg+0NU50+9MfxrrOQq+vRGRbW93viSiBlj9ipcGNdnMSQ9PYfQDIchLutO5F53+ZJTk3kOdGrhkie6o/Gv5277/BKZCNAjYcO11JFxm+rxAKkq5/QZ7vBAfnx3yb6vbvUQU+cPGon2MJRO4ICvP54Z3r7a+SB1gM=,iv:xAnZe6RGUb0NtwcZ1oAKfbytiGgeZd+0rSWYSAaaE08=,tag:F8NrXT2Z3roG89ATiXqKfA==,type:str]
    pgp: []
    encrypted_regex: ^(adminPassword|configPassword|adminUser|configUser|APP_KEY|api_key|api_secret|keys|livekit_key|livekit_secret|secret_key|adminPassword|admin_pass|admin_email|mariadbPassword|mariadbRootPassword|privateKey|data|stringData|PASSWD|password|pass|postgresPassword|postgresqlPassword|redminePassword|smtpPassword|registration_shared_secret|shared_secret|secret)$
    version: 3.8.1
