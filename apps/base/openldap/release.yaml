apiVersion: helm.toolkit.fluxcd.io/v2beta1
kind: HelmRelease
metadata:
    name: openldap
    namespace: openldap
spec:
    releaseName: openldap
    chart:
        spec:
            chart: openldap-stack-ha
            sourceRef:
                kind: HelmRepository
                name: openldap
    interval: 50m
    timeout: 25m
    install:
        timeout: 25m
        remediation:
            retries: 3
    values:
        replicaCount: 3
        image:
            repository: bitnami/openldap
            tag: 2.6.7
        global:
            ldapDomain: users.midnightthoughts.space
            adminUser: ENC[AES256_GCM,data:nQJrPqzFXQ==,iv:Lu1ggHiSJTxWASH+jFLPyDO3Mis652vzNER1q9B58o4=,tag:0/lj/eOubV9+hq1i/mu0/g==,type:str]
            adminPassword: ENC[AES256_GCM,data:y3qS9h4gUM1t,iv:cv/ddEWWiMZy2iBHfj5m8GngtpCHJJDr2lREAEakcVM=,tag:VFZ6LJx1JnQLoTaWTHMPLg==,type:str]
            configUser: ENC[AES256_GCM,data:n1fm2FG2DA==,iv:zMiOE+zi5Y14Gr2RSUEoHZOuGldLlSWjNH+DK49MlRk=,tag:erW34c4WRUiCieBhVgwNBw==,type:str]
            configPassword: ENC[AES256_GCM,data:K0TMttveEAhW,iv:fCaSe3FCcrpucBwNOp6A74W7mMvS+YnoyhuU/t4oVu0=,tag:NQdc47+AJLw10AP1rbHsyQ==,type:str]
        pdb:
            enabled: false
        persistence:
            storageClass: nfs-csi
        tolerations:
            - key: arch
              operator: Equal
              value: arm64
              effect: NoSchedule
        initTLSSecret:
            tls_enabled: false
            secret: ENC[AES256_GCM,data:TwGu60ovQkWvzihgshfZEzFW0qBmJCRKxfiVRQD1Afc=,iv:70sUSt+6bIjvbV6RdsdAWj0TzGrvGysNRjbnLh0y15I=,tag:Oc4NXinAM680EpDECewzpA==,type:str]
        ltb-passwd:
            enabled: false
        env:
            LDAP_ALLOW_ANON_BINDING: "false"
            LDAP_ENABLE_TLS: "false"
            #LDAP_LOGLEVEL: "64"
        phpldapadmin:
            image:
                repository: leenooks/phpldapadmin
                tag: 2.0.0-dev
            env:
                APP_KEY: ENC[AES256_GCM,data:9AO2Y13fSFEWK985jRHVejHAiua5kehi9HZOS+W1QCq4cvcjiOTQx1w8e/sJ2EqOdda+,iv:q3iIBI4j+uKUUMb/J4UqdcJigcgF/2dAP1havYrreIU=,tag:LHLOd6Flx/LPQ/uOYy50Sw==,type:str]
                APP_URL: https://admin.users.midnightthoughts.space
                LDAP_HOST: users.midnightthoughts.space
            enabled: false
            ingress:
                enabled: true
                annotations:
                    cert-manager.io/cluster-issuer: letsencrypt-http
                path: /
                pathType: Prefix
                ## Ingress Host
                hosts:
                    - admin.users.midnightthoughts.space
                ## Ingress cert
                tls:
                    - secretName: users.midnightthoughts.space-tls
                      hosts:
                        - users.midnightthoughts.space
                        - admin.users.midnightthoughts.space
sops:
    kms: []
    gcp_kms: []
    azure_kv: []
    hc_vault: []
    age:
        - recipient: age1esjyg2qfy49awv0ptkzvpk425adczjr38m37w2mmcahzc4p8n54sll2nzh
          enc: |
            -----BEGIN AGE ENCRYPTED FILE-----
            YWdlLWVuY3J5cHRpb24ub3JnL3YxCi0+IFgyNTUxOSBJc1V0Q2pzOThBbEJkTjRo
            b1picmtkbEhOWE9YVlFWck1WRWVKNlNNUmxNCnhVdDYwYkFIa0pWRHFtbXhrL2Rr
            WTJQYUZhU2FYbUVlelc2VEFVZGRJTjAKLS0tIEZLcG4vMXkrMTJkTmZETFJIcTcy
            Ri9CSTZCd1FPSmNoTlB1Y216K3RvRkEK82wFR/6Hfe6egpm/rzj96jMrYCifD8Vb
            Dq+DOt9cuk0xep2QQXH3/tezN/BYIvHaXNM8SxegqEHC9ebxuEN2jQ==
            -----END AGE ENCRYPTED FILE-----
    lastmodified: "2024-03-19T23:23:18Z"
    mac: ENC[AES256_GCM,data:GD2urpc5F3N+ZmultNt28Q9lFcbTn9K+67tKaoOiRJDP6VrCGkMwRWuI+OWarEFNqnf9tQYRHBZAnb43basvrFVm1/9s3RrQiztz7C3JW/ffArwoEZ9b+1HxJJAJn99+Fw1OZ39L2m31l4gBxVYweIDLgmAz5ssKS1VJLY53wWY=,iv:KhZwImKC/ym+/rbCFXqdBL/IOLCAnnchMFMgHZn+bF0=,tag:c9x2uU0Wf3UljsvZTGGwwg==,type:str]
    pgp: []
    encrypted_regex: ^(adminPassword|configPassword|adminUser|configUser|APP_KEY|api_key|api_secret|keys|livekit_key|livekit_secret|secret_key|adminPassword|admin_pass|admin_email|mariadbPassword|mariadbRootPassword|privateKey|data|stringData|PASSWD|password|pass|postgresPassword|postgresqlPassword|redminePassword|smtpPassword|registration_shared_secret|shared_secret|secret)$
    version: 3.8.1
