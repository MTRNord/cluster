apiVersion: v1
kind: Namespace
metadata:
    name: postgres-cluster
sops:
    kms: []
    gcp_kms: []
    azure_kv: []
    hc_vault: []
    age:
        - recipient: age1esjyg2qfy49awv0ptkzvpk425adczjr38m37w2mmcahzc4p8n54sll2nzh
          enc: |
              -----BEGIN AGE ENCRYPTED FILE-----
              YWdlLWVuY3J5cHRpb24ub3JnL3YxCi0+IFgyNTUxOSBUZ0JSKzB5Q29rYVJBbGdS
              b1Y2TFp2N3llUm40RzFUQXdhMGxvN0lGbzNZCjdXbXVjajJmUDUramY3TnVOSCtM
              VlVva25Qdk1wTThCRzNDRXdseG95LzgKLS0tIDJKT1BEaTlyQXQ1a0tGckV4Z1Uy
              OUxRei9waytIMDRsK2JuZlFwUGZyNHMKeMhryEnFUXmRILjJKMDwV7lEZtH0Wm2c
              mJj96/zXZ/jReCgE6ZBWJAfMA1cO5gHOEsGeGxIszVscKjJ/Rr1Mhg==
              -----END AGE ENCRYPTED FILE-----
    lastmodified: "2025-01-14T17:44:07Z"
    mac: ENC[AES256_GCM,data:5Co7jyKjOqOKu+MDzYIEROPrMvdQkb/G4j+NBKrG6YTXg2qfeIwZV6BqDqU6UhAzJdOuEPYkeKnAK7p1Qs9GUMGAoDuFoKr2CvvuVHqSewxXJAcr9f3SO1idAkskSpuIb82m6dSgl4XMuEavdY6tbo+wmjtd9yuGynGE7Xt+P5I=,iv:LjPiD0ht7/eR6VFNwwCSDUgu6lMlT+kQCyVNtFh33Gs=,tag:Z9Fy1Xh3IAwJTHmprxlC1Q==,type:str]
    pgp: []
    encrypted_regex: ^(adminPassword|adminEmail|jenkinsAdminEmail|securityRealm|gerrit.config|routing_key|DATABASE_URL|SMTP_PASSWORD|SECRET_KEY_BASE|admin_password|extraCommands|key|clickhouseDatabaseURL|databaseURL|client_id|client_secret|secret_key_base|otp_secret|private_key|public_key|primaryKey|deterministicKey|keyDerivationSalt|token|clientId|secretKey|installationId|installationKey|uriOverride|adminToken.value|password.value|sql_password|erlangCookie|AUTHENTICATION_PASSWORD|ROOM_API_SECRET_KEY|adminPassword|configPassword|adminUser|configUser|MAIL_PASSWORD|APP_KEY|api_key|api_secret|keys|livekit_key|livekit_secret|secret_key|admin_pass|admin_email|mariadbPassword|mariadbRootPassword|privateKey|data|stringData|PASSWD|password|pass|postgresPassword|postgresqlPassword|redminePassword|smtpPassword|registration_shared_secret|shared_secret|secret|admin_token|integrationKey|rootPassword)$
    version: 3.9.1
---
apiVersion: v1
kind: Secret
metadata:
    name: pg-s3-credentials
    namespace: postgres-cluster
type: Opaque
stringData:
    ACCESS_KEY_ID: ENC[AES256_GCM,data:DiQKTQKX2WIF8NCMMTBsmtrq8Yg=,iv:Jq7e4iyqjGgd4PoWZD/4VNJgb4sXUQT6s6U7B9gBvEw=,tag:N7N6vrpSfvt7/mWubKmTYA==,type:str]
    ACCESS_SECRET_KEY: ENC[AES256_GCM,data:ZRp21nYOLo0UMfp1KFNohV5UN5V/USjedfaLjjdK5eX1d/37TcoILw==,iv:yA99Yfqvyd0Stb7iN/gD4H/4sdj//ucI4TUg2x9PTp0=,tag:DsP2sBRgbBwECsO/tkLNUQ==,type:str]
sops:
    kms: []
    gcp_kms: []
    azure_kv: []
    hc_vault: []
    age:
        - recipient: age1esjyg2qfy49awv0ptkzvpk425adczjr38m37w2mmcahzc4p8n54sll2nzh
          enc: |
              -----BEGIN AGE ENCRYPTED FILE-----
              YWdlLWVuY3J5cHRpb24ub3JnL3YxCi0+IFgyNTUxOSBUZ0JSKzB5Q29rYVJBbGdS
              b1Y2TFp2N3llUm40RzFUQXdhMGxvN0lGbzNZCjdXbXVjajJmUDUramY3TnVOSCtM
              VlVva25Qdk1wTThCRzNDRXdseG95LzgKLS0tIDJKT1BEaTlyQXQ1a0tGckV4Z1Uy
              OUxRei9waytIMDRsK2JuZlFwUGZyNHMKeMhryEnFUXmRILjJKMDwV7lEZtH0Wm2c
              mJj96/zXZ/jReCgE6ZBWJAfMA1cO5gHOEsGeGxIszVscKjJ/Rr1Mhg==
              -----END AGE ENCRYPTED FILE-----
    lastmodified: "2025-01-14T17:44:07Z"
    mac: ENC[AES256_GCM,data:5Co7jyKjOqOKu+MDzYIEROPrMvdQkb/G4j+NBKrG6YTXg2qfeIwZV6BqDqU6UhAzJdOuEPYkeKnAK7p1Qs9GUMGAoDuFoKr2CvvuVHqSewxXJAcr9f3SO1idAkskSpuIb82m6dSgl4XMuEavdY6tbo+wmjtd9yuGynGE7Xt+P5I=,iv:LjPiD0ht7/eR6VFNwwCSDUgu6lMlT+kQCyVNtFh33Gs=,tag:Z9Fy1Xh3IAwJTHmprxlC1Q==,type:str]
    pgp: []
    encrypted_regex: ^(adminPassword|adminEmail|jenkinsAdminEmail|securityRealm|gerrit.config|routing_key|DATABASE_URL|SMTP_PASSWORD|SECRET_KEY_BASE|admin_password|extraCommands|key|clickhouseDatabaseURL|databaseURL|client_id|client_secret|secret_key_base|otp_secret|private_key|public_key|primaryKey|deterministicKey|keyDerivationSalt|token|clientId|secretKey|installationId|installationKey|uriOverride|adminToken.value|password.value|sql_password|erlangCookie|AUTHENTICATION_PASSWORD|ROOM_API_SECRET_KEY|adminPassword|configPassword|adminUser|configUser|MAIL_PASSWORD|APP_KEY|api_key|api_secret|keys|livekit_key|livekit_secret|secret_key|admin_pass|admin_email|mariadbPassword|mariadbRootPassword|privateKey|data|stringData|PASSWD|password|pass|postgresPassword|postgresqlPassword|redminePassword|smtpPassword|registration_shared_secret|shared_secret|secret|admin_token|integrationKey|rootPassword)$
    version: 3.9.1
---
apiVersion: barmancloud.cnpg.io/v1
kind: ObjectStore
metadata:
    name: hetzner-store
    namespace: postgres-cluster
spec:
    configuration:
        destinationPath: s3://midnightthoughts-pg-backup/pg-backup
        endpointURL: https://hel1.your-objectstorage.com
        s3Credentials:
            accessKeyId:
                name: pg-s3-credentials
                key: ENC[AES256_GCM,data:2DGugzminFEkLm51kg==,iv:Om08ppFVER68t6T4xo8o+kc8HJcRoqwVYGyTsHHP0YI=,tag:5z69MCNcxNUnS/qVh0HqZg==,type:str]
            secretAccessKey:
                name: pg-s3-credentials
                key: ENC[AES256_GCM,data:LBMYMk8sdTPVfJ8LXLLXBuo=,iv:8sOrxG9ixWBpY8oiYcrlKU3I9thuRBEcWnr3A+g9SrQ=,tag:yKxGt0iON5QD/6LqjNeiew==,type:str]
        wal:
            compression: gzip
sops:
    kms: []
    gcp_kms: []
    azure_kv: []
    hc_vault: []
    age:
        - recipient: age1esjyg2qfy49awv0ptkzvpk425adczjr38m37w2mmcahzc4p8n54sll2nzh
          enc: |
              -----BEGIN AGE ENCRYPTED FILE-----
              YWdlLWVuY3J5cHRpb24ub3JnL3YxCi0+IFgyNTUxOSBUZ0JSKzB5Q29rYVJBbGdS
              b1Y2TFp2N3llUm40RzFUQXdhMGxvN0lGbzNZCjdXbXVjajJmUDUramY3TnVOSCtM
              VlVva25Qdk1wTThCRzNDRXdseG95LzgKLS0tIDJKT1BEaTlyQXQ1a0tGckV4Z1Uy
              OUxRei9waytIMDRsK2JuZlFwUGZyNHMKeMhryEnFUXmRILjJKMDwV7lEZtH0Wm2c
              mJj96/zXZ/jReCgE6ZBWJAfMA1cO5gHOEsGeGxIszVscKjJ/Rr1Mhg==
              -----END AGE ENCRYPTED FILE-----
    lastmodified: "2025-01-14T17:44:07Z"
    mac: ENC[AES256_GCM,data:5Co7jyKjOqOKu+MDzYIEROPrMvdQkb/G4j+NBKrG6YTXg2qfeIwZV6BqDqU6UhAzJdOuEPYkeKnAK7p1Qs9GUMGAoDuFoKr2CvvuVHqSewxXJAcr9f3SO1idAkskSpuIb82m6dSgl4XMuEavdY6tbo+wmjtd9yuGynGE7Xt+P5I=,iv:LjPiD0ht7/eR6VFNwwCSDUgu6lMlT+kQCyVNtFh33Gs=,tag:Z9Fy1Xh3IAwJTHmprxlC1Q==,type:str]
    pgp: []
    encrypted_regex: ^(adminPassword|adminEmail|jenkinsAdminEmail|securityRealm|gerrit.config|routing_key|DATABASE_URL|SMTP_PASSWORD|SECRET_KEY_BASE|admin_password|extraCommands|key|clickhouseDatabaseURL|databaseURL|client_id|client_secret|secret_key_base|otp_secret|private_key|public_key|primaryKey|deterministicKey|keyDerivationSalt|token|clientId|secretKey|installationId|installationKey|uriOverride|adminToken.value|password.value|sql_password|erlangCookie|AUTHENTICATION_PASSWORD|ROOM_API_SECRET_KEY|adminPassword|configPassword|adminUser|configUser|MAIL_PASSWORD|APP_KEY|api_key|api_secret|keys|livekit_key|livekit_secret|secret_key|admin_pass|admin_email|mariadbPassword|mariadbRootPassword|privateKey|data|stringData|PASSWD|password|pass|postgresPassword|postgresqlPassword|redminePassword|smtpPassword|registration_shared_secret|shared_secret|secret|admin_token|integrationKey|rootPassword)$
    version: 3.9.1
---
apiVersion: postgresql.cnpg.io/v1
kind: Cluster
metadata:
    name: pg-cluster-v2
    namespace: postgres-cluster
spec:
    instances: 3
    imageName: ghcr.io/cloudnative-pg/postgresql:17.2@sha256:13ee1d8acd9bce3626f2abe6559fc2c092926038d5cd55eff59be2a48c6b176c
    enableSuperuserAccess: true
    primaryUpdateMethod: switchover
    ephemeralVolumesSizeLimit:
        shm: 100Mi
        temporaryData: 100Mi
    postgresql:
        parameters:
            max_connections: "340"
        pg_hba:
            - host all bugzilla all md5
    plugins:
        - name: barman-cloud.cloudnative-pg.io
          parameters:
              barmanObjectName: hetzner-store
    backup:
        barmanObjectStore:
            destinationPath: s3://midnightthoughts-pg-backup/pg-base-backup
            endpointURL: https://hel1.your-objectstorage.com
            s3Credentials:
                accessKeyId:
                    name: pg-s3-credentials
                    key: ENC[AES256_GCM,data:RFnCqpEe8QJtKTLCSg==,iv:cUuAyBbEjnN5j5nGLJfHaN2g9IycCOQ0WD14+Ta9kQg=,tag:9KI4QFbHZNAMVCoPyueV/g==,type:str]
                secretAccessKey:
                    name: pg-s3-credentials
                    key: ENC[AES256_GCM,data:ExMDyRaTLLGePUKQsBFN104=,iv:cPAV7nDSMUogt0GncAiClHl63CnnEo1auujJbGvUTws=,tag:Pa7O5Zzd5y8lVK2O6a4CQQ==,type:str]
            wal:
                compression: gzip
        retentionPolicy: 60d
    managed:
        roles:
            - name: synapse
              ensure: present
              login: true
              superuser: false
              passwordSecret:
                  name: synapse
            - name: draupnir_synapse
              ensure: present
              login: true
              superuser: false
              passwordSecret:
                  name: draupnir-synapse
            - name: authentik
              ensure: present
              login: true
              superuser: false
              passwordSecret:
                  name: authentik
            - name: ejabberd
              ensure: present
              login: true
              superuser: false
              passwordSecret:
                  name: ejabberd
            - name: vaultwarden
              ensure: present
              login: true
              superuser: false
              passwordSecret:
                  name: vaultwarden
            - name: mastodon
              ensure: present
              login: true
              superuser: false
              passwordSecret:
                  name: mastodon
            - name: openproject
              ensure: present
              login: true
              superuser: false
              passwordSecret:
                  name: openproject
            - name: plausible
              ensure: present
              login: true
              superuser: false
              passwordSecret:
                  name: plausible
            - name: coder
              ensure: present
              login: true
              superuser: false
              passwordSecret:
                  name: coder
            - name: matrix_auth
              ensure: present
              login: true
              superuser: false
              passwordSecret:
                  name: matrix-auth
            - name: cachet
              ensure: present
              login: true
              superuser: false
              passwordSecret:
                  name: cachet
            - name: docuseal
              ensure: present
              login: true
              superuser: false
              passwordSecret:
                  name: docuseal
            - name: bugzilla
              ensure: present
              login: true
              superuser: false
              passwordSecret:
                  name: bugzilla
    #bootstrap:
    #    initdb:
    #        import:
    #            type: monolith
    #            databases:
    #                - synapse
    #                - draupnir_synapse
    #                - d4all
    #                - authentik
    #                - ejabberd
    #                - vaultwarden
    #                - mastodon
    #                - openproject
    #                - plausible
    #                - coder
    #                - matrix_auth
    #                - cachet
    #                - docuseal
    #            roles:
    #                - synapse
    #                - draupnir_synapse
    #                - d4all
    #                - authentik
    #                - ejabberd
    #                - vaultwarden
    #                - mastodon
    #                - openproject
    #                - plausible
    #                - coder
    #                - matrix_auth
    #                - cachet
    #                - docuseal
    #                # Old roles from zalando. TODO: Remove
    #                - admin
    #                - robot_zmon
    #            source:
    #                externalCluster: zalando-cluster
    storage:
        storageClass: hcloud-volumes
        size: 100Gi
        #resizeInUseVolumes: false
    #externalClusters:
    #    - name: zalando-cluster
    #      connectionParameters:
    #          host: postgres-cluster.postgres-cluster.svc.cluster.local
    #          user: postgres
    #          dbname: postgres
    #          sslmode: require
    #      password:
    #          name: postgres.postgres-cluster.credentials.postgresql.acid.zalan.do
    #          key: password
sops:
    kms: []
    gcp_kms: []
    azure_kv: []
    hc_vault: []
    age:
        - recipient: age1esjyg2qfy49awv0ptkzvpk425adczjr38m37w2mmcahzc4p8n54sll2nzh
          enc: |
              -----BEGIN AGE ENCRYPTED FILE-----
              YWdlLWVuY3J5cHRpb24ub3JnL3YxCi0+IFgyNTUxOSBUZ0JSKzB5Q29rYVJBbGdS
              b1Y2TFp2N3llUm40RzFUQXdhMGxvN0lGbzNZCjdXbXVjajJmUDUramY3TnVOSCtM
              VlVva25Qdk1wTThCRzNDRXdseG95LzgKLS0tIDJKT1BEaTlyQXQ1a0tGckV4Z1Uy
              OUxRei9waytIMDRsK2JuZlFwUGZyNHMKeMhryEnFUXmRILjJKMDwV7lEZtH0Wm2c
              mJj96/zXZ/jReCgE6ZBWJAfMA1cO5gHOEsGeGxIszVscKjJ/Rr1Mhg==
              -----END AGE ENCRYPTED FILE-----
    lastmodified: "2025-01-14T17:44:07Z"
    mac: ENC[AES256_GCM,data:5Co7jyKjOqOKu+MDzYIEROPrMvdQkb/G4j+NBKrG6YTXg2qfeIwZV6BqDqU6UhAzJdOuEPYkeKnAK7p1Qs9GUMGAoDuFoKr2CvvuVHqSewxXJAcr9f3SO1idAkskSpuIb82m6dSgl4XMuEavdY6tbo+wmjtd9yuGynGE7Xt+P5I=,iv:LjPiD0ht7/eR6VFNwwCSDUgu6lMlT+kQCyVNtFh33Gs=,tag:Z9Fy1Xh3IAwJTHmprxlC1Q==,type:str]
    pgp: []
    encrypted_regex: ^(adminPassword|adminEmail|jenkinsAdminEmail|securityRealm|gerrit.config|routing_key|DATABASE_URL|SMTP_PASSWORD|SECRET_KEY_BASE|admin_password|extraCommands|key|clickhouseDatabaseURL|databaseURL|client_id|client_secret|secret_key_base|otp_secret|private_key|public_key|primaryKey|deterministicKey|keyDerivationSalt|token|clientId|secretKey|installationId|installationKey|uriOverride|adminToken.value|password.value|sql_password|erlangCookie|AUTHENTICATION_PASSWORD|ROOM_API_SECRET_KEY|adminPassword|configPassword|adminUser|configUser|MAIL_PASSWORD|APP_KEY|api_key|api_secret|keys|livekit_key|livekit_secret|secret_key|admin_pass|admin_email|mariadbPassword|mariadbRootPassword|privateKey|data|stringData|PASSWD|password|pass|postgresPassword|postgresqlPassword|redminePassword|smtpPassword|registration_shared_secret|shared_secret|secret|admin_token|integrationKey|rootPassword)$
    version: 3.9.1
---
apiVersion: monitoring.coreos.com/v1
kind: PodMonitor
metadata:
    name: pg-cluster-v2
    namespace: postgres-cluster
spec:
    selector:
        matchLabels:
            cnpg.io/cluster: pg-cluster-v2
    podMetricsEndpoints:
        - port: metrics
sops:
    kms: []
    gcp_kms: []
    azure_kv: []
    hc_vault: []
    age:
        - recipient: age1esjyg2qfy49awv0ptkzvpk425adczjr38m37w2mmcahzc4p8n54sll2nzh
          enc: |
              -----BEGIN AGE ENCRYPTED FILE-----
              YWdlLWVuY3J5cHRpb24ub3JnL3YxCi0+IFgyNTUxOSBUZ0JSKzB5Q29rYVJBbGdS
              b1Y2TFp2N3llUm40RzFUQXdhMGxvN0lGbzNZCjdXbXVjajJmUDUramY3TnVOSCtM
              VlVva25Qdk1wTThCRzNDRXdseG95LzgKLS0tIDJKT1BEaTlyQXQ1a0tGckV4Z1Uy
              OUxRei9waytIMDRsK2JuZlFwUGZyNHMKeMhryEnFUXmRILjJKMDwV7lEZtH0Wm2c
              mJj96/zXZ/jReCgE6ZBWJAfMA1cO5gHOEsGeGxIszVscKjJ/Rr1Mhg==
              -----END AGE ENCRYPTED FILE-----
    lastmodified: "2025-01-14T17:44:07Z"
    mac: ENC[AES256_GCM,data:5Co7jyKjOqOKu+MDzYIEROPrMvdQkb/G4j+NBKrG6YTXg2qfeIwZV6BqDqU6UhAzJdOuEPYkeKnAK7p1Qs9GUMGAoDuFoKr2CvvuVHqSewxXJAcr9f3SO1idAkskSpuIb82m6dSgl4XMuEavdY6tbo+wmjtd9yuGynGE7Xt+P5I=,iv:LjPiD0ht7/eR6VFNwwCSDUgu6lMlT+kQCyVNtFh33Gs=,tag:Z9Fy1Xh3IAwJTHmprxlC1Q==,type:str]
    pgp: []
    encrypted_regex: ^(adminPassword|adminEmail|jenkinsAdminEmail|securityRealm|gerrit.config|routing_key|DATABASE_URL|SMTP_PASSWORD|SECRET_KEY_BASE|admin_password|extraCommands|key|clickhouseDatabaseURL|databaseURL|client_id|client_secret|secret_key_base|otp_secret|private_key|public_key|primaryKey|deterministicKey|keyDerivationSalt|token|clientId|secretKey|installationId|installationKey|uriOverride|adminToken.value|password.value|sql_password|erlangCookie|AUTHENTICATION_PASSWORD|ROOM_API_SECRET_KEY|adminPassword|configPassword|adminUser|configUser|MAIL_PASSWORD|APP_KEY|api_key|api_secret|keys|livekit_key|livekit_secret|secret_key|admin_pass|admin_email|mariadbPassword|mariadbRootPassword|privateKey|data|stringData|PASSWD|password|pass|postgresPassword|postgresqlPassword|redminePassword|smtpPassword|registration_shared_secret|shared_secret|secret|admin_token|integrationKey|rootPassword)$
    version: 3.9.1
---
apiVersion: postgresql.cnpg.io/v1
kind: ScheduledBackup
metadata:
    name: hetzner-backup
    namespace: postgres-cluster
spec:
    schedule: 5 4 * * 1
    backupOwnerReference: self
    method: plugin
    target: prefer-standby
    immediate: true
    cluster:
        name: pg-cluster-v2
    pluginConfiguration:
        name: barman-cloud.cloudnative-pg.io
sops:
    kms: []
    gcp_kms: []
    azure_kv: []
    hc_vault: []
    age:
        - recipient: age1esjyg2qfy49awv0ptkzvpk425adczjr38m37w2mmcahzc4p8n54sll2nzh
          enc: |
              -----BEGIN AGE ENCRYPTED FILE-----
              YWdlLWVuY3J5cHRpb24ub3JnL3YxCi0+IFgyNTUxOSBUZ0JSKzB5Q29rYVJBbGdS
              b1Y2TFp2N3llUm40RzFUQXdhMGxvN0lGbzNZCjdXbXVjajJmUDUramY3TnVOSCtM
              VlVva25Qdk1wTThCRzNDRXdseG95LzgKLS0tIDJKT1BEaTlyQXQ1a0tGckV4Z1Uy
              OUxRei9waytIMDRsK2JuZlFwUGZyNHMKeMhryEnFUXmRILjJKMDwV7lEZtH0Wm2c
              mJj96/zXZ/jReCgE6ZBWJAfMA1cO5gHOEsGeGxIszVscKjJ/Rr1Mhg==
              -----END AGE ENCRYPTED FILE-----
    lastmodified: "2025-01-14T17:44:07Z"
    mac: ENC[AES256_GCM,data:5Co7jyKjOqOKu+MDzYIEROPrMvdQkb/G4j+NBKrG6YTXg2qfeIwZV6BqDqU6UhAzJdOuEPYkeKnAK7p1Qs9GUMGAoDuFoKr2CvvuVHqSewxXJAcr9f3SO1idAkskSpuIb82m6dSgl4XMuEavdY6tbo+wmjtd9yuGynGE7Xt+P5I=,iv:LjPiD0ht7/eR6VFNwwCSDUgu6lMlT+kQCyVNtFh33Gs=,tag:Z9Fy1Xh3IAwJTHmprxlC1Q==,type:str]
    pgp: []
    encrypted_regex: ^(adminPassword|adminEmail|jenkinsAdminEmail|securityRealm|gerrit.config|routing_key|DATABASE_URL|SMTP_PASSWORD|SECRET_KEY_BASE|admin_password|extraCommands|key|clickhouseDatabaseURL|databaseURL|client_id|client_secret|secret_key_base|otp_secret|private_key|public_key|primaryKey|deterministicKey|keyDerivationSalt|token|clientId|secretKey|installationId|installationKey|uriOverride|adminToken.value|password.value|sql_password|erlangCookie|AUTHENTICATION_PASSWORD|ROOM_API_SECRET_KEY|adminPassword|configPassword|adminUser|configUser|MAIL_PASSWORD|APP_KEY|api_key|api_secret|keys|livekit_key|livekit_secret|secret_key|admin_pass|admin_email|mariadbPassword|mariadbRootPassword|privateKey|data|stringData|PASSWD|password|pass|postgresPassword|postgresqlPassword|redminePassword|smtpPassword|registration_shared_secret|shared_secret|secret|admin_token|integrationKey|rootPassword)$
    version: 3.9.1
---
apiVersion: postgresql.cnpg.io/v1
kind: ScheduledBackup
metadata:
    name: hetzner-base-backup
    namespace: postgres-cluster
spec:
    schedule: 5 4 * * 3
    backupOwnerReference: self
    target: prefer-standby
    immediate: true
    cluster:
        name: pg-cluster-v2
sops:
    kms: []
    gcp_kms: []
    azure_kv: []
    hc_vault: []
    age:
        - recipient: age1esjyg2qfy49awv0ptkzvpk425adczjr38m37w2mmcahzc4p8n54sll2nzh
          enc: |
              -----BEGIN AGE ENCRYPTED FILE-----
              YWdlLWVuY3J5cHRpb24ub3JnL3YxCi0+IFgyNTUxOSBUZ0JSKzB5Q29rYVJBbGdS
              b1Y2TFp2N3llUm40RzFUQXdhMGxvN0lGbzNZCjdXbXVjajJmUDUramY3TnVOSCtM
              VlVva25Qdk1wTThCRzNDRXdseG95LzgKLS0tIDJKT1BEaTlyQXQ1a0tGckV4Z1Uy
              OUxRei9waytIMDRsK2JuZlFwUGZyNHMKeMhryEnFUXmRILjJKMDwV7lEZtH0Wm2c
              mJj96/zXZ/jReCgE6ZBWJAfMA1cO5gHOEsGeGxIszVscKjJ/Rr1Mhg==
              -----END AGE ENCRYPTED FILE-----
    lastmodified: "2025-01-14T17:44:07Z"
    mac: ENC[AES256_GCM,data:5Co7jyKjOqOKu+MDzYIEROPrMvdQkb/G4j+NBKrG6YTXg2qfeIwZV6BqDqU6UhAzJdOuEPYkeKnAK7p1Qs9GUMGAoDuFoKr2CvvuVHqSewxXJAcr9f3SO1idAkskSpuIb82m6dSgl4XMuEavdY6tbo+wmjtd9yuGynGE7Xt+P5I=,iv:LjPiD0ht7/eR6VFNwwCSDUgu6lMlT+kQCyVNtFh33Gs=,tag:Z9Fy1Xh3IAwJTHmprxlC1Q==,type:str]
    pgp: []
    encrypted_regex: ^(adminPassword|adminEmail|jenkinsAdminEmail|securityRealm|gerrit.config|routing_key|DATABASE_URL|SMTP_PASSWORD|SECRET_KEY_BASE|admin_password|extraCommands|key|clickhouseDatabaseURL|databaseURL|client_id|client_secret|secret_key_base|otp_secret|private_key|public_key|primaryKey|deterministicKey|keyDerivationSalt|token|clientId|secretKey|installationId|installationKey|uriOverride|adminToken.value|password.value|sql_password|erlangCookie|AUTHENTICATION_PASSWORD|ROOM_API_SECRET_KEY|adminPassword|configPassword|adminUser|configUser|MAIL_PASSWORD|APP_KEY|api_key|api_secret|keys|livekit_key|livekit_secret|secret_key|admin_pass|admin_email|mariadbPassword|mariadbRootPassword|privateKey|data|stringData|PASSWD|password|pass|postgresPassword|postgresqlPassword|redminePassword|smtpPassword|registration_shared_secret|shared_secret|secret|admin_token|integrationKey|rootPassword)$
    version: 3.9.1
