---
apiVersion: v1
kind: Namespace
metadata:
  name: matrix-postgres-cluster
---
apiVersion: acid.zalan.do/v1
kind: postgresql
metadata:
  labels:
    team: matrix
  name: matrix-postgres-cluster
  namespace: matrix-postgres-cluster
spec:
  enableShmVolume: true
  databases:
    synapse: synapse
    matrix_media_repo: matrix_media_repo
    syncv3: syncv3
    signal_bridge: signal_bridge
    instagram_bridge: instagram_bridge
  numberOfInstances: 2
  resources:
    requests:
      cpu: 10m
      memory: 100Mi
    limits:
      cpu: 500m
      memory: 500Mi
  postgresql:
    version: "15"
    parameters:
      password_encryption: scram-sha-256
      max_connections: "200"
      log_statement: "all"
  teamId: matrix
  users:
    synapse: []
    matrix_media_repo: []
    syncv3: []
    signal_bridge: []
    instagram_bridge: []
  volume:
    size: 10Gi
  patroni:
    failsafe_mode: false
    ttl: 30
    loop_wait: 10
    retry_timeout: 10
    synchronous_commit: "on"
    synchronous_standby_names: "*"
    synchronous_mode_strict: false
    synchronous_node_count: 1
    maximum_lag_on_failover: 33554432
